openapi: 3.0.3
info:
  title: 安全管理平台中心端接口文档
  description: "# \U0001F3C1 变更记录\n\n图例：\n\n✨：`新增接口`\n\n✏️：`修改接口`\n\n\U0001F5D1️：`删除接口`\n\n# \U0001F91D 规则约定\n\n## 错误码\n\n可以通过 HTTP 状态码来判断也出是否处理成功：\n\n- `2xx`：代表后端业务处理成功。\n\n- `4xx`：代表客户端错误，请根据提示检查请求信息。\n\n- `401`：在本系统中有特殊含义，代表 `用户认证无效`，前端页码应该重定向至登录页让用户重新登录。\n\n- `5xx`：代表后端服务有问题，应联系后端开发进行修复。\n\n> - `2xx`：状态码代表业务处理成功，此时 Body 中不会包含二级业务状态码，直接取 Body 就是返回的信息。（有些业务可能 Body 为空，比如创建用户，提交后创建成功则无需返回什么内容，要视情况而定）。\n>\n> - `4xx` `5xx`：代表处理异常。具体是什么问题，请读取 Body 解析。Body 格式大致遵循 [RFC 7807](https://www.ietf.org/rfc/rfc7807.html) Problem Details。对于一些未先预料的业务错误，响应的 Body 不是 JSON 的，前端也应该做兜底处理，给用户一个友好提示。 \n\n## 认证信息\n\n在 [用户登录](operations/post-login) 认证成功后，返回报文中会有一个 `token` 字段，在调用需要登录认证的接口时，请在 Request Header 的 `Authorization` 中携带上 `token`。\n\n> - 对于一些不方便设置 Header `Authorization` 的请求，如：`websocket`、 `sse` 或调用浏览器下载 `windows.open()` 等操作，也可以将 Token 带到 query 参数中，如：`authorization=token` （注意在 query 参数中 `authorization` 是纯小写）。query 携带 Token 仅支持 `GET` 方法，其他方法带了 query Token 后端也不会处理。\n>\n> - 对于 `GET` 方法，推荐将 Token 带到 Header 中，query 参数只是为了照顾不方便设置 Header 的请求而使用的。如果 `GET` 方法同时设置了 Header 和 query Token，则以 Header 中的 Token 为准。\n>\n> - 该 Token 只是代表用户唯一且有效的普通字符串，并非 [JWT](https://www.ietf.org/rfc/rfc7519.html) Token。\n>\n> - 目前用户不可重复登录，当用户在其他地方登陆成功后，之前签发的 Token 会立即失效。\n>\n> - 该 Token 在后端会类似于 session 续期，如果用户一直的操作交互，则该 Token 会一直续期一直有效。\n\n## 时间格式\n\n时间格式使用 [RFC 3339](https://www.ietf.org/rfc/rfc3339.html)，若有特殊情况使用其他格式，则会在字段处单独说明。\n\n### js 解析 RFC 3339\n```javascript\nlet str = \"2023-03-30T02:59:41.679Z\";\nlet date = new Date(str); // Date 构造方法就可以解析 RFC3339 格式的时间\n```\n\n### js 生成 RFC 3339 格式字符串\n```javascript\nlet now = new Date();\nnow.toJSON(); // 2023-03-30T02:59:41.679Z\n\nlet obj = {timeAt: now};\nJSON.stringify(obj); // {\"timeAt\":\"2023-03-30T02:59:41.679Z\"}\n\n```"
  version: 0.0.1
  contact:
    name: 东方财富安全团队
    url: 'https://security.eastmoney.com'
    email: none@none.none
  termsOfService: 'https://security.eastmoney.com'
  x-logo:
    url: logo.ico
servers:
  - url: /api/v1
    description: 中心端
tags:
  - name: "\U0001F195 新增接口"
  - name: 登录模块
  - name: Agent
  - name: Broker
  - name: 用户模块
  - name: 用户日志
  - name: 节点调用
  - name: 插件配置
  - name: 配置参数
  - name: 插件
paths:
  /login/han:
    post:
      summary: 获取汉字点选验证码
      operationId: post-login-han
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  han_id:
                    type: string
                    description: 图片验证码唯一 ID
                  large:
                    type: string
                    description: 大图 base64
                  small:
                    type: string
                    description: 小图 base64
              examples:
                Example 1:
                  value:
                    han_id: cbd22fa9b421c0f3c0def9524ebbb284
                    large: 'data:image/jpeg;base64,/9j/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBoeVbzQwsxUiKaAKuwkAkPufbjaGJYAFjWMowxEpYPEUVVw+Kozo1Iy0Uqc1aUW1rtflts7PzOilUjHEUZOXxX5l3v37+jPUP2rfB2nQ+ItD+Mvg5XuPBPxks01gFkTyNF8UPbRT3mnXAiHlmS6i2qhYeZJfR3TEl95r5cguZY0xDIRHMhjUFju8vezKj85IwRweMk8Ak5+6/hOuj/ABSNSElKKZ4WIrudCVOaVSElyyjJXjJO++qavumrSi7OLwH/2Q=='
                    small: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAAAoBAMAAADu7x7UAAAAJ1BMVEUAAAAAZgAAXbmqACqHVABuNwHOWIhYZ6aOhEITgrBCMdd9sMY8ugvakvGtMcIed0HL/s+/nU/aOljvG9pE708KAvGDXf1N0mLp34SI+C5VO5qWnwEAAP//onRgJv6mIg8AAAAASUVORK5CYII='
        '400':
          $ref: '#/components/responses/ProblemDetails'
      description: 获取汉字点选验证码
      tags:
        - 登录模块
      security: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                  description: 用户名
                password:
                  type: string
                  format: password
                  description: 密码
              required:
                - username
                - password
    put:
      summary: 校验汉字点选验证码
      operationId: put-login-han
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  dong:
                    type: boolean
                    description: 是否需要咚咚验证码
              examples:
                Example 1:
                  value:
                    dong: true
        '400':
          $ref: '#/components/responses/ProblemDetails'
      tags:
        - 登录模块
      description: '每个汉字点选图片验证码只可以使用 `1` 次，无论点选结果是否验证成功，都不可以二次提交验证。如果验证错误，前端界面请自行请求 [获取汉字点选验证码](post-login-han) 获取新的图片验证码。'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              x-examples:
                Example 1:
                  username: '123321'
                  password: p@33w0Rd
                  han_id: cbd22fa9b421c0f3c0def9524ebbb284
                  points:
                    - x: 12
                      'y': 345
                    - x: 234
                      'y': 127
                    - x: 654
                      'y': 222
              properties:
                username:
                  type: string
                  example: '123321'
                  minLength: 1
                  maxLength: 20
                  description: 用户名
                password:
                  type: string
                  description: 密码
                  format: password
                  example: p@33w0Rd
                  minLength: 6
                  maxLength: 32
                han_id:
                  type: string
                  description: 图片验证码的唯一 ID
                  example: cbd22fa9b421c0f3c0def9524ebbb284
                points:
                  type: array
                  description: 点选坐标信息
                  items:
                    type: object
                    properties:
                      x:
                        type: integer
                        minimum: 0
                        example: 321
                        description: X 轴
                      'y':
                        type: integer
                        minimum: 0
                        example: 214
                        description: Y 轴
                    required:
                      - x
                      - 'y'
              required:
                - username
                - password
                - han_id
                - points
            examples:
              Example 1:
                value:
                  username: '123321'
                  password: p@33w0Rd
                  han_id: cbd22fa9b421c0f3c0def9524ebbb284
                  points:
                    - x: 12
                      'y': 345
                    - x: 234
                      'y': 127
                    - x: 654
                      'y': 222
      security: []
  /login/dong:
    post:
      summary: 获取咚咚验证码
      operationId: post-login-dong
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/ProblemDetails'
      tags:
        - 登录模块
      description: '当 [校验汉字点选验证码](put-login-han) 验证码验证通过后，且返回的字段 `dong` 是 `true` 的时候，说明用户登录需要接收咚咚验证码。调用该接口后该用户的咚咚将会收到一条咚咚登录验证码，一般为 `6 位数字`。'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              x-examples:
                Example 1:
                  username: '123321'
                  password: p@33w0Rd
                  han_id: cbd22fa9b421c0f3c0def9524ebbb284
              properties:
                username:
                  type: string
                  description: 用户名
                  minLength: 1
                  maxLength: 20
                  example: '123321'
                password:
                  type: string
                  description: 密码
                  format: password
                  example: p@33w0Rd
                  minLength: 6
                  maxLength: 32
                han_id:
                  type: string
                  description: 已经校验成功的图片验证码唯一 ID
                  maxLength: 100
                  minLength: 1
                  example: cbd22fa9b421c0f3c0def9524ebbb284
              required:
                - username
                - password
                - han_id
            examples:
              Example 1:
                value:
                  username: '123321'
                  password: p@33w0Rd
                  han_id: cbd22fa9b421c0f3c0def9524ebbb284
      security: []
  /login:
    post:
      summary: 用户登录
      operationId: post-login
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                x-examples:
                  Example 1:
                    id: '28522648801820918'
                    username: '123321'
                    nickname: 李小四
                    token: '28522648801820918'
                    issued_at: '2023-03-30T05:30:01.497Z'
                    lasted_at: '2023-03-30T05:30:01.497Z'
                properties:
                  id:
                    type: string
                    description: 用户 ID
                  username:
                    type: string
                    description: 用户名（用户登录名）
                  nickname:
                    type: string
                    description: 用户昵称
                  token:
                    type: string
                    description: 签发的 Token
                  issued_at:
                    type: string
                    description: 签发时间（当前登录时间）
                  lasted_at:
                    type: string
                    description: session 最近一次活动时间（当前登录时间）
              examples:
                Example 1:
                  value:
                    id: '28522648801820918'
                    username: '123321'
                    nickname: 李小四
                    token: 28522648801320969.crdix0mnpac0.38141bcbc37cfbff98d470b0b969b6c8bc70ccd56d0b3105832673976342b48f
                    issued_at: '2023-03-30T05:30:01.497Z'
                    lasted_at: '2023-03-30T05:30:01.497Z'
        '400':
          $ref: '#/components/responses/ProblemDetails'
      tags:
        - 登录模块
      description: '当 [校验汉字点选验证码](put-login-han) 验证通过后，且 [获取咚咚验证码](post-login-dong) 已经填写（如果需要咚咚验证码的话），则可以调用该接口进行登录操作。'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              x-examples:
                Example 1:
                  username: '123321'
                  password: p@33w0Rd
                  han_id: cbd22fa9b421c0f3c0def9524ebbb284
                  dong: '186618'
              properties:
                username:
                  type: string
                  description: 用户名
                  minLength: 1
                  maxLength: 20
                  example: '123321'
                password:
                  type: string
                  description: 密码
                  format: password
                  minLength: 6
                  maxLength: 32
                  example: p@33w0Rd
                han_id:
                  type: string
                  description: 图片验证码 ID
                  minLength: 1
                  maxLength: 100
                  example: cbd22fa9b421c0f3c0def9524ebbb284
                dong:
                  type: string
                  description: 咚咚收到的验证码（如果有的话）
              required:
                - username
                - password
                - han_id
            examples:
              Example 1:
                value:
                  username: '123321'
                  password: p@33w0Rd
                  han_id: cbd22fa9b421c0f3c0def9524ebbb284
                  dong: '186618'
      security: []
  /logout:
    delete:
      summary: 用户退出登录
      operationId: delete-logout
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/ProblemDetails'
      tags:
        - 登录模块
      description: 用户退出登录
  /minions:
    get:
      summary: 查看节点列表
      tags:
        - Agent
      responses:
        '200':
          description: OK
      operationId: get-minions
      description: 查看节点列表
      parameters:
        - $ref: '#/components/parameters/PageCurrent'
        - $ref: '#/components/parameters/PageSize'
  /minion:
    get:
      summary: 查看节点详情
      tags:
        - Agent
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/ProblemDetails'
      operationId: get-minion
      description: 查看节点详情
      parameters:
        - $ref: '#/components/parameters/ID'
    post:
      summary: 添加节点
      operationId: post-minion
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/ProblemDetails'
      tags:
        - Agent
      description: 添加节点
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                inet:
                  type: string
                  description: 节点 IPv4
                  format: ipv4
                  default: 192.168.1.2
                  example: 192.168.1.2
                goos:
                  type: string
                  description: 节点操作系统
                  enum:
                    - linux
                    - windows
                    - darwin
                    - android
                  example: linux
                arch:
                  type: string
                  description: 节点架构
                  enum:
                    - amd64
                    - '386'
                    - arm64
                    - arm
                  example: amd64
              required:
                - inet
            examples:
              Example 1:
                value:
                  inet: 192.168.1.2
                  goos: linux
                  arch: amd64
  /users:
    get:
      summary: 用户列表查询
      tags:
        - 用户模块
      operationId: get-users
      description: 用户列表查询
      parameters:
        - $ref: '#/components/parameters/PageCurrent'
        - $ref: '#/components/parameters/PageSize'
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/ProblemDetails'
  /user:
    post:
      summary: 添加用户
      operationId: post-user
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/ProblemDetails'
      tags:
        - 用户模块
      description: |
        ## 账户类型（domain 字段）

        - `1`：本地账户，本地账户 `password` 必须填写。

        - `2`：OSS 认证账户，`password` 无需填写。
      requestBody:
        content:
          application/json:
            schema:
              type: object
              x-examples:
                Example 1:
                  username: '123321'
                  nickname: 田丽丽
                  domain: 1
                  password: p@33W0Rd
                  enable: true
              properties:
                username:
                  type: string
                  minLength: 1
                  maxLength: 20
                  example: '123321'
                  description: 用户名
                  default: '123321'
                nickname:
                  type: string
                  example: 曲丽丽
                  default: 曲丽丽
                  minLength: 1
                  maxLength: 20
                  description: 密码
                domain:
                  type: integer
                  enum:
                    - 1
                    - 2
                  example: 1
                  description: 账户类型
                password:
                  description: 用户密码（当本地用户时必须填写）
                  type: string
                enable:
                  type: boolean
                  description: 是否启用该用户
              required:
                - username
                - nickname
                - domain
            examples:
              添加本地账户:
                value:
                  username: '123321'
                  nickname: 曲丽丽
                  domain: 1
                  password: p@33W0Rd
                  enable: true
              添加 OSS 账户（OA 认证）:
                value:
                  username: '123321'
                  nickname: 田丽丽
                  domain: 2
                  enable: true
    delete:
      summary: 删除用户
      operationId: delete-user
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/ProblemDetails'
      tags:
        - 用户模块
      description: 根据 `用户 ID` 删除用户
      parameters:
        - $ref: '#/components/parameters/UserID'
  /user/info:
    get:
      summary: 获取 session
      tags:
        - 用户模块
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                x-examples:
                  Example 1:
                    id: '28522648801820918'
                    username: '123321'
                    nickname: 李小四
                    token: 28522648801320969.crdix0mnpac0.38141bcbc37cfbff98d470b0b969b6c8bc70ccd56d0b3105832673976342b48f
                    issued_at: '2023-03-30T05:30:01.497Z'
                    lasted_at: '2023-03-30T07:12:11.125Z'
                properties:
                  id:
                    type: string
                    description: 用户 ID
                  username:
                    type: string
                    description: 用户名
                  nickname:
                    type: string
                    description: 用户昵称
                  token:
                    type: string
                    description: 用户 Token
                  issued_at:
                    type: string
                    description: Token 签发时间
                  lasted_at:
                    type: string
                    description: 最近一次活动时间
              examples:
                Example 1:
                  value:
                    id: '28522648801820918'
                    username: '123321'
                    nickname: 李小四
                    token: 28522648801320969.crdix0mnpac0.38141bcbc37cfbff98d470b0b969b6c8bc70ccd56d0b3105832673976342b48f
                    issued_at: '2023-03-30T05:30:01.497Z'
                    lasted_at: '2023-03-30T07:12:11.125Z'
        '400':
          $ref: '#/components/responses/ProblemDetails'
      operationId: get-user-info
      description: 获取用户自身 session 信息
  /user/passwd:
    patch:
      summary: 修改密码
      operationId: patch-user-passwd
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/ProblemDetails'
      tags:
        - 用户模块
      description: |-
        - 该接口是用户修改自己的密码，不可以修改他人密码。

        - 仅 `本地用户` 才支持修改密码。
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                original:
                  format: password
                  description: 原来的密码
                  type: string
                password:
                  type: string
                  format: password
                  minLength: 6
                  maxLength: 32
                  description: 新设置的密码
              required:
                - original
                - password
            examples:
              Example 1:
                value:
                  original: P@33w0rd
                  password: Az.0wsd8&
  /oplogs:
    get:
      summary: 查询用户操作日志
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/ProblemDetails'
      operationId: get-oplogs
      tags:
        - 用户日志
      description: 查询用户操作日志
      parameters:
        - $ref: '#/components/parameters/PageCurrent'
        - $ref: '#/components/parameters/PageSize'
        - $ref: '#/components/parameters/filters'
        - $ref: '#/components/parameters/order'
        - $ref: '#/components/parameters/desc'
  '/brr/{broker}/{path}':
    parameters:
      - $ref: '#/components/parameters/broker_id_or_ip'
      - $ref: '#/components/parameters/path'
    get:
      summary: broker http
      tags:
        - 节点调用
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/ProblemDetails'
      operationId: get-brr-broker-path
      description: |
        `broker`：参数可以是 broker 节点的 IP 地址或 ID。

        `path`：路径和 broker 节点程序约定好。

        请求参数与响应参数根据接口来确定。
    post:
      summary: broker http
      operationId: post-brr-broker-path
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/ProblemDetails'
      tags:
        - 节点调用
      description: |-
        `broker`：参数可以是 broker 节点的 IP 地址或 ID。

        `path`：路径和 broker 节点程序约定好。

        请求参数与响应参数根据接口来确定。
    put:
      summary: broker http
      operationId: put-brr-broker-path
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/ProblemDetails'
      description: |-
        `broker`：参数可以是 broker 节点的 IP 地址或 ID。

        `path`：路径和 broker 节点程序约定好。

        请求参数与响应参数根据接口来确定。
      tags:
        - 节点调用
    patch:
      summary: broker http
      operationId: patch-brr-broker-path
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/ProblemDetails'
      description: |-
        `broker`：参数可以是 broker 节点的 IP 地址或 ID。

        `path`：路径和 broker 节点程序约定好。

        请求参数与响应参数根据接口来确定。
      tags:
        - 节点调用
    delete:
      summary: broker http
      operationId: delete-brr-broker-path
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/ProblemDetails'
      description: |-
        `broker`：参数可以是 broker 节点的 IP 地址或 ID。

        `path`：路径和 broker 节点程序约定好。

        请求参数与响应参数根据接口来确定。
      tags:
        - 节点调用
    head:
      summary: broker http
      operationId: head-brr-broker-path
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/ProblemDetails'
      description: |-
        `broker`：参数可以是 broker 节点的 IP 地址或 ID。

        `path`：路径和 broker 节点程序约定好。

        请求参数与响应参数根据接口来确定。
      tags:
        - 节点调用
  '/bws/{broker}/{path}':
    parameters:
      - $ref: '#/components/parameters/broker_id_or_ip'
      - $ref: '#/components/parameters/path'
    get:
      summary: broker websocket
      tags:
        - 节点调用
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/ProblemDetails'
      operationId: get-bws-broker-path
      description: |-
        `broker`：参数可以是 broker 节点的 IP 地址或 ID。

        `path`：路径和 broker 节点程序约定好。

        请求参数与响应参数根据接口来确定。
  '/arr/{minion}/{path}':
    parameters:
      - $ref: '#/components/parameters/minion_id_or_ip'
      - $ref: '#/components/parameters/path'
    get:
      summary: minion(agent) http
      tags:
        - 节点调用
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/ProblemDetails'
      operationId: get-arr-minion-path
      description: |-
        `minion`：参数可以是 minion(agent) 节点的 IP 地址或 ID。

        `path`：路径和 broker 节点程序约定好。

        请求参数与响应参数根据接口来确定。
    post:
      summary: minion(agent) http
      operationId: post-arr-minion-path
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/ProblemDetails'
      tags:
        - 节点调用
      description: |-
        `minion`：参数可以是 minion(agent) 节点的 IP 地址或 ID。

        `path`：路径和 broker 节点程序约定好。

        请求参数与响应参数根据接口来确定。
    put:
      summary: minion(agent) http
      operationId: put-arr-minion-path
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/ProblemDetails'
      tags:
        - 节点调用
      description: |-
        `minion`：参数可以是 minion(agent) 节点的 IP 地址或 ID。

        `path`：路径和 broker 节点程序约定好。

        请求参数与响应参数根据接口来确定。
    patch:
      summary: minion(agent) http
      operationId: patch-arr-minion-path
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/ProblemDetails'
      tags:
        - 节点调用
      description: |-
        `minion`：参数可以是 minion(agent) 节点的 IP 地址或 ID。

        `path`：路径和 broker 节点程序约定好。

        请求参数与响应参数根据接口来确定。
    delete:
      summary: minion(agent) http
      operationId: delete-arr-minion-path
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/ProblemDetails'
      tags:
        - 节点调用
      description: |-
        `minion`：参数可以是 minion(agent) 节点的 IP 地址或 ID。

        `path`：路径和 broker 节点程序约定好。

        请求参数与响应参数根据接口来确定。
    head:
      summary: minion(agent) http
      operationId: head-arr-minion-path
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/ProblemDetails'
      tags:
        - 节点调用
      description: |-
        `minion`：参数可以是 minion(agent) 节点的 IP 地址或 ID。

        `path`：路径和 broker 节点程序约定好。

        请求参数与响应参数根据接口来确定。
  '/aws/{minion}/{path}':
    parameters:
      - $ref: '#/components/parameters/minion_id_or_ip'
      - $ref: '#/components/parameters/path'
    get:
      summary: minion(agent) websocket
      tags:
        - 节点调用
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/ProblemDetails'
      operationId: get-aws-minion-path
      description: |-
        `minion`：参数可以是 minion(agent) 节点的 IP 地址或 ID。

        `path`：路径和 broker 节点程序约定好。

        请求参数与响应参数根据接口来确定。
  /substances:
    get:
      summary: 插件分页查询
      tags:
        - 插件配置
      operationId: get-substances
      description: 插件分页查询
      parameters:
        - $ref: '#/components/parameters/PageCurrent'
        - $ref: '#/components/parameters/PageSize'
        - $ref: '#/components/parameters/Keyword'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  current:
                    type: integer
                    description: 当前页码
                  size:
                    type: integer
                    description: 每页显示条数
                  total:
                    type: integer
                    description: 总条数
                  records:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          description: 插件 ID
                        name:
                          type: string
                          description: 名字
                        icon:
                          type: string
                          description: 图标（Base64 编码）
                        desc:
                          type: string
                          description: 说明
                        created_at:
                          type: string
                          description: 创建时间
                        updated_at:
                          type: string
                          description: 更新时间
              examples:
                Example 1:
                  value:
                    current: 1
                    size: 10
                    total: 2
                    records:
                      - id: '28522653918371849'
                        name: seclog
                        icon: 5pel5b+X
                        desc: 日志回收
                        created_at: '2022-01-06T11:25:45+08:00'
                        updated_at: '2022-04-21T13:46:49+08:00'
                      - id: '71275045937627136'
                        name: linux_secure_logon
                        icon: bWFuZ2Vy
                        desc: centos 6 登录失败日志
                        created_at: '2022-08-16T16:21:35+08:00'
                        updated_at: '2022-09-27T11:20:50+08:00'
        '400':
          $ref: '#/components/responses/ProblemDetails'
  /substance/indices:
    get:
      summary: 配置 index
      tags:
        - 插件配置
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                x-examples:
                  Example 1:
                    data:
                      - id: '28522653918371841'
                        name: dnslog
                        icon: 6YCa55So
                        desc: dnslog服务平台
                        created_at: '2021-12-16T11:48:22+08:00'
                        updated_at: '2023-04-07T16:50:11+08:00'
                      - id: '57102750474190848'
                        name: dns_monitor_linux
                        icon: 6YCa55So
                        desc: linux平台dns监控
                        created_at: '2022-07-08T13:45:57+08:00'
                        updated_at: '2022-09-23T13:33:08+08:00'
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          description: ID
                        name:
                          type: string
                          description: 名字
                        icon:
                          type: string
                          description: 图标（Base64）
                        desc:
                          type: string
                          description: 说明
                        created_at:
                          type: string
                          description: 创建时间
                        updated_at:
                          type: string
                          description: 更新时间
              examples:
                Example 1:
                  value:
                    data:
                      - id: '28522653918371841'
                        name: dnslog
                        icon: 6YCa55So
                        desc: dnslog服务平台
                        created_at: '2021-12-16T11:48:22+08:00'
                        updated_at: '2023-04-07T16:50:11+08:00'
                      - id: '57102750474190848'
                        name: dns_monitor_linux
                        icon: 6YCa55So
                        desc: linux平台dns监控
                        created_at: '2022-07-08T13:45:57+08:00'
                        updated_at: '2022-09-23T13:33:08+08:00'
        '400':
          $ref: '#/components/responses/ProblemDetails'
      operationId: get-substance-indices
      parameters:
        - $ref: '#/components/parameters/PageSize'
        - $ref: '#/components/parameters/Keyword'
      description: 配置 index
  /substance:
    get:
      summary: 查看插件配置详情
      tags:
        - 插件配置
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                x-examples:
                  Example 1:
                    id: '106329155535519744'
                    name: 测试一下下
                    icon: 6YCa55So
                    hash: 1de159548311ee4e12b679f8d4e1c864
                    desc: 嗡嗡嗡
                    chunk: cHJpbnQoMTIp
                    links: null
                    minion_id: '0'
                    version: 0
                    created_id: '28522648801320969'
                    updated_id: '28522648801320969'
                    created_at: '2022-11-21T09:54:06+08:00'
                    updated_at: '2022-11-21T09:54:06+08:00'
                properties:
                  id:
                    type: string
                    description: ID
                  name:
                    type: string
                    description: 名字
                  icon:
                    type: string
                    description: 图标（Base64）
                  hash:
                    type: string
                    description: 哈希
                  desc:
                    type: string
                    description: 说明
                  chunk:
                    type: string
                    description: 配置代理（Base64）
                  links:
                    type: array
                    description: 外链
                    deprecated: true
                    nullable: true
                    items:
                      type: string
                  minion_id:
                    type: string
                    description: 为 0 代表是共有配置，
                  version:
                    type: integer
                  created_id:
                    type: string
                    deprecated: true
                  updated_id:
                    type: string
                    deprecated: true
                  created_at:
                    type: string
                  updated_at:
                    type: string
              examples:
                Example 1:
                  value:
                    id: '106329155535519744'
                    name: 测试一下下
                    icon: 6YCa55So
                    hash: 1de159548311ee4e12b679f8d4e1c864
                    desc: 嗡嗡嗡
                    chunk: cHJpbnQoMTIp
                    links: null
                    minion_id: '0'
                    version: 0
                    created_id: '28522648801320969'
                    updated_id: '28522648801320969'
                    created_at: '2022-11-21T09:54:06+08:00'
                    updated_at: '2022-11-21T09:54:06+08:00'
        '400':
          $ref: '#/components/responses/ProblemDetails'
      operationId: get-substance
      parameters:
        - $ref: '#/components/parameters/ID'
      description: '`minion_id` 为 0 代表是公有配置。非 0 均为私有配置。'
  /alert-server:
    get:
      summary: 获取咚咚告警配置
      tags:
        - 配置参数
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  mode:
                    type: string
                    x-stoplight:
                      id: ujzp6wuu6uw5x
                    description: 发送模式
                    enum:
                      - siem
                      - dong
                    example: dong
                  name:
                    type: string
                    x-stoplight:
                      id: 7kgmiem5pdrr5
                    description: 名字
                    example: 安全应急响应中心
                  url:
                    type: string
                    x-stoplight:
                      id: 7ar432ot19mw4
                    description: 服务器地址
                    example: 'https://send.example.com'
                  token:
                    type: string
                    x-stoplight:
                      id: s1a19lv0vuvev
                    example: 6743dbc7a96dd591cf68375f
                    description: Token
                  account:
                    type: string
                    x-stoplight:
                      id: ccpf6jr0t45sa
                    example: '802563'
                    description: '`dong` 模式时有效'
                  created_at:
                    type: string
                    x-stoplight:
                      id: 0mm8dnlwk3bno
                    example: '2024-12-19T11:47:48.612Z'
                  updated_at:
                    type: string
                    x-stoplight:
                      id: wnpgjgl2teuna
                    example: '2024-12-19T11:47:48.612Z'
                required:
                  - mode
                  - name
                  - url
                  - token
      operationId: get-alert-server
      description: |-
        `mode`: 告警发送渠道

            - `dong`: 通过咚咚服务号发送。

            - `siem`: 通过 SIEM 平台发送。
    post:
      summary: 新增/修改咚咚告警配置
      operationId: post-alert-server
      responses:
        '200':
          description: OK
      tags:
        - 配置参数
      description: 新增/修改咚咚告警配置
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                mode:
                  type: string
                  x-stoplight:
                    id: g5ffqt8q2l5eu
                  description: 发送模式
                  enum:
                    - siem
                    - dong
                  example: siem
                name:
                  type: string
                  x-stoplight:
                    id: n1np6koldikhz
                  description: 名字
                  example: 安全应急响应中心
                  minLength: 1
                  maxLength: 20
                url:
                  type: string
                  x-stoplight:
                    id: 6lkduo1ki4lfz
                  description: 服务器地址
                  example: 'https://send.example.com'
                token:
                  type: string
                  x-stoplight:
                    id: pp6phf060fhf2
                  description: Token
                  example: 6743dbc7a96dd591cf68375f
                account:
                  type: string
                  x-stoplight:
                    id: a1nlmunc4ppik
                  description: 账号，当为`dong`模式时必填。
                  example: '802568'
              required:
                - mode
                - name
                - url
                - token
    delete:
      summary: 删除咚咚告警配置
      operationId: delete-alert-server
      responses:
        '200':
          description: OK
      tags:
        - 配置参数
      description: 删除咚咚告警配置
  /siem-server:
    get:
      summary: 获取SIEM服务器连接参数
      tags:
        - 配置参数
      responses:
        '200':
          description: OK
      operationId: get-siem-server
      description: 获取SIEM服务器连接参数
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  x-stoplight:
                    id: xcbvwvsd7q2v3
                  description: 名字
                  example: 测试名字
                url:
                  type: string
                  x-stoplight:
                    id: g448el60u6cwv
                  description: SIEM服务地址
                  example: 'https://siem.example.com'
                token:
                  type: string
                  x-stoplight:
                    id: kqt5pi6v9q19w
                  description: Token
                  example: secret.xxxxxx
                created_at:
                  type: string
                  x-stoplight:
                    id: 5hhnjxkrld1b5
                updated_at:
                  type: string
                  x-stoplight:
                    id: krchq037f6h3b
    post:
      summary: 新增/修改SIEM服务器连接参数
      operationId: post-siem-server
      responses:
        '200':
          description: OK
      tags:
        - 配置参数
      description: 新增/修改SIEM服务器连接参数
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  x-stoplight:
                    id: t76k68voj3uzs
                  example: 友好的名字
                  description: 名字
                url:
                  type: string
                  x-stoplight:
                    id: ytfvcjy9dxmez
                  description: 地址
                  example: 'https://siem.eastmoney.com'
                token:
                  type: string
                  x-stoplight:
                    id: uwuk0v8u8ck3k
                  description: Token
                  example: secret.xxxxxx
              required:
                - name
                - url
                - token
    delete:
      summary: 删除SIEM服务器连接参数
      operationId: delete-siem-server
      responses:
        '200':
          description: OK
      tags:
        - 配置参数
      description: 删除SIEM服务器连接参数
  /extension-markets:
    get:
      summary: 插件商城-分页搜索插件
      tags:
        - 插件
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                x-examples:
                  Example 1:
                    total: 1
                    current: 1
                    size: 100
                    records:
                      - id: '1'
                        name: shell注入检测
                        category: service
                        intro: 本插件为测试用途
                        deprecated: false
                        latest: 0.0.1
                        latest_at: '2025-01-08T13:28:06.971+08:00'
                        created_at: '2025-01-08T13:28:02.981+08:00'
                        updated_at: '2025-01-08T13:28:09.981+08:00'
                properties:
                  total:
                    type: integer
                  current:
                    type: integer
                  size:
                    type: integer
                  records:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          description: ID
                        name:
                          type: string
                          description: 名字
                        category:
                          type: string
                          description: 类型
                          enum:
                            - service
                            - task
                        intro:
                          type: string
                          description: 简介
                        deprecated:
                          type: boolean
                          description: 是否弃用
                        latest:
                          type: string
                          description: 最新版本
                        latest_at:
                          type: string
                          description: 最新版本发布时间
                        created_at:
                          type: string
                          description: 创建时间
                        updated_at:
                          type: string
                          description: 更新时间
                      required:
                        - id
                        - name
              examples:
                示例:
                  value:
                    total: 1
                    current: 1
                    size: 100
                    records:
                      - id: '1'
                        name: shell注入检测
                        category: service
                        intro: 本插件为测试用途
                        deprecated: false
                        latest: 0.0.1
                        latest_at: '2025-01-08T13:28:06.971+08:00'
                        created_at: '2025-01-08T13:28:02.981+08:00'
                        updated_at: '2025-01-08T13:28:09.981+08:00'
      operationId: get-extension-markets
      description: 分页搜索插件
      parameters:
        - $ref: '#/components/parameters/PageSize'
        - $ref: '#/components/parameters/PageCurrent'
        - $ref: '#/components/parameters/Keyword'
        - schema:
            type: string
            enum:
              - service
              - task
            example: service
          in: query
          name: category
          description: 分类
  /extension-market:
    post:
      summary: 插件商城-添加插件
      operationId: post-extension-market
      responses:
        '200':
          description: OK
      tags:
        - 插件
      description: 注册插件
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  x-stoplight:
                    id: ordp8qeuuzbcw
                  description: 插件名
                  example: Log4J 扫描
                intro:
                  type: string
                  x-stoplight:
                    id: ab75vetvjws3x
                  description: 插件简介
                  maxLength: 1000
                  example: Log4J 扫描吧啦吧啦
                category:
                  type: string
                  x-stoplight:
                    id: uq73cff7lb8xg
                  description: 插件类型
                  example: task
                  enum:
                    - service
                    - task
                content:
                  type: string
                  x-stoplight:
                    id: khwqe3pkijhdg
                  description: 插件Lua代码
                  maxLength: 65535
                  minLength: 1
                  example: print("hello")
                changelog:
                  type: string
                  x-stoplight:
                    id: bw10lxwks6jk8
                  description: 变更日志记录
                  maxLength: 65535
                  example: 本次修复了一些BUG
              required:
                - name
                - category
                - content
    delete:
      summary: 插件商城-删除插件
      operationId: delete-extension-market
      responses:
        '200':
          description: OK
      tags:
        - 插件
      description: 删除插件
      parameters:
        - $ref: '#/components/parameters/ID'
    put:
      summary: 插件商城-修改插件
      operationId: put-extension-market
      responses:
        '200':
          description: OK
      tags:
        - 插件
      description: 修改插件
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: string
                  x-stoplight:
                    id: 8foaqxo9xig8q
                  description: 插件ID
                  example: '123'
                intro:
                  type: string
                  x-stoplight:
                    id: fz7jnsyi6rzq8
                  description: 插件简介
                  example: Log4J 扫描吧啦吧啦
                content:
                  type: string
                  x-stoplight:
                    id: lzy7pfk8hnwe4
                  description: 插件Lua代码
                  example: print("hello")
                changelog:
                  type: string
                  x-stoplight:
                    id: 5dqjktptqp16g
                  maxLength: 65535
                  description: 变更日志
                  example: 本次修复了一些BUG，增强用户体验
              required:
                - id
                - intro
                - content
                - changelog
        description: ''
  /extension-market/records:
    get:
      summary: 插件商城-插件代码变更记录
      tags:
        - 插件
      responses:
        '200':
          description: OK
      operationId: get-extension-market-records
      description: 插件代码变更记录
      parameters:
        - $ref: '#/components/parameters/ID'
  /lua-template/preparse:
    post:
      summary: 解析插件参数
      operationId: post-lua-template-preparse
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                description: 表单样式
                items:
                  x-stoplight:
                    id: w6wpq55jwnazu
                  type: object
      tags:
        - 插件
      description: 解析插件参数
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                content:
                  type: string
                  x-stoplight:
                    id: ji22qthg3r429
                  description: 插件代码
                  minLength: 1
                  maxLength: 65535
              required:
                - content
  /lua-template/prerender:
    post:
      summary: 渲染插件
      operationId: post-lua-template-prerender
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  content:
                    type: string
                    x-stoplight:
                      id: smw4ehdcvsv74
                    description: 代码
                    maxLength: 65535
                    minLength: 1
                  data:
                    type: object
                    x-stoplight:
                      id: xk0qo0l0ev1vp
                    description: 任意参数
                required:
                  - content
      tags:
        - 插件
      description: 渲染插件
  /task-extensions:
    get:
      summary: 任务插件列表
      tags:
        - 插件
      responses:
        '200':
          description: OK
      operationId: get-task-extensions
      description: 任务插件列表
      parameters:
        - $ref: '#/components/parameters/PageCurrent'
        - $ref: '#/components/parameters/PageSize'
        - $ref: '#/components/parameters/Keyword'
    parameters: []
  /task-extension:
    post:
      summary: 创建任务插件
      operationId: post-task-extension
      responses:
        '200':
          description: OK
      tags:
        - 插件
      description: |-
        创建插件时支持两种方式：

        1. 手动编辑 Lua 代码。

        2. 引用插件商城 `task` 插件。

        引用插件商城的任务，不允许修改 content 内容。
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  x-stoplight:
                    id: 808uyljo9inrk
                  maxLength: 100
                  minLength: 1
                  description: 任务名
                  example: 测试插件
                intro:
                  type: string
                  x-stoplight:
                    id: qzgbyl65xm9t2
                  description: 任务简介
                  maxLength: 1000
                  example: 这是一个简单的小插件
                content:
                  type: string
                  x-stoplight:
                    id: 6bp1zpyxlrha3
                  description: 手动编写的插件（引用插件商城时请忽略该参数）
                  maxLength: 65535
                extension_id:
                  type: string
                  x-stoplight:
                    id: kw7jzqpki04w5
                  description: 插件商店的插件ID（引用插件商城时请填写该参数）
              required:
                - name
    parameters: []
    delete:
      summary: 删除任务插件
      operationId: delete-task-extension
      responses:
        '200':
          description: OK
      tags:
        - 插件
      description: 删除任务插件
      parameters:
        - $ref: '#/components/parameters/ID'
  /task-extension/market:
    post:
      summary: 扫描插件-从插件商店创建扫描任务
      operationId: post-task-extension-market
      responses:
        '200':
          description: OK
      description: 从插件商店创建扫描任务
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                extension_id:
                  type: string
                  x-stoplight:
                    id: qbkg4qumy986p
                  description: 插件ID
                  example: '123'
                name:
                  type: string
                  x-stoplight:
                    id: oxoyb4sdigvr0
                  description: 扫描任务名字
                  example: 我是任务名
                intro:
                  type: string
                  x-stoplight:
                    id: s5f0gbaap59o8
                  description: 任务简介
                  maxLength: 1000
                  pattern: 这是一些任务简介
                data:
                  type: object
                  x-stoplight:
                    id: ccgoet5ao8m6r
                  description: 模板渲染参数
              required:
                - extension_id
                - name
                - intro
                - data
      tags:
        - 插件
  /task-extension/code:
    post:
      summary: 扫描插件-创建任务插件（阶段一）
      operationId: post-task-extension-code
      responses:
        '200':
          description: OK
      tags:
        - 插件
      description: |-
        创建任务插件（阶段一）

        `code` 和 `extension_id` 二选一

        `code` 有值代表是手写插件，否则代表从商城勾选的插件。
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  x-stoplight:
                    id: dfkflg6but3a3
                  minLength: 1
                  maxLength: 100
                  example: 我是名字
                  description: 插件名字
                intro:
                  type: string
                  x-stoplight:
                    id: o9d95k8mlcqht
                  example: 这是简介
                  maxLength: 1000
                  description: 插件简介
                code:
                  type: string
                  x-stoplight:
                    id: vw9w89zxlpway
                  minLength: 1
                  maxLength: 65535
                  example: print('HELLO')
                  description: 插件代码
                extension_id:
                  type: string
                  x-stoplight:
                    id: lxhd9xoimm8zn
                  description: 应用商店ID
                  example: '123456789'
                data:
                  type: object
                  x-stoplight:
                    id: sl6qutbe0ebot
                  description: 应用商店来源的参数绑定
              required:
                - name
    patch:
      summary: 扫描插件-修改任务插件（阶段一）
      operationId: patch-task-extension-code
      responses:
        '200':
          description: OK
      tags:
        - 插件
      description: 修改任务插件（阶段一）
      parameters: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: string
                  x-stoplight:
                    id: pby70k00ekz9z
                  example: '123321'
                intro:
                  type: string
                  x-stoplight:
                    id: 3m5r5ewb2rqvr
                  example: 这是简单的简介
                  maxLength: 1000
                code:
                  type: string
                  x-stoplight:
                    id: 9lwvh93bwknde
                  example: print(123)
                extension_id:
                  type: integer
                  x-stoplight:
                    id: 1guujq4x7tu1d
                  example: 123456789
                data:
                  type: object
                  x-stoplight:
                    id: x868w9fddshvq
              required:
                - id
  /task-extension/publish:
    post:
      summary: 扫描插件-创建任务插件（最后阶段）
      operationId: post-task-extension-publish
      responses:
        '200':
          description: OK
      tags:
        - 插件
      description: 创建任务插件（最后阶段）
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  x-stoplight:
                    id: zlpg9nl7kb9b4
                intro:
                  type: string
                  x-stoplight:
                    id: sw3hlxyeg17bh
                code:
                  type: string
                  x-stoplight:
                    id: awvknxzcngxfc
                extension_id:
                  type: string
                  x-stoplight:
                    id: 4d4q8g75f9qu0
                data:
                  type: object
                  x-stoplight:
                    id: csf3dkvp25h4n
                timeout:
                  $ref: '#/components/schemas/Duration'
                cron:
                  $ref: '#/components/schemas/Cron'
                specific_times:
                  type: array
                  x-stoplight:
                    id: bxp5o9iyuz6p5
                  items:
                    x-stoplight:
                      id: khj57mcghur5f
                    type: string
                enabled:
                  type: boolean
                  x-stoplight:
                    id: xz09oocogceza
                push_size:
                  type: integer
                  x-stoplight:
                    id: fn5035sjzno4z
                filters:
                  type: object
                  x-stoplight:
                    id: 4gycimlhmbame
                  properties:
                    inet_mode:
                      x-stoplight:
                        id: tbb01avyg2miw
                      type: boolean
                      description: 是否是主机IP匹配模式
                    inets:
                      type: array
                      x-stoplight:
                        id: 52v20sj4n2dm6
                      description: 主机IP
                      items:
                        x-stoplight:
                          id: x47mkdkes3efo
                        type: string
                    keyword:
                      type: string
                      x-stoplight:
                        id: jhui9ldx8kw0e
                      description: 搜索关键字
                    filters:
                      type: array
                      x-stoplight:
                        id: ypw60lde9ie6s
                      items:
                        x-stoplight:
                          id: lwxao8cxjvo2h
                        type: object
                        properties:
                          key:
                            type: string
                            x-stoplight:
                              id: mxoailh82inkt
                          operator:
                            type: string
                            x-stoplight:
                              id: ml44q7wc3oqbh
                          value:
                            type: string
                            x-stoplight:
                              id: km31251kwpob8
                excludes:
                  type: array
                  x-stoplight:
                    id: waydo83ba93xp
                  items:
                    x-stoplight:
                      id: x8cqlsnwxurjj
                    type: string
        description: ''
    patch:
      summary: 扫描插件-修改任务插件（最后阶段）
      operationId: patch-task-extension-publish
      responses:
        '200':
          description: OK
      tags:
        - 插件
      description: 修改任务插件（最后阶段）
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: string
                  x-stoplight:
                    id: i3juma6yo365c
                intro:
                  type: string
                  x-stoplight:
                    id: y5tfvr3nl05qd
                code:
                  type: string
                  x-stoplight:
                    id: kwb4wr4zc2fto
                extension_id:
                  type: string
                  x-stoplight:
                    id: jsk09a7tsvg6e
                data:
                  type: object
                  x-stoplight:
                    id: y92l2k7jsakl8
                timeout:
                  $ref: '#/components/schemas/Duration'
                cron:
                  $ref: '#/components/schemas/Cron'
                specific_times:
                  type: array
                  x-stoplight:
                    id: e632x6mdybn5q
                  items:
                    x-stoplight:
                      id: 20knm0b8h8t2k
                    type: string
                enabled:
                  type: boolean
                  x-stoplight:
                    id: b347cdr8yn0bv
                push_size:
                  type: number
                  x-stoplight:
                    id: hl8430ffvddnv
                filters:
                  type: object
                  x-stoplight:
                    id: yo9p1rhrdvkjv
                  properties:
                    inet_mode:
                      x-stoplight:
                        id: g7fgaliagfptk
                      type: boolean
                    inets:
                      type: array
                      x-stoplight:
                        id: zaluz0grlqs0d
                      items:
                        x-stoplight:
                          id: 6tvbusdo8l91t
                        type: string
                    keyword:
                      type: string
                      x-stoplight:
                        id: s40g2sthq0axr
                    filters:
                      type: array
                      x-stoplight:
                        id: 1bvmg93bsx5a3
                      items:
                        x-stoplight:
                          id: t4y5grf81qphf
                        type: object
                        properties:
                          key:
                            type: string
                            x-stoplight:
                              id: hcfwja7oqlil4
                          operator:
                            type: string
                            x-stoplight:
                              id: 6xofmqmwchhwd
                          value:
                            type: string
                            x-stoplight:
                              id: edzv6wzylwslq
                excludes:
                  type: array
                  x-stoplight:
                    id: 0gnnp47x2znt0
                  items:
                    x-stoplight:
                      id: qfjm5bpb57pek
                    type: string
  /tag/sidebar:
    get:
      summary: 节点标签-查询节点标签
      tags:
        - Agent
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  x-stoplight:
                    id: n5tqi8jyy47ji
                  type: object
                  properties:
                    name:
                      type: string
                      x-stoplight:
                        id: j111hnrt4ks6o
                      description: 标签
                      example: linux
                    count:
                      type: integer
                      x-stoplight:
                        id: pxn6w1we8vcl1
                      description: 节点数量
                      example: 1
                  required:
                    - name
                    - count
      operationId: get-tag-sidebar
      description: 查询节点标签
      parameters:
        - schema:
            type: boolean
          in: query
          name: ipv4
          description: 是否显示内置IPv4标签
        - schema:
            type: string
          in: query
          name: keyword
          description: 搜索关键字
  /task-executes:
    get:
      summary: 分页查询任务执行记录
      tags:
        - 插件
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties: {}
      operationId: get-task-executes
      description: 分页查询任务执行记录
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/size'
        - $ref: '#/components/parameters/keyword'
  /task-execute:
    delete:
      summary: 删除任务执行记录
      operationId: delete-task-execute
      responses:
        '200':
          description: OK
      description: 删除任务执行记录
      tags:
        - 插件
      parameters:
        - $ref: '#/components/parameters/ID'
  /task-execute/item/cond:
    get:
      summary: 任务执行记录搜索条件
      tags:
        - 插件
      responses:
        '200':
          description: OK
      operationId: get-task-execute-item-cond
      description: 任务执行记录搜索条件
  /task-execute/items:
    get:
      summary: 分页查询任务执行记录的节点列表
      tags:
        - 插件
      responses:
        '200':
          description: OK
      operationId: get-task-execute-items
      description: 分页查询任务执行记录的节点列表
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/size'
        - schema:
            type: integer
            example: 123456
          in: query
          name: task_id
          description: 任务ID
          required: true
        - schema:
            type: integer
            example: 111444555
          in: query
          name: exec_id
          description: 执行ID
          required: true
  /task-execute/item/codes:
    get:
      summary: 查询任务执行记录状态统计
      tags:
        - 插件
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  x-stoplight:
                    id: j256bz01hrzo9
                  type: object
                  properties:
                    code:
                      type: integer
                      x-stoplight:
                        id: et17k5cj6t2qx
                      enum:
                        - 0
                        - 1
                        - 2
                        - 3
                        - 4
                        - 5
                      example: 1
                      description: |-
                        执行状态（枚举值）：
                        - 0-任务下发执行中
                        - 1-manager下发到broker出错
                        - 2-broker下发到agent出错
                        - 3-agent执行错误
                        - 4-agent执行超时
                        - 5-执行成功
                    count:
                      type: integer
                      x-stoplight:
                        id: akrz5cm6f4gyg
                      example: 854
                      description: 状态统计个数
      operationId: get-task-execute-item-codes
      description: 查询任务执行记录状态统计
      parameters:
        - schema:
            type: integer
          in: query
          name: exec_id
          required: true
          description: 执行ID
  /broker/system/exit:
    get:
      summary: 通知代理节点重启
      tags:
        - Broker
      responses:
        '200':
          description: OK
      operationId: get-broker-system-exit
      description: 通知代理节点重启
      parameters:
        - $ref: '#/components/parameters/ID'
  /broker/system/update:
    get:
      summary: 通知代理节点检查升级
      tags:
        - Broker
      responses:
        '200':
          description: OK
          content: {}
      operationId: get-broker-system-update
      description: 通知代理节点检查升级
      parameters:
        - $ref: '#/components/parameters/ID'
        - schema:
            type: string
          in: query
          name: semver
          description: 如果强制更新到指定版本，此处写明版本号
  /brkbin/latest:
    get:
      summary: 获取代理节点最新版本信息
      tags:
        - Broker
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  semver_weight:
                    type: string
                    x-stoplight:
                      id: wdr8skj998yje
                    description: 版本号权重，数字类型，通过比较该数字大小来判断新旧版本
                required:
                  - semver_weight
      operationId: get-brkbin-latest
      description: 获取代理节点最新版本信息
      parameters:
        - schema:
            type: string
            example: linux
            enum:
              - linux
              - windows
              - darwin
          in: query
          name: goos
          description: 操纵系统
          required: true
        - schema:
            type: string
            example: amd64
            enum:
              - amd64
              - arm64
              - '386'
              - arm32
          in: query
          name: arch
          description: 系统架构
          required: true
  /brkbin/supports:
    get:
      summary: 获取中心端二进制支持的系统
      tags:
        - Broker
      responses:
        '200':
          description: OK
      operationId: get-brkbin-supports
      description: 获取中心端二进制支持的系统
  /monbin/supports:
    get:
      summary: 获取客户端二进制支持的系统
      tags:
        - Agent
      responses:
        '200':
          description: OK
      operationId: get-monbin-supports
      description: 获取客户端二进制支持的系统
  /substance/exclude:
    post:
      summary: 节点排除指定配置
      operationId: post-substance-exclude
      responses:
        '200':
          description: OK
      description: 节点排除指定配置
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                minion_id:
                  type: string
                  x-stoplight:
                    id: 41le8s860vahc
                  description: 节点ID
                substance_id:
                  type: string
                  x-stoplight:
                    id: q1gdqi7jl3leq
                  description: 配置ID
              required:
                - minion_id
                - substance_id
      tags:
        - "\U0001F195 新增接口"
  /substance/unexclude:
    post:
      summary: 取消节点排除配置
      operationId: post-substance-unexclude
      responses:
        '200':
          description: OK
      description: 取消节点排除配置
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                minion_id:
                  type: string
                  x-stoplight:
                    id: dqk0t38d1uzs0
                  description: 节点ID
                substance_id:
                  type: string
                  x-stoplight:
                    id: bqyjn90aao4vg
                  description: 配置ID
              required:
                - minion_id
                - substance_id
      tags:
        - "\U0001F195 新增接口"
  /minion/tasks:
    get:
      summary: 查询节点关联的配置
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  unload:
                    type: boolean
                  tasks:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        name:
                          type: string
                        icon:
                          type: string
                        dialect:
                          type: boolean
                        excluded:
                          type: boolean
                        hash:
                          type: string
                        report:
                          type: 'null'
                        created_at:
                          type: string
                        updated_at:
                          type: string
                x-examples:
                  Example 1:
                    unload: false
                    tasks:
                      - id: '468130470839365632'
                        name: debug
                        icon: ZGVidWc=
                        dialect: true
                        excluded: false
                        hash: f60b4dcac50183dca95c6509c035c1a3
                        report: null
                        created_at: '2025-08-15T11:03:21.687Z'
                        updated_at: '2025-09-10T07:43:52.768Z'
                      - id: '477178386283409408'
                        name: table
                        icon: 5pWw5o2u5bqT
                        dialect: true
                        excluded: false
                        hash: eb99b719f64938385cc541d49ae14b88
                        report: null
                        created_at: '2025-09-09T10:16:32.83Z'
                        updated_at: '2025-09-09T10:16:32.83Z'
                      - id: '477825752585908224'
                        name: echo
                        icon: ZGVidWc=
                        dialect: false
                        excluded: true
                        hash: 28f35476af08ba7d170529ec46484b98
                        report: null
                        created_at: '2025-09-11T05:08:56.986Z'
                        updated_at: '2025-09-11T05:08:56.986Z'
              examples:
                示例:
                  value:
                    unload: false
                    tasks:
                      - id: '468130470839365632'
                        name: debug
                        icon: ZGVidWc=
                        dialect: true
                        excluded: false
                        hash: f60b4dcac50183dca95c6509c035c1a3
                        report: null
                        created_at: '2025-08-15T11:03:21.687Z'
                        updated_at: '2025-09-10T07:43:52.768Z'
                      - id: '477178386283409408'
                        name: table
                        icon: 5pWw5o2u5bqT
                        dialect: true
                        excluded: false
                        hash: eb99b719f64938385cc541d49ae14b88
                        report: null
                        created_at: '2025-09-09T10:16:32.83Z'
                        updated_at: '2025-09-09T10:16:32.83Z'
                      - id: '477825752585908224'
                        name: echo
                        icon: ZGVidWc=
                        dialect: false
                        excluded: true
                        hash: 28f35476af08ba7d170529ec46484b98
                        report: null
                        created_at: '2025-09-11T05:08:56.986Z'
                        updated_at: '2025-09-11T05:08:56.986Z'
      operationId: get-minion-tasks
      tags:
        - "\U0001F195 新增接口"
      description: |-
        - 如果节点 `unload` 是静默模式，则所有的 report 应该为 null，否则说明配置不一致。

        - 如果配置 `tasks.$.excluded` 已排除，则对应的 `report` 应该为 null，否则说明配置不一致。

        - 其他情况下，`tasks.$.hash` 必须与 `tasks.$.report.hash` 相等才算配置同步。

        - 注意：如果 `tasks.$.report` 有值，但是 `from != "tunnel"`，说明该配置不是来自于中心端下发，无需逻辑判断，只需原样展示即可。
      parameters:
        - schema:
            type: string
          in: query
          name: id
          description: 节点ID
          required: true
components:
  securitySchemes:
    Authorization:
      name: Authorization
      type: apiKey
      in: header
      description: 所有方法都可以将 Token 带到 Header 中
    authorization:
      name: authorization
      type: apiKey
      in: query
      description: 仅 `GET` 方法可以将 Token 带到查询参数中
  schemas:
    Duration:
      title: Duration
      x-stoplight:
        id: vdox0f29rvke2
      type: object
      description: 时长
      properties:
        days:
          type: integer
          x-stoplight:
            id: 2f148zbdgown0
          description: 天
          example: 1
          minimum: 0
        hours:
          type: integer
          x-stoplight:
            id: g5sgb0lvfozs6
          description: 小时
          example: 3
          minimum: 0
          maximum: 23
        minutes:
          type: integer
          x-stoplight:
            id: xh3vayi0h1pqo
          description: 分钟
          minimum: 0
          maximum: 59
          example: 19
        seconds:
          type: integer
          x-stoplight:
            id: 0i2fgps0gbedj
          description: 秒
          minimum: 0
          maximum: 59
          example: 45
    Cron:
      title: Cron
      x-stoplight:
        id: 5i0xbl85f2l9n
      type: string
      description: cron 表达式（分钟级）。
      example: 0 */6 * * *
  responses:
    ProblemDetails:
      description: 统一错误信息
      content:
        application/json:
          schema:
            type: object
            x-examples:
              Example 1:
                type: manager
                title: 请求错误
                status: 401
                detail: 认证无效
                instance: /api/v1/logout
            properties:
              type:
                type: string
                description: 报错节点类型
              title:
                type: string
                description: 错误标题
              status:
                type: integer
                description: 错误码，一般与 HTTP Status Code 一致
              detail:
                type: string
                description: 错误详情
              instance:
                type: string
                description: 请求 URI
          examples:
            Example 1:
              value:
                type: manager
                title: 参数校验错误
                status: 401
                detail: xxx 必须是邮箱
                instance: /api/v1/logout
  parameters:
    PageCurrent:
      name: current
      in: query
      required: true
      schema:
        type: integer
        example: 1
        minimum: 0
        default: 1
      description: 页码
    PageSize:
      name: size
      in: query
      required: true
      schema:
        type: integer
        example: 10
        minimum: 0
        maximum: 200
        default: 3
      description: 页码显示条数
    UserID:
      name: id
      in: query
      required: true
      schema:
        type: string
        minimum: 1
        example: '28522648801320969'
        maxLength: 20
        minLength: 1
        pattern: '^[0-9]+'
      description: 用户 ID
    ID:
      name: id
      in: query
      required: true
      schema:
        type: string
      description: ID
    broker_id_or_ip:
      name: broker
      in: path
      required: true
      schema:
        type: string
      description: broker 节点的 ID 或 IP
    path:
      name: path
      in: path
      required: true
      schema:
        type: string
      description: 路径
    minion_id_or_ip:
      name: minion
      in: path
      required: true
      schema:
        type: string
      description: minion (agent) 节点的 ID 或 IP
    Keyword:
      name: keyword
      in: query
      required: false
      schema:
        type: string
        maxLength: 100
      description: 搜索关键字
    filters:
      name: filters
      in: query
      required: false
      schema:
        example: '{"col":"name","op":"like","val":"tom"}'
        type: string
      description: 过滤条件
    order:
      name: order
      in: query
      required: false
      schema:
        type: string
      description: 排序条件
    desc:
      name: desc
      in: query
      required: false
      schema:
        type: boolean
      description: 是否倒序，结合 order 使用
    page:
      name: page
      in: query
      required: false
      schema:
        type: integer
        default: 1
        example: 1
        minimum: 0
      description: 页码
    size:
      name: size
      in: query
      required: false
      schema:
        type: integer
        default: 10
        example: 10
        minimum: 0
        maximum: 1000
      description: 每页显示条数
    keyword:
      name: keyword
      in: query
      required: false
      schema:
        type: string
        maxLength: 255
        example: 测试
      description: 模糊搜索关键字
  requestBodies: {}
security:
  - Authorization: []
