"use strict";(self["webpackChunkssoc"]=self["webpackChunkssoc"]||[]).push([[3919,9895],{91938:function(t,e,a){a.d(e,{Z:function(){return p}});var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"icon-body"},[e("el-input",{staticStyle:{position:"relative"},attrs:{clearable:"",placeholder:"请输入图标名称"},on:{clear:t.filterIcons},nativeOn:{input:function(e){return t.filterIcons.apply(null,arguments)}},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}},[e("i",{staticClass:"el-icon-search el-input__icon",attrs:{slot:"suffix"},slot:"suffix"})]),e("div",{staticClass:"icon-list"},t._l(t.iconList,(function(a,i){return e("div",{key:i,on:{click:function(e){return t.selectedIcon(a)}}},[e("svg-icon",{staticStyle:{height:"40px",width:"26px"},attrs:{"icon-class":a}})],1)})),0)],1)},s=[];const o=a(87886),l=t=>t.keys(),r=/\.\/(.*)\.svg/,n=l(o).map((t=>t.match(r)[1]));var c=n,d={name:"IconSelect",data(){return{name:"",iconList:c}},methods:{filterIcons(){this.name?this.iconList=this.iconList.filter((t=>t.includes(this.name))):this.iconList=c},selectedIcon(t){this.$emit("selected",t),document.body.click()},reset(){this.name="",this.iconList=c}}},h=d,u=a(1001),m=(0,u.Z)(h,i,s,!1,null,"4634c9b8",null),p=m.exports},88150:function(t,e,a){a.r(e),a.d(e,{default:function(){return z}});var i=function(){var t=this,e=t._self._c;return e("div",{staticStyle:{width:"100%"}},[e("el-card",[e("el-row",[e("el-col",{attrs:{span:12}},[e("el-input",{staticClass:"input-with-select",staticStyle:{width:"20%"},attrs:{placeholder:"请输入名称",clearable:"",size:"mini"},on:{blur:t.getCode},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.getCode.apply(null,arguments)}},model:{value:t.selectInput,callback:function(e){t.selectInput=e},expression:"selectInput"}}),e("el-button",{staticStyle:{color:"#909399",background:"#f4f4f5","border-color":"#d3d4d6"},attrs:{icon:"el-icon-search",size:"mini"},on:{click:t.getCode}})],1),e("el-col",{staticStyle:{"text-align":"right"},attrs:{span:12}},[e("el-button",{staticStyle:{"margin-left":"0"},attrs:{"el-button":"",type:"success",plain:"",size:"mini"},on:{click:t.addCode}},[t._v("添加")])],1)],1),null!==t.codeData?e("div",{staticClass:"ivu-list-split"},t._l(t.codeData,(function(a){return e("ul",{key:a.id,staticClass:"ivu-list-items"},[e("li",{staticClass:"ivu-list-item"},[e("div",{staticClass:"ivu-list-item-meta"},[e("div",{staticClass:"ivu-list-item-meta-avatar"},[e("span",{staticClass:"ivu-avatar ivu-avatar-square ivu-avatar-image ivu-avatar-large"},[e("svg-icon",{staticClass:"el-input__icon",staticStyle:{height:"42px",width:"32px"},attrs:{slot:"prefix","icon-class":t.iconImg(a.icon)},slot:"prefix"})],1)]),e("div",{staticClass:"ivu-list-item-meta-content"},[e("div",{staticClass:"ivu-list-item-meta-title"},[t._v(t._s(a.desc))]),e("div",{staticClass:"ivu-list-item-meta-description"},[t._v(" "+t._s(a.name)+" ")])])]),e("div",{staticClass:"list-basic-list-content"},[e("div",{staticClass:"list-basic-list-content-item",staticStyle:{width:"240px"}},[e("span",[t._v("开始时间")]),e("p",[t._v(t._s(t._f("date")(a.created_at,"yyyy-MM-dd hh:mm:ss")))])])]),e("ul",{staticClass:"ivu-list-item-action"},[e("li",[e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.edit(a)}}},[t._v("编辑")])],1),e("li",[e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.subDelete(a.id)}}},[t._v("删除")])],1)])])])})),0):t._e(),e("Page",{attrs:{size:t.size,current:t.current,pageSizeArray:t.pageSizeArray,pageTotal:t.pageTotal},on:{handleSizeChange:t.handleSizeChange,handleCurrentChange:t.handleCurrentChange}})],1),e("codeEdit",{ref:"codeEditRef",on:{handleEdit:t.getCode}}),e("AddForm",{ref:"formAdd"})],1)},s=[],o=a(79895),l=a(12037),r=function(){var t=this,e=t._self._c;return e("el-dialog",{staticClass:"code-form",attrs:{"show-close":!1,"close-on-press-escape":!1,"close-on-click-modal":!1,top:"50px","el-dialog":"",visible:t.dialogVisible,"append-to-body":"",width:"70%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("el-form",{ref:"form",staticClass:"formAdd",attrs:{model:t.form,rules:t.rules,"label-width":"40px"}},[e("el-row",[e("el-col",{staticStyle:{margin:"20px 20px"},attrs:{span:5}},[e("el-form-item",{attrs:{label:" ",prop:"chunk"}},[e("el-upload",{ref:"file",staticClass:"upload-demo",attrs:{action:"/","on-remove":t.handleRemove,"before-remove":t.beforeRemove,"on-change":t.filseSuccess,multiple:"",limit:3,"on-exceed":t.handleExceed,"auto-upload":!1}},[e("el-button",{attrs:{size:"mini",type:"primary"}},[t._v("点击上传 chunk")])],1)],1),e("el-form-item",{attrs:{label:"名称",prop:"name"}},[e("el-input",{attrs:{type:"text",size:"mini"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),e("el-form-item",{attrs:{label:"图标",prop:"icon"}},[e("el-popover",{attrs:{placement:"bottom-start",width:"460",trigger:"click"},on:{show:function(e){return t.$refs["iconSelect"].reset()}}},[e("IconSelect",{ref:"iconSelect",on:{selected:t.selected}}),e("el-input",{attrs:{slot:"reference",placeholder:"点击选择图标",size:"mini",readonly:""},slot:"reference",model:{value:t.form.icon,callback:function(e){t.$set(t.form,"icon",e)},expression:"form.icon"}},[t.form.icon?e("svg-icon",{staticClass:"el-input__icon",staticStyle:{height:"42px",width:"16px"},attrs:{slot:"prefix","icon-class":t.form.icon},slot:"prefix"}):e("i",{staticClass:"el-icon-search el-input__icon",attrs:{slot:"prefix"},slot:"prefix"})],1)],1)],1),e("el-form-item",{attrs:{label:"描述",prop:"desc"}},[e("el-input",{attrs:{type:"textarea",placeholder:"请输入描述"},model:{value:t.form.desc,callback:function(e){t.$set(t.form,"desc",e)},expression:"form.desc"}})],1),e("span",{staticStyle:{width:"100%","text-align":"right",display:"inline-block"}},[e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.onSubmit("form")}}},[t._v("提交")])],1)],1),e("div",{staticStyle:{height:"20px","text-align":"right",padding:"5px"}},[e("el-dropdown",{on:{command:t.handleCommand}},[e("span",{staticStyle:{color:"#fff"}},[t._v(" "+t._s(t.editCodeType))]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",{attrs:{command:"vim"}},[t._v("vim")]),e("el-dropdown-item",{attrs:{command:"vscode"}},[t._v("vscode")]),e("el-dropdown-item",{attrs:{command:"sublime"}},[t._v("sublime")])],1)],1),e("i",{staticClass:"fa fa-close",staticStyle:{margin:"0 5px 0 10px",color:"#9e9e9e",cursor:"pointer"},on:{click:function(e){t.dialogVisible=!1}}})],1),e("div",{ref:"generateId",staticClass:"code-editor"})],1)],1),e("div",{attrs:{slot:"title"},slot:"title"})],1)},n=[],c=a(91938),d=a(53239),h=a.n(d),u=(a(83734),a(70790),a(37336),a(58119),a(55259)),m=a.n(u),p=a(6201),f=a.n(p),v=a(72135),g=a.n(v),y=a(69603),b=a.n(y),k=a(74358),C=a.n(k);h().config.setModuleUrl("ace/keyboard/vim",C()),h().config.setModuleUrl("ace/keyboard/sublime",b()),h().config.setModuleUrl("ace/keyboard/vscode",g()),h().config.setModuleUrl("ace/mode/lua_worker",m()),h().config.setModuleUrl("ace/mode/lua_worker",m()),h().config.setModuleUrl("ace/mode/css_worker",f());var _={name:"addForm",components:{IconSelect:c.Z},props:{isAdd:Boolean},data(){return{codeIcon:"",codeName:"",linkArray:[],form:{name:"",icon:"通用",desc:"",links:[],chunk:"",id:""},dialogVisible:!1,linkData:[],dialogValue:"",rules:{},editor:"",editCodeType:"vscode"}},created(){let t=localStorage.getItem("cacheEditCodeType");t&&(this.editCodeType=t)},updated(){var t=this;t.editor=h().edit(this.$refs.generateId,{keyboardHandler:"ace/keyboard/"+this.editCodeType,enableSnippets:!0,enableLiveAutocompletion:!0,enableBasicAutocompletion:!0,mode:"ace/mode/lua",theme:"ace/theme/dracula",fontSize:12,tabSize:4,value:this.dialogValue,selectionStyle:"text'",showLineNumbers:!0,showGutter:!0,showPrintMargin:!0,printMarginColumn:170}),t.editor.getSession().on("change",(function(e){t.form.chunk=t.editor.getValue(this.dialogValue)}))},created(){},methods:{handleCommand(t){this.editCodeType=t,localStorage.setItem("cacheEditCodeType",t),this.editor.blur(),this.editor.setKeyboardHandler("ace/keyboard/"+t)},linkCompare(t){var e=this.linkArray.some((e=>{if(e.id===t.id)return!0}));return e},deleteLink(t){JSON.stringify(this.linkArray);var e=this.linkArray.indexOf(t);this.linkArray.splice(e,1)},pushLink(t){this.linkArray.push(t)},selected(t){this.form.icon=t,this.codeIcon=t},beforeRemove(t,e){return this.$confirm("确定移除 $ { file.name } ？")},filseSuccess(t,e){var a=this;if(t.raw){let e=new FileReader;e.onload=function(t){a.form.chunk=t.target.result},e.readAsText(t.raw)}},handleRemove(t,e){var a=this;a.form.chunk=""},handleExceed(t,e){this.$message.warning(`当前限制选择 3 个文件，本次选择了 ${t.length} 个文件，共选择了 ${t.length+e.length} 个文件`)},handleClose(){this.dialogVisible=!1,this.form={}},onSubmit(t){this.$refs[t].validate((t=>{if(t){let t=a(19575).Base64,i=t.encode(this.form.icon),s=t.encode(this.form.chunk);var e={name:this.form.name,icon:i,desc:this.form.desc,links:this.form.links,chunk:s,id:this.form.id};this.$request.fetchAddCode(e).then((t=>{this.$parent.getCode(),this.dialogVisible=!1,this.editor.setValue(""),this.form={name:"",icon:"kafka",desc:"",links:[],chunk:"",id:""},this.$refs.file.clearFiles(),this.$message({message:"新增成功",type:"success"})})).catch((t=>{this.$message.error(t.data)}))}}))}}},x=_,S=a(1001),w=(0,S.Z)(x,r,n,!1,null,"87a151ec",null),D=w.exports,$=(a(28451),{name:"node",components:{codeEdit:o["default"],Page:l.Z,AddForm:D},data(){return{current:1,size:10,pageTotal:0,pageSizeArray:["10","20","30","40"],codeData:[],isAdd:!0,delLoading:!1,selectInput:""}},created(){this.getCode()},methods:{iconImg:function(t){let e=a(19575).Base64;return e.decode(t)},edit(t){this.$refs.codeEditRef.openTaskDetail({dialect:!1,taskId:t.id})},format(t){return 100===t?"100%":`${t}%`},percentageChange(t,e){return 0===t?0:parseInt(t/e*1e4)/100},customColorMethod(t,e){var a=this.percentageChange(t,e);return a<30?"#67c23a":a<70?"#e6a23c":"#f56c6c"},handleSizeChange(t){this.size=t,this.getCode()},handleCurrentChange(t){this.current=t,this.getCode()},addCode(){this.$nextTick((()=>{const t=this.$refs.formAdd;t.dialogVisible=!0}))},async subDelete(t){try{await this.$confirm("是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch((()=>{throw"取消操作"})),this.delLoading=!0,await this.$request.fetchDeleteCode(t),this.$message({message:"删除成功!!!",type:"success"}),this.getCode()}catch(e){this.$message.error(e||"操作出错")}finally{this.delLoading=!1}},getCode(){var t={current:this.current,size:this.size,keyword:this.selectInput||""};this.$request.fetchGetCode(t).then((t=>{this.codeData=t.data.records,this.pageTotal=t.data.total})).catch((t=>{this.$message.error(t.data)}))},handleEdit(t,e){},handleDelete(t,e){this.$message({showClose:!0,message:t,row:e,type:"success"})},formatter(t,e){return t.address},filterTag(t,e){return e.tag===t},filterHandler(t,e,a){const i=a["property"];return e[i]===t}}}),T=$,I=(0,S.Z)(T,i,s,!1,null,"6fbb875a",null),z=I.exports},79895:function(t,e,a){a.r(e),a.d(e,{default:function(){return m}});var i=function(){var t=this,e=t._self._c;return e("el-drawer",{staticClass:"systemSet",attrs:{visible:t.dialogVisible,"show-close":!1,direction:"rtl","custom-class":"taskEditDrawer","close-on-press-escape":!1,"append-to-body":!0,"close-on-click-modal":!1,"before-close":t.handleClose,size:"90%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[t.dialogVisible?e("div",[e("div",{attrs:{slot:"title"},slot:"title"}),e("el-row",{staticStyle:{"margin-bottom":"5px"}},[e("el-popover",{attrs:{placement:"bottom-start",width:"460",trigger:"click"},on:{show:function(e){return t.$refs["iconSelect"].reset()}}},[e("IconSelect",{ref:"iconSelect",on:{selected:t.iconSelected}}),e("template",{slot:"reference"},[e("span",{staticStyle:{position:"absolute",top:"0",left:"0"}},[t.serverData.icon?e("svg-icon",{staticClass:"iconfont",staticStyle:{"font-size":"23px",transform:"translateY(7px)"},attrs:{"icon-class":t.serverData.icon&&t.Base64.decode(t.serverData.icon)||""}}):e("i",{staticClass:"el-icon-paperclip",staticStyle:{"font-size":"23px",color:"white",transform:"translateY(7px)"}})],1)])],2),e("el-col",{staticStyle:{"padding-left":"26px"},attrs:{span:12}},[e("el-button",{attrs:{type:"text"}},[t._v(" "+t._s(t.serverData.name))]),e("el-button",{attrs:{type:"text"}},[t._v(t._s(!0===t.serverData.dialect?"私有":"公有"))]),e("el-button",{attrs:{type:"text"}},[t._v(t._s(t.serverData.status))]),e("el-button",{attrs:{type:"text"}},[t._v(t._s(t.dateTime(t.serverData.task_at)))]),e("el-button",{attrs:{type:"text"}},[t._v(t._s(t.dateTime(t.serverData.uptime)))])],1),e("el-col",{staticStyle:{"text-align":"right"},attrs:{span:12}},[e("i",{staticClass:"fa fa-code",staticStyle:{"margin-left":"10px",color:"#3d95ff",cursor:"pointer","font-weight":"bold"},attrs:{title:"显示/隐藏代码"},on:{click:t.editCode}}),e("i",{staticClass:"fa fa-refresh",staticStyle:{"margin-left":"10px",color:"#63a35c",cursor:"pointer"},attrs:{title:"刷新"},on:{click:t.refreshCode}}),e("el-popconfirm",{attrs:{title:"确定继续？"},on:{confirm:t.onSubmit}},["startup"!==t.serverData.name?e("i",{staticClass:"fa fa-cloud-upload",staticStyle:{"margin-left":"10px",color:"#3d95ff",cursor:"pointer"},attrs:{slot:"reference",title:"提交"},slot:"reference"}):t._e()]),e("i",{staticClass:"fa fa-undo",staticStyle:{"margin-left":"10px",color:"#3d95ff",cursor:"pointer"},attrs:{title:"重启"},on:{click:t.reloadService}}),e("i",{staticClass:"fa fa-close",staticStyle:{margin:"0 5px 0 10px",color:"#9e9e9e",cursor:"pointer"},attrs:{title:"关闭"},on:{click:function(e){t.dialogVisible=!1}}})],1)],1),e("el-row",[e("el-col",{attrs:{span:19}},[e("el-row",[t.codeShow?e("el-col",{attrs:{span:24}},[e("codeEditor",{staticStyle:{"min-height":"calc(100vh - 200px)"},model:{value:t.dialogValue,callback:function(e){t.dialogValue=e},expression:"dialogValue"}})],1):t._e()],1),e("el-row",{staticStyle:{"margin-top":"10px"}},[e("el-col",{attrs:{span:24}},[e("idlTools",{staticClass:"idlTools",attrs:{minionId:t.minionId}}),e("EventTask",{attrs:{dataTask:t.dataTask}})],1)],1)],1),e("el-col",{staticStyle:{"padding-left":"8px"},attrs:{span:5}},[e("el-card",[e("el-row",[e("el-col",{staticStyle:{"margin-bottom":"10px"}},[e("h3",{staticStyle:{color:"#fff"}},[t._v("任务信息")])]),e("el-col",{staticStyle:{"margin-bottom":"8px"}},[t._v(" 任务名称："+t._s(t.serverData.name)+" ")]),e("el-col",{staticStyle:{"margin-bottom":"8px"}},[t._v(" 外链详情："+t._s(t.nullChange(t.serverData.link))+" ")]),e("el-col",{staticStyle:{"margin-bottom":"8px"}},[t._v(" 本地哈希："+t._s(t.serverData.legal_hash)+" ")]),e("el-col",{staticStyle:{"margin-bottom":"8px"}},[t._v(" 上报哈希："+t._s(t.serverData.actual_hash)+" ")]),e("el-col",{staticStyle:{"margin-bottom":"8px"}},[t._v(" 报错信息："+t._s(t.nullChange(t.serverData.cause))+" ")]),e("el-col",{staticStyle:{"margin-bottom":"20px"}},[t._v(" 描述信息："+t._s(t.nullChange(t.serverData.desc))+" ")])],1),e("el-row",[e("el-col",{staticStyle:{"margin-bottom":"10px"}},[e("h3",{staticStyle:{color:"#fff"}},[t._v("服务信息")])]),t._l(t.serverData.runners,(function(a,i){return e("div",{key:i},[e("el-col",{staticStyle:{"margin-bottom":"5px"}},[e("span",{attrs:{type:"info",size:"mini"}},[t._v("名称："+t._s(a.name))])]),e("el-col",{staticStyle:{"margin-bottom":"5px"}},[e("span",{attrs:{type:"info",size:"mini"}},[t._v("类型："),""!==a.type?e("span",[t._v(t._s(a.type))]):t._e()])]),e("el-col",{staticStyle:{"margin-bottom":"15px"}},[e("span",{attrs:{type:"info",size:"mini"}},[t._v("状态："+t._s(a.status))])])],1)}))],2)],1)],1)],1)],1):t._e()])},s=[],o=a(91938),l=a(99815),r=a(78790);let n=a(19575).Base64;var c={name:"codeEdit",components:{IconSelect:o.Z,idlTools:l.Z,codeEditor:r.Z,EventTask:()=>a.e(8330).then(a.bind(a,68330))},props:{},data(){return{Base64:n,serverData:{},dialogVisible:!1,dialogValue:"",dataTask:{},codeShow:!0,minionId:"",initData:null}},methods:{reloadService(){var t={id:this.dataTask.minion_id,substance_id:this.serverData.id,dialect:this.serverData.dialect};this.$request.fetchPatchReload(t).then((t=>{this.$message.success("重启成功！！"),this.loadData(this.initData)})).catch((t=>{this.$message.error(t.data)}))},dateTime(t){var e=a(30381);return e(t).format("YYYY-MM-DD HH:mm:ss")},refreshCode(){this.loadData(this.initData)},editCode(){this.codeShow=!this.codeShow},nullChange(t){return""!==t&&" "!==t?t:"无"},handleClose(){},async iconSelected(t){try{this.serverData.icon=n.encode(t),await this.savaTask({id:this.serverData.id,icon:this.serverData.icon,chunk:this.serverData.chunk,version:this.serverData.version}),this.$emit("handleEdit",this.dataTask),this.$message.success("切换icon成功"),this.loadData(this.initData)}catch(e){this.$message.error(e||"操作出错")}},async savaTask(t){let e;return e=this.initData.dialect?()=>this.$request.fetchUpdateDialect(t):()=>this.$request.fetchUpdataCode(t),e()},async onSubmit(){try{let e=n.encode(this.dialogValue);var t={id:this.serverData.id,icon:this.serverData.icon,chunk:e,version:this.serverData.version};await this.savaTask(t),this.$message({message:"编辑成功",type:"success"}),this.$emit("handleEdit",this.dataTask),this.loadData(this.initData)}catch(e){this.$message.error(e)}},async loadData({dialect:t,minionId:e,taskId:a=null}){try{let t;t=e?()=>this.$request.fetchdetailDialect(e,a):()=>this.$request.fetchUpdataCodeEdit(a),this.minionId=e;const{data:i}=await t()||{};this.dataTask={minion_id:e,name:i.name,id:i.id},this.dialogValue=n.decode(i.chunk||" "),this.serverData=i||{}}catch(i){this.$message.error(i||"查询出错")}},async openTaskDetail(t){try{this.initData=t,await this.loadData(t),this.dialogVisible=!0}catch(e){this.$message.error(e||"查询出错")}}}},d=c,h=a(1001),u=(0,h.Z)(d,i,s,!1,null,"ec68c5be",null),m=u.exports}}]);