"use strict";(self["webpackChunkssoc"]=self["webpackChunkssoc"]||[]).push([[3384],{12037:function(e,t,a){a.d(t,{Z:function(){return c}});var i=function(){var e=this,t=e._self._c;return t("div",{class:"事件详情"===e.nameShow?"pageClass":"",staticStyle:{height:"20px","padding-top":"10px"}},[t("span",{staticStyle:{display:"inline-block","font-size":"13px","min-width":"35.5px",height:"28px","line-height":"30px","vertical-align":"top","box-sizing":"border-box",float:"right"}},[e._v("共"+e._s(e.pageTotal)+"条")]),t("el-pagination",{staticStyle:{float:"right"},attrs:{background:"",layout:"jumper,sizes,prev, pager, next","page-size":e.size||15,"current-page":e.pageCurrent,total:e.pageTotal,"page-sizes":e.pageSizeArray||[15,30,45]},on:{"update:currentPage":function(t){e.pageCurrent=t},"update:current-page":function(t){e.pageCurrent=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)},r=[],o={name:"page",props:{pageSizeArray:Array,size:Number,pageTotal:Number,current:Number,nameShow:String},data(){return{pageCurrent:this.current}},methods:{handleSizeChange(e){this.$emit("handleSizeChange",e)},handleCurrentChange(e){this.$emit("handleCurrentChange",e)}},watch:{current:function(e){this.pageCurrent=e}}},s=o,l=a(1001),n=(0,l.Z)(s,i,r,!1,null,"277403d7",null),c=n.exports},62476:function(e,t,a){a.d(t,{Z:function(){return x}});var i=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{width:"100%"}},[t("div",{staticClass:"tableHead"},[t("div",{staticStyle:{flex:"1","margin-right":"5px"}},[e._t("right_top_btn")],2),t("span",{staticClass:"icon"},[e.refreshAble?t("i",{staticClass:"el-icon-refresh",attrs:{title:"重加载数据"},on:{click:e.loadData}}):e._e(),e.configAble&&"inhead"!==e.configIconPos?t("i",{class:{"el-icon-setting":!0},attrs:{title:"编辑表格"},on:{click:function(t){e.dialogVisible=!0}}}):e._e()])]),t("div",{staticStyle:{position:"relative"}},[e.configAble&&"inhead"===e.configIconPos?t("i",{staticClass:"el-icon-setting iconInHead",attrs:{title:"编辑表格"},on:{click:function(t){e.dialogVisible=!0}}}):e._e()]),t("el-table",e._g(e._b({ref:"table",staticStyle:{width:"100%"},attrs:{"header-cell-style":e.$attrs["header-cell-style"]||{color:"#909399",textAlign:"center",background:"#f5f7fa"},data:e.showData,stripe:e.stripe},on:{"selection-change":e.selectionChange}},"el-table",e.$attrs,!1),e.$listeners),[e.selection?t("el-table-column",{attrs:{selectable:e.selectable,type:"selection"}}):e._e(),e.index?t("el-table-column",{attrs:{type:"index",label:"序号",align:"center",fixed:"left"}}):e._e(),e._l(e.showColumn,(function(a,i){return[t("el-table-column",{key:i,attrs:{prop:a&&a.prop,label:a&&a.label,width:a&&a.width,"min-width":a&&a["min-width"],fixed:a&&a.fixed,formatter:a&&a.formatter,"show-overflow-tooltip":a&&a["show-overflow-tooltip"]||!1,sortable:a&&a.sortable,"sort-method":a&&a["sort-method"],"sort-by":a&&a["sort-by"],align:a&&a.align||"center","sort-orders":a&&a["sort-orders"],type:a&&a.type,"class-name":a&&a["class-name"]},scopedSlots:e._u([a&&a.slotHeader?{key:"header",fn:function(t){return[e._t(a&&a.slotHeader,null,{row:t.row,col:a,$index:t.$index})]}}:null,a&&a.slot?{key:"default",fn:function(t){return[e._t(a&&a.slot,null,{row:t.row,col:a,$index:t.$index})]}}:null],null,!0)})]}))],2),e.needPagination?t("div",{style:e.paginationStyle},[t("el-pagination",{attrs:{"current-page":e.pagination.pageIndex,"page-sizes":e.pagination.pageSizes||[15,30,50],"page-size":e.pagination.pageSize,layout:e.pagination.layout||"jumper, sizes, prev, pager, next,total",total:e.pagination.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){return e.$set(e.pagination,"pageIndex",t)},"update:current-page":function(t){return e.$set(e.pagination,"pageIndex",t)},"update:pageSize":function(t){return e.$set(e.pagination,"pageSize",t)},"update:page-size":function(t){return e.$set(e.pagination,"pageSize",t)}}})],1):e._e(),t("ColumnConfig",{attrs:{columns:e.filterColumns,visible:e.dialogVisible,selectColumn:e.selectedColumn},on:{"update:visible":function(t){e.dialogVisible=t},"update:selectColumn":function(t){e.selectedColumn=t},"update:select-column":function(t){e.selectedColumn=t}}})],1)},r=[],o=function(){var e=this,t=e._self._c;return t("div",[t("el-dialog",{attrs:{title:"设置需展示的列",visible:e.dialogVisible,width:"800px","append-to-body":""},on:{open:function(t){return e.opened()},"update:visible":function(t){e.dialogVisible=t}}},[t("div",[t("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选")]),t("el-button",{staticStyle:{"text-decoration":"underline",color:"red"},attrs:{type:"text"},on:{click:function(t){return e.$refs.SortColumn.open()}}},[e._v("手动排序")]),t("el-button",{staticStyle:{"text-decoration":"underline",color:"red"},attrs:{type:"text"},on:{click:e.reset}},[e._v("重置配置")]),t("div",{staticStyle:{margin:"15px 0"}}),t("el-checkbox-group",{on:{change:e.handleCheckedCitiesChange},model:{value:e.checkboxSelectBuff,callback:function(t){e.checkboxSelectBuff=t},expression:"checkboxSelectBuff"}},e._l(e.__column,(function(a){return t("el-col",{key:a.columnUUkey,staticClass:"colCheckbox",attrs:{span:8}},[t("el-checkbox",{attrs:{title:a.label,label:a.columnUUkey}},[e._v(e._s(a.label)+" ")])],1)})),1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.confirm}},[e._v("确 定")])],1)]),t("SortColumn",{ref:"SortColumn",attrs:{column:e.__column},on:{close:e.clsoeSort}})],1)},s=[],l=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:"拖动节点进行排序",visible:e.dialogVisible,width:"500px","append-to-body":""},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-tree",{attrs:{data:e.data,"node-key":"columnUUkey","default-expand-all":"",draggable:"","allow-drop":e.allowDrog}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.close}},[e._v("确 定")])],1)],1)},n=[],c={props:{column:{type:Array,require:!0}},data(){return{data:[],dialogVisible:!1}},created(){},methods:{open(){this.dialogVisible=!0,this.data=this.column.map((e=>({columnUUkey:e.columnUUkey,label:e.label})))},close(){this.dialogVisible=!1,this.$emit("close",this.data.map((e=>e.columnUUkey)))},allowDrog(e,t,a){return"inner"!==a}}},d=c,u=a(1001),p=(0,u.Z)(d,l,n,!1,null,null,null),m=p.exports,h={props:{columns:{type:Array,default:()=>[]},visible:{type:Boolean,require:!0,default:!1},selectColumn:{type:Array,default:()=>[]}},components:{SortColumn:m},computed:{dialogVisible:{get(){return this.visible},set(e){this.$emit("update:visible",e)}},checkboxSelect:{get(){return this.selectColumn},set(e){this.$emit("update:selectColumn",e)}},__column(){return this.columns.map((e=>({label:e.label,columnUUkey:e.prop||e.slot}))).sort(((e,t)=>(this.__sortWeight[e.columnUUkey]||0)-(this.__sortWeight[t.columnUUkey]||0)))},__sortWeight(){const e={};for(let t=0;t<this.sortColumnList.length;t++)e[this.sortColumnList[t]]=t;return e}},data(){return{sortColumnList:[],checkAll:!1,isIndeterminate:!1,checkboxSelectBuff:[],oldColumns:[]}},methods:{handleCheckAllChange(e){this.checkboxSelectBuff=e?this.__column.map((e=>e.columnUUkey)):[],this.isIndeterminate=!1},handleCheckedCitiesChange(e){this.checkboxSelectBuff=e;let t=e.length;this.checkAll=t===this.__column.length,this.isIndeterminate=t>0&&t<this.__column.length},opened(){const e=this.__column.filter((e=>!this.oldColumns.includes(e.columnUUkey))).map((e=>e.columnUUkey));this.checkboxSelectBuff=this.checkboxSelectBuff.concat(e).sort(((e,t)=>(this.__sortWeight[e]||0)-(this.__sortWeight[t]||0))),this.oldColumns=this.__column.map((e=>e.columnUUkey)),this.checkAll=this.checkboxSelectBuff.length===this.__column.length,this.isIndeterminate=this.checkboxSelectBuff.length>0&&this.checkboxSelectBuff.length<this.__column.length},clsoeSort(e){this.sortColumnList=this.oldColumns=e||[],this.checkboxSelectBuff=this.checkboxSelectBuff.sort(((e,t)=>(this.__sortWeight[e]||0)-(this.__sortWeight[t]||0)))},reset(){this.sortColumnList=[],this.checkboxSelectBuff=this.__column.map((e=>e.columnUUkey))},confirm(){this.checkboxSelect=this.checkboxSelectBuff,this.sortColumnList=this.oldColumns,this.dialogVisible=!1}}},f=h,g=(0,u.Z)(f,o,s,!1,null,"25f6eb76",null),b=g.exports,_={name:"table_list",components:{ColumnConfig:b},props:{data:{type:Array,required:!0,default:()=>[]},pagination:{type:Object,default:()=>({pageIndex:1,pageSize:15,total:0,pageSizes:[15,30,50],layout:"jumper, sizes, prev, pager, next,total"})},localPaginate:{type:Boolean,default:!1},needPagination:{type:Boolean,default:!0},columns:{required:!0,type:Array,default:()=>[]},index:{type:Boolean,default:!1},selection:{type:Boolean,default:!1},selectable:{type:Function,default:()=>()=>{}},selectCountLimit:{type:Number,default:1e6},checkedData:{type:Array,default:()=>[]},configAble:{type:[Boolean],default:!0},configIconPos:{default:"",type:String},refreshAble:{type:Boolean,default:!1},stripe:{type:Boolean,default:!1}},computed:{paginationStyle(){return{display:"flex","padding-top":"10px","flex-direction":"row","justify-content":"left"===this.pagination.align?"flex-start":"flex-end"}},filterColumns(){return this.columns.filter((e=>e.hidden&&"function"===typeof e.hidden?!e.hidden():!e.hidden))},showColumn(){let e=this.filterColumns;return this.selectedColumn.length&&(e=this.selectedColumn.map((e=>this.filterColumns.find((t=>t.prop===e||t.slot===e)))).filter((e=>!!e))),e.map((e=>({...e,columnUUkey:e.prop||e.slot})))},showData(){if(!this.data||!this.data.length)return[];if(!this.needPagination)return this.data;const e=Math.max(this.pagination.pageSize*(this.pagination.pageIndex-1),0),t=Math.min(this.data.length,e+this.pagination.pageSize);return this.data.length===this.pagination.total?this.data.slice(e,t):this.data},_checkedData:{get(){return this.checkedData},set(e){this.$emit("update:checkedData",e)}}},data(){return{selectedColumn:[],dialogVisible:!1}},watch:{data:{handler(e,t){this.resetSelect(),this.localPaginate&&(this.pagination.total=this.data&&this.data.length||0)},immediate:!0},filterColumns(){this.selectedColumn=[]}},mounted(){this.resetSelect()},methods:{loadData(){this.$emit("loadData")},reload(){this.pagination.pageIndex=1,this._checkedData=[],this.$emit("loadData")},selectionChange(e,t){if(e&&e.length>this.selectCountLimit){this.$refs.table.clearSelection();for(let t=0;t<this.selectCountLimit;t++)this.$refs.table.toggleRowSelection(e[e.length-t-1],!0)}else this._checkedData=e},resetSelect(){if(this.$refs.table){this.$refs.table.clearSelection();for(let e of this.data)for(let t of this._checkedData)JSON.stringify(e)===JSON.stringify(t)&&this.$refs.table.toggleRowSelection(e,!0)}},handleSizeChange(){this.localPaginate||(this.pagination.pageIndex=1,this.loadData())},handleCurrentChange(){!this.localPaginate&&this.loadData()}}},y=_,v=(0,u.Z)(y,i,r,!1,null,"6202e7cb",null),x=v.exports},53384:function(e,t,a){a.r(t),a.d(t,{default:function(){return ee}});var i=function(){var e=this,t=e._self._c;return t("div",[t("el-card",{staticClass:"contentCard_",staticStyle:{position:"relative"}},[t(e.componentId,{tag:"component",scopedSlots:e._u([{key:"prefix",fn:function(){return[t("el-radio-group",{staticStyle:{"margin-right":"5px",transform:"translateY(-1px)"},attrs:{size:"mini"},on:{input:e.input},model:{value:e.componentId,callback:function(t){e.componentId=t},expression:"componentId"}},[t("el-radio-button",{attrs:{label:"room"}},[e._v("链接中心")]),t("el-radio-button",{attrs:{label:"cert"}},[e._v("证书管理")]),t("el-radio-button",{attrs:{label:"client"}},[e._v("安装包")])],1)]},proxy:!0}])})],1)],1)},r=[],o=function(){var e=this,t=e._self._c;return t("div",[t("div",[e._t("prefix"),t("el-button",{staticStyle:{"margin-left":"0"},attrs:{type:"primary",size:"mini"},on:{click:e.addRelation}},[e._v("添加 ")])],2),t("el-table",{staticStyle:{width:"100%","margin-top":"5px"},attrs:{data:e.roomData,"header-cell-style":{color:"#909399",textAlign:"center",background:"#f5f7fa"}}},[t("el-table-column",{attrs:{prop:"status",label:"状态",width:"70"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{type:!0===a.row.status?"success":"danger",size:"mini"}},[e._v(" "+e._s(!0===a.row.status?"在线":"离线")+" ")])]}}])}),t("el-table-column",{attrs:{prop:"name",label:"名称",width:"175"}}),t("el-table-column",{attrs:{label:"证书名称",width:"175"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.$jumpTo({path:"/brkbin",query:{page:"cert",keyword:a.certificate&&a.certificate.name}},"证书管理")}}},[e._v(" "+e._s(a.certificate&&a.certificate.name)+" ")])]}}])}),t("el-table-column",{attrs:{prop:"name",label:"证书过期时间",width:"225"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[a.certificate?t("div",[t("span",[e._v(e._s(a.certificate&&a.certificate.not_after&&e.moment(a.certificate.not_after).format("YYYY-MM-DD HH:mm:ss")))]),e.isDeadLing(a.certificate.not_after)?t("el-tag",{attrs:{size:"mini",type:"danger"}},[e._v(" 临近过期 ")]):e._e()],1):e._e()]}}])}),t("el-table-column",{attrs:{label:"端点"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticStyle:{width:"95%",margin:"0 auto","text-align":"left"}},[t("p",[e._v(" vip: "),e._l(a.row.vip,(function(a,i){return t("el-tag",{key:i,staticStyle:{"margin-right":"5px"},attrs:{size:"mini"}},[e._v(" "+e._s(a)+" ")])}))],2),t("p",[e._v(" lan: "),e._l(a.row.lan,(function(a,i){return t("el-tag",{key:i,staticStyle:{"margin-right":"5px"},attrs:{size:"mini"}},[e._v(" "+e._s(a)+" ")])}))],2)])]}}])}),t("el-table-column",{attrs:{prop:"servername",label:"服务名称"}}),t("el-table-column",{attrs:{prop:"updated_at",label:"最后一次心跳时间",width:"175"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("date")(t.row.updated_at,"yyyy-MM-dd hh:mm:ss"))+" ")]}}])}),t("el-table-column",{attrs:{label:"操作",width:"100",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.editRoom(a.row)}}},[e._v("编辑")]),t("el-popconfirm",{attrs:{"confirm-button-text":"确认","cancel-button-text":"取消",icon:"el-icon-info","icon-color":"red",title:"确定删除？"},on:{confirm:function(t){return e.delCode(a.row)}}},[t("el-button",{attrs:{slot:"reference",type:"text",size:"mini"},slot:"reference"},[e._v("删除")])],1)]}}])})],1),t("RoomForm",{ref:"room",on:{getRooms:e.getRooms}})],1)},s=[],l=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{visible:e.roomShow,title:"add"===e.form.operateType?"添加链接":"编辑链接",width:"30%"},on:{"update:visible":function(t){e.roomShow=t}}},[t("el-form",{ref:"form",attrs:{model:e.form,"label-width":"95px"}},[t("el-form-item",{attrs:{label:"名称"}},[t("el-input",{attrs:{size:"small"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),t("el-form-item",{attrs:{label:"bind"}},[t("el-input",{attrs:{size:"small"},model:{value:e.form.bind,callback:function(t){e.$set(e.form,"bind",t)},expression:"form.bind"}})],1),t("el-form-item",{attrs:{label:"servername"}},[t("el-input",{attrs:{size:"small"},model:{value:e.form.servername,callback:function(t){e.$set(e.form,"servername",t)},expression:"form.servername"}})],1),t("el-form-item",{attrs:{label:"lan"}},[t("el-input",{attrs:{type:"textarea",rows:2,placeholder:"每行输入一个（域名或ip），例10.224.111.162:1433"},model:{value:e.form.lanStr,callback:function(t){e.$set(e.form,"lanStr",t)},expression:"form.lanStr"}})],1),t("el-form-item",{attrs:{label:"vip"}},[t("el-input",{attrs:{type:"textarea",rows:2,placeholder:"每行输入一个（域名或ip），例10.224.111.162:1433"},model:{value:e.form.vipStr,callback:function(t){e.$set(e.form,"vipStr",t)},expression:"form.vipStr"}})],1),t("el-form-item",{attrs:{label:"证书"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{clearable:""},model:{value:e.form.cert_id,callback:function(t){e.$set(e.form,"cert_id",t)},expression:"form.cert_id"}},e._l(e.certList,(function(e,a){return t("el-option",{key:a,attrs:{label:e.name,value:e.id}})})),1)],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.submit()}}},[e._v("提交")])],1)],1)},n=[],c=a(9669),d=a.n(c);class u{constructor(e){this.operateType=e?.operateType||"add",this.name=e?.name,this.bind=e?.bind,this.servername=e?.servername,this.lan=e?.lan,this.vip=e?.vip,this.id=e?.id,this.lanStr=this.lan?.join("\n")||"",this.vipStr=this.vip?.join("\n")||"",this.cert_id=e?.cert_id}formatter(){return{...this,lan:this.lanStr?this.lanStr?.split("\n"):[],vip:this.vipStr?this.vipStr?.split("\n"):[],cert_id:this.cert_id||null}}}var p={name:"formRoom",data(){return{roomShow:!1,isAdd:!0,lanText:"",vipText:"",form:new u,certList:[]}},created(){this.loadCertList()},methods:{openDialog(e){this.form=new u(e),this.roomShow=!0},async submit(){try{await this.$refs.form.validate().catch((()=>{throw"请检查必填项"})),""!==this.lanText&&(this.form.lan=this.lanText.split("\n")),""!==this.vipText&&(this.form.vip=this.vipText.split("\n")),"add"===this.form.operateType?await this.$request.fetchAddRooms(this.form.formatter()):await d().patch("/broker",this.form.formatter()),this.$message({message:"提交成功",type:"success"}),this.$emit("getRooms"),this.roomShow=!1}catch(e){this.$message.error(e)}},async loadCertList(){try{const{data:e}=await d().get("/cert/indices");this.certList=e||[]}catch(e){this.$message.error(e)}}}},m=p,h=a(1001),f=(0,h.Z)(m,l,n,!1,null,"2153b45c",null),g=f.exports,b=(a(28451),a(30381)),_=a.n(b),y={name:"index",components:{RoomForm:g},data(){return{moment:_(),delLoading:!1,roomData:[]}},mounted(){this.getRooms()},methods:{isDeadLing(e){return _()(e).subtract(1,"months")<_()()},getRooms(){this.$request.fetchGetRooms().then((e=>{this.roomData=e.data.records}))},addRoom(){this.$refs.room?.openDialog()},editRoom(e){this.$refs.room?.openDialog({operateType:"edit",...e})},async delCode(e){try{await d()({url:"/broker",method:"delete",data:{id:e.id}}),this.$message({message:"删除成功!!!",type:"success"}),this.getRooms()}catch(t){this.$message.error(t)}},addRelation(){var e=this.$refs.room;e.roomShow=!0}}},v=y,x=(0,h.Z)(v,o,s,!1,null,"1a861165",null),w=x.exports,k=function(){var e=this,t=e._self._c;return t("div",[t("tableList",{ref:"tableListRef",attrs:{columns:e.columns,data:e.tableData,refreshAble:"",pagination:e.pagination},on:{loadData:e.loadData,"row-click":e.openInfo},scopedSlots:e._u([{key:"right_top_btn",fn:function(){return[e._t("prefix"),t("el-button",{staticStyle:{"margin-right":"3px"},attrs:{size:"mini",type:"primary"},on:{click:e.add}},[e._v("添加")]),t("el-input",{staticStyle:{width:"200px","margin-right":"3px"},attrs:{clearable:"",placeholder:"请输入名称",size:"mini"},on:{blur:e.reload},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.reload.apply(null,arguments)}},model:{value:e.form.keyword,callback:function(t){e.$set(e.form,"keyword",t)},expression:"form.keyword"}}),t("el-button",{staticStyle:{color:"#909399",background:"#f4f4f5","border-color":"#d3d4d6"},attrs:{icon:"el-icon-search",size:"mini"},on:{click:e.reload}})]},proxy:!0},{key:"operate",fn:function({row:a}){return[t("el-button",{staticStyle:{"margin-right":"5px"},attrs:{type:"text"},on:{click:function(t){return t.stopPropagation(),e.edit(a)}}},[e._v("编辑")]),t("el-popconfirm",{attrs:{title:"确定删除吗？"},on:{confirm:function(t){return e.deleteItem(a)}}},[t("el-button",{staticStyle:{color:"red"},attrs:{slot:"reference",type:"text"},on:{click:function(e){e.stopPropagation()}},slot:"reference"},[e._v("删除")])],1)]}}],null,!0)}),t("detail",{ref:"detailRef",on:{reload:e.loadData}}),t("info",{ref:"infoRef"})],1)},S=[],C=a(62476),D=a(90023),$=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{visible:e.dialogVisible,title:"add"===e.form.operateType?"新增":"编辑",width:"800px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{ref:"formRef",attrs:{model:e.form}},[t("el-form-item",{attrs:{label:"名称",prop:"name",rules:e.required}},[t("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),t("el-form-item",{attrs:{label:"证书",rules:e.required,prop:"certificate"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:7}},model:{value:e.form.certificate,callback:function(t){e.$set(e.form,"certificate",t)},expression:"form.certificate"}})],1),t("el-form-item",{attrs:{label:"私钥",rules:e.required,prop:"private_key"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:7}},model:{value:e.form.private_key,callback:function(t){e.$set(e.form,"private_key",t)},expression:"form.private_key"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.onSubmit()}}},[e._v(e._s("add"===e.form.operateType?"创建":"修改"))])],1)],1)},z=[];class I{constructor(e){this.operateType=e?.operateType||"add",this.id=e?.id,this.name=e?.name,this.certificate=e?.certificate,this.private_key=e?.private_key}}var R={data(){return{dialogVisible:!1,form:new I,required:{required:!0,message:"请检查必填项",trigger:["blur","change"]}}},methods:{async onSubmit(){try{await this.$refs.formRef.validate().catch((()=>{throw"检查必填项"})),await d()("/cert",{method:"add"===this.form.operateType?"post":"put",data:this.form}),this.$message.success("操作成功"),this.$emit("reload"),"add"===this.form.operateType&&(this.dialogVisible=!1)}catch(e){this.$message.error(e)}},open(e,t={}){this.form=new I({operateType:e,...t}),this.dialogVisible=!0}}},Y=R,T=(0,h.Z)(Y,$,z,!1,null,"1caba977",null),M=T.exports,A=function(){var e=this,t=e._self._c;return t("div",[t("el-drawer",{attrs:{withHeader:!1,visible:e.visible,direction:"rtl",size:"60%"},on:{"update:visible":function(t){e.visible=t}}},[t("el-descriptions",{attrs:{border:"",column:1}},[t("el-descriptions-item",{attrs:{label:"ID"}},[e._v(e._s(e.certData.id))]),t("el-descriptions-item",{attrs:{label:"名称"}},[e._v(e._s(e.certData.name))]),t("el-descriptions-item",{attrs:{label:"证书",span:2}},[t("pre",{staticStyle:{"overflow-y":"auto","max-height":"200px"},domProps:{textContent:e._s(e.certData.certificate)}})]),t("el-descriptions-item",{attrs:{label:"私钥",span:2}},[t("pre",{staticStyle:{"overflow-y":"auto","max-height":"200px"},domProps:{textContent:e._s(e.certData.private_key)}})]),t("el-descriptions-item",{attrs:{label:"证书版本"}},[e._v(e._s(e.certData.version))]),t("el-descriptions-item",{attrs:{label:"颁发者国家"}},[e._v(e._s(e.certData.iss_country))]),t("el-descriptions-item",{attrs:{label:"颁发者省份"}},[e._v(e._s(e.certData.iss_province))]),t("el-descriptions-item",{attrs:{label:"颁发者组织"}},[e._v(e._s(e.certData.iss_org))]),t("el-descriptions-item",{attrs:{label:"颁发者"}},[e._v(e._s(e.certData.iss_cn))]),t("el-descriptions-item",{attrs:{label:"颁发者组织单位"}},[e._v(e._s(e.certData.iss_org_unit))]),t("el-descriptions-item",{attrs:{label:"主题国家"}},[e._v(e._s(e.certData.sub_country))]),t("el-descriptions-item",{attrs:{label:"主题组织"}},[e._v(e._s(e.certData.sub_org))]),t("el-descriptions-item",{attrs:{label:"主题省份"}},[e._v(e._s(e.certData.sub_province))]),t("el-descriptions-item",{attrs:{label:"主题"}},[e._v(e._s(e.certData.sub_cn))]),t("el-descriptions-item",{attrs:{label:"dns_names"}},[e._v(e._s(e.certData.dns_names))]),t("el-descriptions-item",{attrs:{label:"ip_addresses"}},[e._v(e._s(e.certData.ip_addresses))]),t("el-descriptions-item",{attrs:{label:"email_addresses"}},[e._v(e._s(e.certData.email_addresses))]),t("el-descriptions-item",{attrs:{label:"URL"}},[e._v(e._s(e.certData.uris))]),t("el-descriptions-item",{attrs:{label:"证书生效时间"}},[e._v(e._s(e.certData.not_before&&e.moment(e.certData.not_before).format("YYYY-MM-DD HH:mm:ss")))]),t("el-descriptions-item",{attrs:{label:"证书过期时间"}},[e._v(e._s(e.certData.not_after&&e.moment(e.certData.not_after).format("YYYY-MM-DD HH:mm:ss")))]),t("el-descriptions-item",{attrs:{label:"创建时间"}},[e._v(e._s(e.certData.created_at&&e.moment(e.certData.created_at).format("YYYY-MM-DD HH:mm:ss")))]),t("el-descriptions-item",{attrs:{label:"更新时间"}},[e._v(e._s(e.certData.updated_at&&e.moment(e.certData.updated_at).format("YYYY-MM-DD HH:mm:ss")))])],1)],1)],1)},U=[],L={data(){return{moment:_(),visible:!1,certData:{id:null,name:null,certificate:null,private_key:null,version:null,iss_country:[],iss_province:[],iss_org:[],iss_cn:null,iss_org_unit:[],sub_country:[],sub_org:[],sub_province:[],sub_cn:null,dns_names:[],ip_addresses:[],email_addresses:[],uris:[],not_before:null,not_after:null,created_at:null,updated_at:null}}},methods:{open(e){this.certData=e,this.visible=!0}}},q=L,B=(0,h.Z)(q,A,U,!1,null,"7af28e22",null),H=B.exports,P={components:{tableList:C.Z,detail:M,info:H},data(){return{form:{keyword:this.$route?.query.keyword||""},tableData:[],columns:[{label:"ID",prop:"id",width:"200px"},{label:"名称",prop:"name"},{label:"版本",prop:"version",width:80},{label:"颁发者",prop:"iss_cn"},{label:"主题",prop:"sub_cn"},{label:"证书生效时间",prop:"not_before",width:"150px",formatter(e){return e.not_before&&_()(e.not_before).format("YYYY-MM-DD HH:mm:ss")}},{label:"证书过期时间",prop:"not_after",width:"150px",formatter(e){return e.not_after&&_()(e.not_after).format("YYYY-MM-DD HH:mm:ss")}},{label:"创建时间",prop:"created_at",width:"150px",formatter(e){return e.created_at&&_()(e.created_at).format("YYYY-MM-DD HH:mm:ss")}},{label:"更新时间",prop:"updated_at",width:"150px",formatter(e){return e.updated_at&&_()(e.updated_at).format("YYYY-MM-DD HH:mm:ss")}},{label:"操作",fixed:"right",width:"120px",slot:"operate"}],pagination:{pageIndex:1,pageSize:15,total:0}}},created(){this.loadData()},methods:{reload(){this.pagination.pageIndex=1,this.loadData()},async loadData(){try{this.$router.replace({path:this.$route.path,query:{keyword:this.form.keyword}}).catch((()=>{}));const{data:e}=await D.Z.get("/certs",{params:{keyword:this.form.keyword,current:this.pagination.pageIndex,size:this.pagination.pageSize}});this.tableData=e?.records,this.pagination.total=e?.total||0}catch(e){this.$message.error(e)}},add(){this.$refs.detailRef.open("add")},edit(e){this.$refs.detailRef.open("edit",e)},async deleteItem(e){try{await D.Z.delete("/cert",{data:{id:e.id}}),this.$message.success("操作成功"),this.loadData()}catch(t){this.$message.error(t)}},openInfo(e){this.$refs.infoRef.open(e)}}},V=P,Z=(0,h.Z)(V,k,S,!1,null,"9bb205de",null),E=Z.exports,N=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{width:"100%"}},[t("div",[e._t("prefix"),t("el-button",{staticStyle:{"margin-left":"0","margin-right":"3px"},attrs:{"el-button":"",type:"primary",size:"mini"},on:{click:function(t){return e.uploadClick("新增")}}},[e._v("添加 ")]),t("el-input",{staticClass:"input-with-select",staticStyle:{width:"20%","margin-right":"3px"},attrs:{placeholder:"请输入名称",size:"mini"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getTableData.apply(null,arguments)}},model:{value:e.selectInput,callback:function(t){e.selectInput=t},expression:"selectInput"}}),t("el-button",{staticStyle:{color:"#909399",background:"#f4f4f5","border-color":"#d3d4d6"},attrs:{icon:"el-icon-search",size:"mini"},on:{click:e.getTableData}})],2),t("el-table",{staticClass:"tableCell",staticStyle:{width:"100%","margin-top":"5px"},attrs:{data:e.agentData,"cell-style":{padding:"0px"},"header-cell-style":{color:"#909399",textAlign:"center",background:"#f5f7fa"}}},[t("el-table-column",{attrs:{prop:"name",label:"名称",width:"180"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-badge",{staticClass:"item",attrs:{value:!0===a.row.deprecated?"已过期":"",type:"warning"}},[t("el-button",{attrs:{size:"small",type:"text"}},[e._v(" "+e._s(a.row.name))])],1)]}}])}),t("el-table-column",{attrs:{prop:"goos",label:"平台",width:"150"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row?t("span"):e._e(),t("svg",{staticClass:"iconTabel",attrs:{"aria-hidden":"true"}},[t("use",{attrs:{"xlink:href":"linux"===a.row.goos?"#icon-linux1":"windows"===a.row.goos?"#icon-Windows1":"#icon-pingguo"}})]),e._v(" "+e._s(a.row.goos)+" ")]}}])}),t("el-table-column",{attrs:{prop:"arch",label:"arch",width:"100"}}),t("el-table-column",{attrs:{prop:"semver",label:"版本",width:"130"}}),t("el-table-column",{attrs:{prop:"created_at",label:"创建时间",width:"170"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("date")(t.row.created_at,"yyyy-MM-dd hh:mm:ss"))+" ")]}}])}),t("el-table-column",{attrs:{prop:"updated_at",label:"更新时间",width:"170"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("date")(t.row.updated_at,"yyyy-MM-dd hh:mm:ss"))+" ")]}}])}),t("el-table-column",{attrs:{prop:"changelog",label:"更新日志"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-popover",{attrs:{placement:"top-start",width:"300",trigger:"hover"}},[t("pre",[e._v(e._s(a.changelog))]),t("div",{staticClass:"changelogBox",attrs:{slot:"reference"},slot:"reference"},[e._v(" "+e._s(a.changelog)+" ")])])]}}])}),t("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"text",size:"mini"},on:{click:function(t){return e.fileDownload(a.row)}}},[e._v("下载")]),t("el-popover",{ref:a.row.id,attrs:{placement:"top",width:"200"}},[t("p",[e._v("确定删除?")]),t("div",{staticStyle:{"text-align":"right",margin:"0"}},[t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){e.$refs[a.row.id].doClose()}}},[e._v("取消")]),t("el-button",{attrs:{loading:e.delLoading,type:"primary",size:"mini"},on:{click:function(t){return e.subDelete(a.row.id)}}},[e._v("确定 ")])],1),t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{slot:"reference",type:"text",size:"mini"},slot:"reference"},[e._v("删除")])],1)]}}])})],1),t("Page",{attrs:{size:e.size,current:e.current,pageTotal:e.pageTotal,pageSizeArray:e.pageSizeArray},on:{handleSizeChange:e.handleSizeChange,handleCurrentChange:e.handleCurrentChange}}),t("el-dialog",{attrs:{"before-close":e.handleClose,"el-dialog":"","close-on-click-modal":!1,visible:e.fileShow,title:!0===e.upShow?"新增":"上传","append-to-body":"",width:"500px"},on:{"update:visible":function(t){e.fileShow=t},open:e.dialogOpen,close:e.dialogClose}},[t("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,size:"small","label-width":"100px"}},[t("el-form-item",{attrs:{label:"文件名",prop:"name"}},[t("el-input",{attrs:{type:"text",size:"mini"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),t("el-form-item",{attrs:{label:"版本",prop:"semver"}},[t("el-input",{attrs:{type:"text",size:"mini"},model:{value:e.form.semver,callback:function(t){e.$set(e.form,"semver",t)},expression:"form.semver"}})],1),t("el-form-item",{attrs:{label:"操作系统",prop:"goos"}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.form.goos,callback:function(t){e.$set(e.form,"goos",t)},expression:"form.goos"}},e._l(e.paltformList,(function(e,a){return t("el-option",{key:a,attrs:{value:e,label:e}})})),1)],1),t("el-form-item",{attrs:{label:"系统架构",prop:"arch"}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.form.arch,callback:function(t){e.$set(e.form,"arch",t)},expression:"form.arch"}},e._l(e.archData,(function(e){return t("el-option",{key:e.label,attrs:{value:e.value,label:e.label}})})),1)],1),t("el-form-item",{attrs:{label:"文件",prop:"file"}},[t("el-upload",{ref:"file",staticClass:"upload-demo",attrs:{action:"/","on-remove":e.handleRemove,"before-remove":e.beforeRemove,"on-change":e.filseSuccess,limit:1,accept:"windows"===e.form.goos?".exe":"","on-exceed":e.handleExceed,"auto-upload":!1}},[t("el-button",{attrs:{size:"small",icon:"el-icon-upload"}},[e._v("点击上传")])],1)],1),t("el-form-item",{attrs:{label:"版本更新日志",prop:"changelog"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:2},placeholder:"请输入内容"},model:{value:e.form.changelog,callback:function(t){e.$set(e.form,"changelog",t)},expression:"form.changelog"}})],1)],1),e.showProgress?t("el-progress",{attrs:{percentage:e.percentageformat}}):e._e(),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.fileShow=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onSubmit("form")}}},[e._v("提交")])],1)],1),t("el-dialog",{attrs:{visible:e.downShow,title:"下载安装包",width:"300px"},on:{"update:visible":function(t){e.downShow=t}}},[t("div",{staticStyle:{display:"flex"}},[t("el-select",{staticStyle:{flex:"1","margin-right":"3px"},attrs:{size:"mini","value-key":"id"},on:{change:e.seletRoom},model:{value:e.selectData,callback:function(t){e.selectData=t},expression:"selectData"}},e._l(e.roomData,(function(e){return t("el-option",{key:e.id,attrs:{value:e,label:e.name}})})),1),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.downFile}},[e._v("下载")])],1),t("button",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"},{name:"clipboard",rawName:"v-clipboard:copy",value:e.copyvalue,expression:"copyvalue",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:e.firstCopySuccess,expression:"firstCopySuccess",arg:"success"},{name:"clipboard",rawName:"v-clipboard:error",value:e.copyError,expression:"copyError",arg:"error"}],ref:"copyvalueRef",staticStyle:{display:"inline-block"}})])],1)},F=[],O=a(12037),j={components:{Page:O.Z},data(){return{archData:[{value:"386",label:"386"},{value:"amd64",label:"amd64"}],paltformList:["linux","windows","darwin"],downShow:!1,copyvalue:"",roomData:[],selectData:{},editionId:"",activeData:{},current:1,size:10,pageTotal:0,agentData:[],isAdd:!0,delLoading:!1,agentList:[],selectInput:"",fileShow:!1,form:{name:"",goos:"",file:"",arch:"",semver:"",changelog:""},rules:{file:[{required:!0,message:"请上传文件",trigger:"change"}],semver:[{required:!0,message:"请输入版本",trigger:"blur"}],name:[{required:!0,message:"请输入文件名",trigger:"blur"}],arch:[{required:!0,message:"请输入系统架构",trigger:"change"}],goos:[{required:!0,message:"请输入操作系统",trigger:"blur"}]},value:"",pageSizeArray:[10,20,30,40],upShow:!1,percentage:0,showProgress:!1,timer:null}},computed:{percentageformat(){return Math.min(100,+Number(this.percentage).toFixed(1))}},created(){this.getTableData()},beforeDestroy(){clearInterval(this.timer)},methods:{firstCopySuccess(){this.$message.success("内容已复制到剪切板！")},onSubmit(){let e=new FormData;e.append("name",this.form.name),e.append("file",this.form.file),e.append("semver",this.form.semver),e.append("goos",this.form.goos),e.append("arch",this.form.arch),e.append("changelog",this.form.changelog),this.showProgress=!0,this.percentage=0,clearInterval(this.timer),this.timer=setInterval((()=>{this.percentage<30?this.percentage+=.3:this.percentage<80?this.percentage+=50/150:this.percentage<90?this.percentage+=.1:this.percentage<98?this.percentage+=.04:this.percentage+=.004,this.percentage>=100&&clearInterval(this.timer)}),100),d().post("/brkbin",e).then((e=>{this.$message({message:"添加成功!!!",type:"success"}),this.fileShow=!1,this.form={},this.$refs.file.clearFiles(),this.getTableData()})).catch((e=>{this.$message.error(e.data)})).finally((()=>{this.showProgress=!1}))},uploadClick(e){"新增"!==e?(this.form=e,this.upShow=!1):this.upShow=!0,this.fileShow=!0},handleClose(){this.form={},this.fileShow=!1},fileDownload(e){this.activeData=e,this.editionId=e.id,this.downShow=!0,this.$request.fetchGetIndices().then((e=>{this.roomData=e.data}))},downFile(){if(this.selectData.id){console.log(this.selectData.id,this.editionId);const e="/api/v1",t=`${e}/brkbin?id=${this.editionId}&broker_id=${this.selectData.id}&authorization=${localStorage.getItem("token")}`;window.open(t,"_blank")}else this.$message.error("请选择")},seletRoom(){this.$request.fetchGetLan().then((e=>{this.value=e.data.scheme+"://"+e.data.addr+"/api/v1/deploy/minion?goos="+this.activeData.goos+"&broker_id="+this.selectData.id+"&arch="+this.activeData.arch}))},filseSuccess(e,t){this.form.file=e.raw},handleRemove(e,t){var a=this;a.form.file=""},beforeRemove(e,t){return this.$confirm(`确定移除 ${e.name} ？`)},handleExceed(e,t){this.$message.warning(`当前限制选择 3 个文件，本次选择了 ${e.length} 个文件，共选择了 ${e.length+t.length} 个文件`)},subDelete(e){this.$refs[e].doClose();var t=this;t.delLoading=!0,d()["delete"]("/brkbin",{data:{id:e}}).then((e=>{t.$message({message:"删除成功!!!",type:"success"}),t.delLoading=!1,t.getTableData()})).catch((e=>{this.$message.error(e.data)}))},deprecate(e){this.$refs[e.id+2].doClose();var t=this;this.$request.fetchDeprecate({id:e.id}).then((e=>{t.$message({message:"标记成功!!!",type:"success"}),t.getTableData()})).catch((e=>{this.$message.error(e.data)}))},getTableData(){var e={current:this.current,size:this.size,keyword:this.selectInput};d().get("/brkbins",{params:e}).then((e=>{this.agentData=e.data.records,this.pageTotal=e.data.total})).catch((e=>{this.$message.error(e.data)}))},percentageChange(e,t){return 0===e?0:parseInt(e/t*1e4)/100},customColorMethod(e,t){var a=this.percentageChange(e,t);return a<30?"#67c23a":a<70?"#e6a23c":"#f56c6c"},handleSizeChange(e){this.size=e,this.getTableData()},handleCurrentChange(e){this.current=e,this.getTableData()},handleDelete(e,t){this.$message({showClose:!0,message:e,row:t,type:"success"})},copyError(e){console.error(e)},dialogOpen(){this.showProgress=!1,this.percentage=0,clearInterval(this.timer)},dialogClose(){this.showProgress=!1,this.percentage=0,clearInterval(this.timer)}}},W=j,G=(0,h.Z)(W,N,F,!1,null,"22a8d662",null),J=G.exports,K={components:{client:J,room:w,cert:E},data(){return{componentId:"room"}},watch:{$route(){const{page:e}=this.$route.query||{};["room","cert","client"].includes(e)&&(this.componentId=e)}},methods:{input(){this.$router.push({path:this.$route.path})}}},Q=K,X=(0,h.Z)(Q,i,r,!1,null,"01b7751e",null),ee=X.exports},28451:function(e,t,a){var i=a(20144);i["default"].filter("date",(function(e,t){var a=new Date(e),i={"M+":a.getMonth()+1,"d+":a.getDate(),"h+":a.getHours(),"m+":a.getMinutes(),"s+":a.getSeconds(),"q+":Math.floor((a.getMonth()+3)/3),S:a.getMilliseconds()};for(var r in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length))),i)new RegExp(`(${r})`).test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?i[r]:("00"+i[r]).substr((""+i[r]).length)));return t}))}}]);