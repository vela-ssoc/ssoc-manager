"use strict";(self["webpackChunkssoc"]=self["webpackChunkssoc"]||[]).push([[9826],{24861:function(e,t,a){a.d(t,{Z:function(){return v}});var i=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{display:"flex","flex-wrap":"wrap","align-items":"center"}},[e._t("prefix"),e._l(e.tabs,(function(a,i){return t("el-popover",{key:i,attrs:{"popper-class":"filterOptionsPopover",placement:e.placement,width:"280",trigger:"click"},on:{show:function(t){return e.popovershow(i)}},scopedSlots:e._u([{key:"reference",fn:function(){return[t("span",[0===i?t("el-button",{staticClass:"buttonsearch",staticStyle:{"margin-right":"3px"},attrs:{size:"mini"}},[e._t("textSlot",(function(){return[e._v("添加条件")]}))],2):[t("span",{key:i,staticStyle:{margin:"2px","font-size":"12px",color:"#fff",padding:"3px","border-radius":"3px","background-color":"#409eff",display:"inline-block"},on:{click:function(t){return e.editTag(t,a,i-1)}}},[e._v(" "+e._s(a.keyDesc)+" "+e._s(a.operatorDesc)+" "+e._s(a.valueDesc)+" "),a.clearable?t("i",{staticClass:"el-icon-close",staticStyle:{cursor:"pointer"},on:{click:function(t){return t.stopPropagation(),e.delTag(a,i-1)}}}):e._e()])]],2)]},proxy:!0}],null,!0),model:{value:a.show,callback:function(t){e.$set(a,"show",t)},expression:"item.show"}},[t("el-form",{ref:"formRef",refInFor:!0,attrs:{model:e.form,"label-position":"right","label-width":"70px"}},[t("el-form-item",{attrs:{label:"关键字",prop:"key",rules:e.required}},[t("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",size:"mini"},on:{change:e.selectField},model:{value:e.form.key,callback:function(t){e.$set(e.form,"key",t)},expression:"form.key"}},e._l(e.options,(function(e,a){return t("el-option",{key:a,attrs:{value:e.key,label:e.desc}})})),1)],1),t("el-form-item",{attrs:{label:"操作符",prop:"operator",rules:e.required}},[t("el-select",{staticStyle:{width:"100%"},attrs:{size:"mini"},model:{value:e.form.operator,callback:function(t){e.$set(e.form,"operator",t)},expression:"form.operator"}},e._l(e.selectFieldDerive.operatorArray,(function(e,a){return t("el-option",{key:a,attrs:{value:e.key,label:e.desc}})})),1)],1),t("el-form-item",{attrs:{label:"值",rules:e.required,prop:"value"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:["datetime","time"].includes(e.selectFieldDerive.valueType),expression:"['datetime', 'time'].includes(selectFieldDerive.valueType)"}],on:{click:function(e){e.stopPropagation()}}},[t("el-date-picker",{ref:"dateRef",refInFor:!0,staticStyle:{width:"100%"},attrs:{clearable:"","popper-class":"filterDate",teleported:!1,"append-to-body":!1,type:"datetime",pickerOptions:e.pickerOptions,placeholder:"选择时间",size:"mini"},model:{value:e.form.value,callback:function(t){e.$set(e.form,"value",t)},expression:"form.value"}})],1),["datetime","time"].includes(e.selectFieldDerive.valueType)?e._e():[e.selectFieldDerive.isEnum?t("el-select",{staticStyle:{width:"100%"},attrs:{size:"mini",clearable:"",multiple:"in"===e.form.operator||"notin"===e.form.operator,"collapse-tags":""},model:{value:e.form.value,callback:function(t){e.$set(e.form,"value",t)},expression:"form.value"}},e._l(e.selectFieldDerive.valueArray,(function(e,a){return t("el-option",{key:a,attrs:{value:e.key,label:e.desc}})})),1):[e.suggestOptions&&e.suggestOptions[e.form.key]?t("el-autocomplete",{staticStyle:{width:"100%"},attrs:{size:"mini","fetch-suggestions":e.querySearch,clearable:""},model:{value:e.form.value,callback:function(t){e.$set(e.form,"value",t)},expression:"form.value"}}):t("el-input",{staticStyle:{width:"100%"},attrs:{size:"mini",clearable:""},model:{value:e.form.value,callback:function(t){e.$set(e.form,"value",t)},expression:"form.value"}})]]],2),t("el-form-item",[t("el-button",{staticClass:"buttonsearch",attrs:{size:"mini"},on:{click:function(t){return e.confirm(i)}}},[e._v("确定")])],1)],1)],1)}))],2)},o=[],s=a(30381),r=a.n(s);class n{constructor(e){this.key=e?.key,this.operator=e?.operator,this.value=e?.value}}const l=r()().startOf("days"),c=r()().startOf("days").subtract(1,"days"),d=r()().startOf("days").subtract(7,"days"),u=r()().startOf("days").subtract(15,"days"),h=r()().startOf("days").subtract(30,"days"),p={[l]:"今天",[c]:"昨天",[d]:"七天前",[u]:"十五天前",[h]:"三十天前"};var f={props:{value:{type:Array,default:()=>[]},options:{default:()=>[]},placement:{default:"top"},initData:{type:Object,default:null},suggestOptions:{default:()=>({})},multiCondition:{default:!0}},created(){},mounted(){},data(){return{moment:Object.freeze(r()),form:new n,show:!1,editIdx:-1,pickerOptions:{disabledDate(e){return e.getTime()>Date.now()},shortcuts:[{text:"今天",onClick(e){e.$emit("pick",l)}},{text:"昨天",onClick(e){e.$emit("pick",c)}},{text:"七天前",onClick(e){e.$emit("pick",d)}},{text:"十五天前",onClick(e){e.$emit("pick",u)}},{text:"三十天前",onClick(e){e.$emit("pick",h)}}]},required:{required:!0,message:"请检查必填项",trigger:["blur","change"]}}},computed:{filters:{get(){return this.value?.map((e=>this.getSelectItem(e)))},set(e){this.$emit("input",e),this.$emit("change",e)}},selectFieldDerive(){var e=this.options.findIndex((e=>e.key===this.form.key));return{operatorArray:this.options?.[e]?.operators||[],isEnum:this.options?.[e]?.enum,valueArray:this.options?.[e]?.enums||[],valueType:this.options?.[e]?.type}},tabs(){return[{show:!1},...this.filters]}},methods:{querySearch(e,t){var a=this.suggestOptions?.[this.form.key],i=e?a.filter((t=>-1!==String(t).toLowerCase().indexOf(e.toLowerCase()))):a;t(i.map((e=>({value:e}))))},selectField(e){this.form.value=null,this.$nextTick((()=>{this.form.operator=this.selectFieldDerive.operatorArray.some((e=>"like"===e.key))?"like":this.selectFieldDerive.operatorArray?.[0]?.key}))},selectOperator(e){this.form.value=null},async confirm(e){try{if(await(this.$refs.formRef?.[e].validate().catch((()=>{throw"请检查必填项"}))),this.show=!1,this.editIdx>=0&&this.editIdx<this.filters.length){const e=this.filters||[];e[this.editIdx]=this.valueDecode(Object.assign(e[this.editIdx],this.form)),this.filters=[...e],this.editIdx=-1}else this.pushFilter(this.form)}catch(t){this.$message.warning(t)}},valueDecode(e){const t=this.options?.find((t=>t.key===e.key));return t.enum&&e.value&&("in"===e.operator||"notin"===e.operator)&&Array.isArray(e.value)?{...e,value:e.value.join(",")}:{...e}},valueEncode(e){const t=this.options?.find((t=>t.key===e.key));return t?.enum&&e.value&&("in"===e.operator||"notin"===e.operator)&&(e.value=e.value?.split(",")||e.value),e},pushFilter(e){const t=this.filters||[],a=t.findIndex((t=>t.key===e.key)),i=t[a];e=this.valueDecode(e),i?(null===e.value||void 0===e||""===e?t.splice(a,1):Object.assign(i,e),this.filters=[...t]):null!==e.value&&void 0!==e&&""!==e&&(!this.multiCondition&&t.length>0&&(t.length=0),this.filters=[...t,{...e}])},getSelectItem({key:e,operator:t,value:a,clearable:i=!0,disabled:o=!1}){const s=this.options?.find((t=>t.key===e)),n=s?.operators,l=s?.enums||[],c=()=>{const i=this.valueEncode({key:e,operator:t,value:a})?.value;if("time"===s?.type){const e=r()(a);return e in p?p[e]:e.format("YYYY-MM-DD HH:mm:ss")}return s?.enum?"in"===t||"notin"===t?i?.map((e=>l.find((t=>t.key===e))?.desc))?.join(",")||i:l.find((e=>e.key===i))?.desc:a};return{key:e,keyDesc:s?.desc,value:a,valueDesc:c(),show:!1,valueType:s?.type,operator:t,clearable:i,disabled:o,operatorDesc:n?.find((e=>e.key===t))?.desc}},delTag(e,t){const a=this.filters||[];a.splice(t,1),this.filters=a},editTag(e,t,a){t.disabled?e.stopPropagation():(this.editIdx=a,this.form=new n(this.valueEncode(t)))},popovershow(e){this.$refs.dateRef[e].placement="right"}}},m=f,g=a(1001),y=(0,g.Z)(m,i,o,!1,null,"980cc6ea",null),v=y.exports},12037:function(e,t,a){a.d(t,{Z:function(){return c}});var i=function(){var e=this,t=e._self._c;return t("div",{class:"事件详情"===e.nameShow?"pageClass":"",staticStyle:{height:"20px","padding-top":"10px"}},[t("span",{staticStyle:{display:"inline-block","font-size":"13px","min-width":"35.5px",height:"28px","line-height":"30px","vertical-align":"top","box-sizing":"border-box",float:"right"}},[e._v("共"+e._s(e.pageTotal)+"条")]),t("el-pagination",{staticStyle:{float:"right"},attrs:{background:"",layout:"jumper,sizes,prev, pager, next","page-size":e.size||15,"current-page":e.pageCurrent,total:e.pageTotal,"page-sizes":e.pageSizeArray||[15,30,45]},on:{"update:currentPage":function(t){e.pageCurrent=t},"update:current-page":function(t){e.pageCurrent=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)},o=[],s={name:"page",props:{pageSizeArray:Array,size:Number,pageTotal:Number,current:Number,nameShow:String},data(){return{pageCurrent:this.current}},methods:{handleSizeChange(e){this.$emit("handleSizeChange",e)},handleCurrentChange(e){this.$emit("handleCurrentChange",e)}},watch:{current:function(e){this.pageCurrent=e}}},r=s,n=a(1001),l=(0,n.Z)(r,i,o,!1,null,"277403d7",null),c=l.exports},59826:function(e,t,a){a.r(t),a.d(t,{default:function(){return k}});var i=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{width:"100%"}},[t("el-row",{directives:[{name:"show",rawName:"v-show",value:e.topEchartShow,expression:"topEchartShow"}],staticStyle:{"margin-bottom":"10px"},attrs:{gutter:10}},[t("el-col",{attrs:{span:10}},[t("el-card",[t("div",{staticClass:"terminal",style:{float:"left",width:"100%",height:"200px"},attrs:{id:"terminals"}})])],1),t("el-col",{attrs:{span:10}},[t("el-card",[t("div",{staticClass:"client",style:{float:"left",width:"100%",height:"200px"},attrs:{id:"client"}})])],1),t("el-col",{staticStyle:{"text-align":"center"},attrs:{span:4}},[t("el-card",{staticStyle:{height:"220px"}},[t("div",{staticStyle:{"font-size":"12px",color:"#86909c","margin-bottom":"8px"}},[e._v(" 未安装终端 ")]),t("div",{staticStyle:{"font-size":"26px",color:"#1a2233","font-family":"ByteNumber Bold"}},[e._v(" 0 ")])])],1)],1),t("el-card",{staticClass:"contentCard_"},[t("el-row",[t("el-col",{staticStyle:{display:"flex"},attrs:{span:16}},[t("filterOption",{ref:"selectSearchRef",attrs:{options:e.condData.conditions||[],suggestOptions:e.suggestOptions},on:{change:e.searchBasic},scopedSlots:e._u([{key:"prefix",fn:function(){return[t("div",{staticClass:"buttonsearch_2",staticStyle:{margin:"0 5px 0 0"},attrs:{size:"mini"},on:{click:function(t){e.tagShow=!e.tagShow}}},[t("i",{class:e.tagShow?"el-icon-s-unfold":"el-icon-s-fold",staticStyle:{"font-size":"27px",color:"#939597"}})]),t("el-input",{staticStyle:{width:"300px",margin:"0 5px 0 -2px"},attrs:{size:"mini",placeholder:"输入关键字过滤",clearable:""},on:{blur:e.keywordSearch},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.keywordSearch.apply(null,arguments)}},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}}),t("el-button",{staticClass:"buttonsearch",attrs:{size:"mini"},on:{click:e.searchBasic}},[t("div",{staticStyle:{margin:"0 5px"}},[t("i",{staticClass:"el-icon-search"})])])]},proxy:!0}]),model:{value:e.filters,callback:function(t){e.filters=t},expression:"filters"}})],1),t("el-col",{staticStyle:{"text-align":"right"},attrs:{span:8}},[t("el-dropdown",{staticStyle:{float:"right"},attrs:{trigger:"click"}},[t("el-button",{attrs:{"el-button":"",type:"primary",plain:"",size:"mini"}},[e._v(" 批量操作"),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.actionType,(function(a,i){return t("el-dropdown-item",{key:i,nativeOn:{click:function(t){return e.bulkClick(a)}}},[e._v(" "+e._s(a)+" ")])})),1)],1),t("el-button",{staticStyle:{float:"right",margin:"0 5px"},attrs:{type:"primary",plain:"",size:"mini"},on:{click:e.sheetode}},[e._v("导出"),t("i",{staticClass:"el-icon-upload2 el-icon--right"})]),t("el-upload",{ref:"file",staticClass:"upload-demo",staticStyle:{float:"right"},attrs:{action:"/","on-remove":e.handleRemove,"before-remove":e.beforeRemove,"on-change":e.filseSuccess,"show-file-list":!1,accept:".json,.txt","on-exceed":e.handleExceed,"auto-upload":!1}},[t("el-button",{attrs:{icon:"el-icon-upload",type:"primary",plain:"",size:"mini"}},[e._v("CMDB导入")])],1),t("el-button",{staticStyle:{float:"right","margin-right":"5px"},attrs:{type:"success",plain:"",size:"mini"},on:{click:e.echartShow}},[e._v(" "+e._s(!0===e.topEchartShow?"隐藏图表":"显示图表")+" ")])],1)],1),t("div",{staticStyle:{display:"flex","margin-top":"5px",width:"100%"}},[e.tagShow?t("div",{staticClass:"leftBox"},[t("div",{staticStyle:{"font-size":"14px",cursor:"pointer"},on:{click:function(t){return e.leftItemClick(null)}}},[t("i",{staticClass:"el-icon-caret-right",staticStyle:{color:"#939597"}}),e._v(" 全部 ")]),e._l(e.tags,(function(a,i){return t("div",{key:i,class:{tagItem:!0,tagItemActive:a.label===e.curtag},staticStyle:{"margin-left":"4px"},on:{click:function(t){return e.leftItemClick(a.label)}}},[t("span",{staticStyle:{display:"inline-block",width:"4px",transform:"translateY(-2px)",height:"4px","background-color":"#86909c","border-radius":"50%"}}),e._v(" "+e._s(a.label)+" "),t("span",{staticStyle:{color:"#a8acb1","font-size":"14px"}},[e._v("("+e._s(a.count)+")")])])}))],2):e._e(),t("div",{style:e.tagShow?"width: calc(100% - 150px)":"width:100%"},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.nodeData,"header-cell-style":{color:"#909399",background:"#f5f7fa"}},on:{"row-click":e.detailClick,"selection-change":e.selectionChange}},[t("el-table-column",{attrs:{prop:"inet",label:"终端IP",width:"150"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("div",{on:{click:function(e){e.stopPropagation()}}},[e._v(" "+e._s(a.inet)+" ")])]}}])}),t("el-table-column",{attrs:{prop:"tags",label:"标签",width:"350"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticStyle:{display:"flex","align-items":"center"}},[t("svg-icon",{staticClass:"iconfont",staticStyle:{height:"36px",width:"22px",float:"left"},attrs:{"icon-class":"linux"===a.row.goos?"linux":"windows"===a.row.goos?"Windows":"apple"}}),t("span",{},[t("el-tag",{attrs:{size:"mini",type:3===a.row.status?"success":1===a.row.status?"warning":2===a.row.status?"info":"danger"}},[e._v(" "+e._s(3===a.row.status?"在线":1===a.row.status?"未激活":2===a.row.status?"离线":"已删除")+" ")]),a.row.deleted?t("el-tag",{attrs:{size:"mini",type:"danger"}},[e._v("已删除")]):e._e(),!a.row.deleted&&a.row.unload?t("el-tag",{attrs:{size:"mini"}},[e._v("静默中")]):e._e(),null!==a.row.tags?t("span",{staticStyle:{"margin-left":"5px"}},[t("span",[e._l(e.ipRe(a.row.tags,a.row.goos).slice(0,3),(function(a,i){return t("el-tag",{key:i,attrs:{size:"mini"}},[e._v(" "+e._s(a))])})),e.ipRe(a.row.tags,a.row.goos).length>3?t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"right"}},[t("el-tag",{attrs:{size:"mini",type:"info"}},[e._v(" + "+e._s(e.ipRe(a.row.tags).length))]),t("div",{attrs:{slot:"content"},slot:"content"},e._l(e.ipRe(a.row.tags),(function(a,i){return t("span",{key:i,staticStyle:{"padding-right":"15px"}},[e._v(e._s(a)),t("br")])})),0)],1):e._e()],2)]):e._e()],1)],1)]}}])}),t("el-table-column",{attrs:{prop:"edition",label:"版本",width:"120"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("div",[a.customized?t("el-tag",{attrs:{size:"mini",type:"info"}},[e._v(" "+e._s(a.customized)+" ")]):e._e(),e._v(" "+e._s(a.edition)+" ")],1)]}}])}),t("el-table-column",{attrs:{prop:"idc",label:"机房",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.idc?t("span",[e._v(" "+e._s(a.row.idc)+" ")]):t("span",[e._v(" - ")])]}}])}),t("el-table-column",{attrs:{prop:"i_bu",label:"部门",width:"120"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.ibu?t("span",[e._v(" "+e._s(a.row.ibu)+" ")]):t("span",[e._v(" - ")])]}}])}),t("el-table-column",{attrs:{label:"内存/CPU",width:"150"},scopedSlots:e._u([{key:"default",fn:function(a){return[e._v(" "+e._s(e.company(a.row.mem_total-a.row.mem_free))+"/"+e._s(e.company(a.row.mem_total))+"; "+e._s(a.row.cpu_core)+"核 "),t("el-progress",{attrs:{percentage:e.percentageChange(a.row.mem_total-a.row.mem_free,a.row.mem_total),"show-text":!1,color:e.customColorMethod(a.row.mem_total-a.row.mem_free,a.row.mem_total)}})]}}])}),t("el-table-column",{attrs:{prop:"broker_name",label:"中心","show-overflow-tooltip":"",width:"130"}}),t("el-table-column",{attrs:{prop:"comment",label:"描述","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.comment?t("span",[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:a.row.comment,placement:"bottom"}},[t("span",{staticStyle:{overflow:"hidden","text-overflow":"ellipsis",display:"-webkit-box","-webkit-line-clamp":"1","line-clamp":"1","-webkit-box-orient":"vertical"}},[e._v(e._s(a.row.comment))])])],1):t("span",[e._v(" - ")])]}}])}),t("el-table-column",{attrs:{label:"操作",align:"center",width:"100",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[3===a.row.status?t("el-popover",{ref:a.row.id+1,attrs:{placement:"top",width:"200"}},[t("p",[e._v("是否重启？")]),t("div",{staticStyle:{"text-align":"right",margin:"0"}},[t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){e.$refs[a.row.id+1].doClose()}}},[e._v("取消")]),t("el-button",{attrs:{loading:e.reloadLoading,type:"primary",size:"mini"},on:{click:function(t){return t.stopPropagation(),e.commandOfline(a.row)}}},[e._v("确定")])],1),t("el-button",{staticStyle:{"margin-left":"3%"},attrs:{slot:"reference",size:"mini",type:"text"},on:{click:function(e){e.stopPropagation()}},slot:"reference"},[e._v("重启")])],1):t("span",{staticStyle:{color:"#c0c4cc","margin-left":"3%"}},[e._v("重启")]),4!==a.row.status?t("el-popover",{ref:a.row.id,attrs:{placement:"top",width:"200"}},[t("p",[e._v("确认删除？")]),t("div",{staticStyle:{"text-align":"right",margin:"0"}},[t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){e.$refs[a.row.id].doClose()}}},[e._v("取消")]),t("el-button",{attrs:{loading:e.delLoading,type:"primary",size:"mini"},on:{click:function(t){return t.stopPropagation(),e.luoDelete(a.row)}}},[e._v("确定")])],1),t("el-button",{staticStyle:{"margin-left":"3%"},attrs:{slot:"reference",size:"mini",type:"text"},on:{click:function(e){e.stopPropagation()}},slot:"reference"},[e._v("删除")])],1):t("el-popconfirm",{attrs:{title:"确认删除？"},on:{confirm:function(t){return e.cheDelete(a.row)}}},[t("el-button",{staticStyle:{color:"#f44336","margin-left":"3%"},attrs:{slot:"reference",size:"mini",type:"text"},on:{click:function(e){e.stopPropagation()}},slot:"reference"},[e._v("删除")])],1)],1)]}}])})],1),t("Page",{attrs:{size:e.size,current:e.current,pageTotal:e.pageTotal},on:{handleSizeChange:e.handleSizeChange,handleCurrentChange:e.handleCurrentChange}})],1)])],1),t("ActionForm",{ref:"actionForm",attrs:{title:e.actionTitle,pageTotal:e.pageTotal,filters:e.filters,keyword:e.keyword,nodeData:e.nodeData},on:{getNode:e.getNode,cancel:e.cancel}})],1)},o=[],s=(a(28451),a(12037)),r=a(84772),n=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{"el-dialog":"","close-on-click-modal":!1,"before-close":e.handleClose,visible:e.actionDialog,title:e.title,"append-to-body":"",width:"500px"},on:{"update:visible":function(t){e.actionDialog=t}}},[t("div",[e._l(e.nodeData,(function(a){return t("el-tag",{key:a.id,staticStyle:{margin:"3px",width:"100px"},attrs:{size:"mini",type:"彻底删除"===e.title||"逻辑删除"===e.title?"danger":"success"}},[e._v(e._s(a.inet)+" ")])})),e._v(" 共计 "),t("span",{staticStyle:{color:"red"}},[e._v(e._s(e.pageTotal))]),e._v(" 条,是否操作？ ")],2),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"small"},on:{click:function(t){e.actionDialog=!1}}},[e._v("取 消")]),t("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.okLoading,expression:"okLoading"}],attrs:{size:"small",type:"primary"},on:{click:function(t){return e.onSubmit("form")}}},[e._v("确定")])],1)])},l=[],c={name:"actionForm",props:["title","pageTotal","filters","nodeData","keyword"],data(){return{actionDialog:!1,dataAction:[],okLoading:!1}},methods:{handleClose(){this.actionDialog=!1},onSubmit(){var e=this,t="";if("批量下线"===this.title)t="offline";else if("批量重启"===this.title)t="restart";else if("批量升级"===this.title)t="upgrade";else{if("彻底删除"===this.title)return this.actionDialog=!1,void this.$emit("cancel");if("逻辑删除"===this.title){var a={filters:this.filters,keyword:this.keyword};return this.okLoading=!0,void this.$request.fetchDeleteNode(a).then((t=>{e.$message({message:e.title+"成功!!!",type:"success"}),this.okLoading=!1,this.actionDialog=!1,this.$emit("getNode")})).catch((e=>{this.okLoading=!1,this.$message.error(e.data)}))}}var i={cmd:t,filters:this.filters,keyword:this.keyword};this.okLoading=!0,this.$request.fetchBatch(i).then((t=>{e.$message({message:e.title+"成功!!!",type:"success"}),this.okLoading=!1,this.actionDialog=!1,this.$emit("getNode")})).catch((e=>{this.okLoading=!1,this.$message.error(e.data)}))}},watch:{nodeData:function(e){this.nodeData=e},filters:function(e){this.filters=e}}},d=c,u=a(1001),h=(0,u.Z)(d,n,l,!1,null,"7ae35ca8",null),p=h.exports,f=a(9669),m=a.n(f),g=a(24861),y={name:"clientList",components:{Page:s.Z,ActionForm:p,filterOption:g.Z},beforeCreate(){this.$store.commit("addKeepAliveInclude","clientList")},data(){return{topEchartShow:!1,defaultData:{key:"minion_tag.tag",operator:"like"},actionTitle:"终端列表",selectArray:[],status:0,goos:"",actionType:["批量下线","逻辑删除","批量重启","批量升级","彻底删除"],tagType:["success","danger"],current:1,size:15,pageTotal:0,nodeData:[],isAdd:!0,delLoading:!1,stopLoading:!1,detailShow:!1,nodeDetailData:[],rowData:{},serverData:{},eventPage:{current:1,pageSize:15},fromValue:"",typeofValue:"",subject:"",animate:!1,statusData:{},goosData:{},selectAll:[],reloadLoading:!1,condData:{},value:null,operatorValue:"in",filters:[],dataKey:"minion.id",keyword:null,suggestOptions:{},tagShow:!1,tags:[]}},created(){this.getNode(),this.getCond(),this.loadTag()},activated(){this.getNode(),this.getCond(),this.loadTag()},computed:{curtag(){if(!this.filters)return"";const e=this.filters.find((e=>"minion_tag.tag"===e.key));return e&&"eq"===e.operator&&e.value?e.value:""}},methods:{keywordSearch(){this.current=1,this.getNode()},echartShow(){void 0===this.statusData.deleted&&this.getStatus(),this.topEchartShow=!this.topEchartShow},filseSuccess(e){var t=this,a=new FileReader;a.onload=function(){a.result&&t.$request.fetchCmdb(a.result).then((()=>{t.$message({message:"添加成功!!!",type:"success"})})).catch((e=>{this.$message.error(e.data)}))},a.readAsText(e.raw)},async loadTag(){try{const{data:e}=await m().get("/tag/sidebar");this.tags=e?.map(((e,t)=>({label:e.name,count:e.count,key:t})))||[],this.suggestOptions={"minion_tag.tag":e?.map((e=>e.name))||[]}}catch(e){}},handleRemove(e,t){var a=this;a.form.file=""},beforeRemove(e,t){return this.$confirm("确定移除 $ { file.name } ？")},handleExceed(e,t){this.$message.warning(`当前限制选择 3 个文件，本次选择了 ${e.length} 个文件，共选择了 ${e.length+t.length} 个文件`)},selectionChange(e){this.selectAll=e},bulkClick(e){const t=this.$refs.actionForm;t.actionDialog=!0,this.actionTitle=e},cancel(){this.actionTitle="",this.$store.commit("delfilters",{filters:this.filters,keyword:this.keyword}),this.$store.commit("setmessagetotal",this.pageTotal)},getStatus(){this.$request.fetchStatus().then((e=>{this.statusData=e.data,this.mychartes()})).catch((e=>{this.$message.error(e.data)})),this.$request.fetchGoos().then((e=>{this.goosData=e.data,this.chartsClient()})).catch((e=>{this.$message.error(e.data)}))},mychartes(){let e=[{value:this.statusData.online,name:"在线终端",label:{color:"#666"}},{value:this.statusData.offline,name:"离线终端",label:{color:"#666"}},{value:this.statusData.deleted,name:"删除终端",label:{color:"#666"}},{value:this.statusData.inactive,name:"未激活",label:{color:"#666"}}],t=0;e.forEach((function(e){t+=e.value}));let a=["#67c23a","#909399","#e6a23c","#f56c6c"];var i={backgroundColor:"#fff",tooltip:{},title:{text:t,subtext:"终端总数",x:"30%",y:"40%",textStyle:{fontSize:14,fontWeight:"normal",color:"#333"},subtextStyle:{fontSize:14,fontWeight:"normal",align:"center",color:"#555"}},legend:{orient:"vertical",right:"5%",align:"left",top:"middle",itemWidth:10,itemHeight:13,icon:"circle",itemGap:20,data:e,formatter:function(a){let i=0;for(var o="",s=0;s<e.length;s++)e[s].name==a&&(i=(e[s].value/t*100).toFixed(2)+"%",o+="{a|"+a+"}| {b|"+i+"}{b|"+e[s].value+"}");return o},textStyle:{color:"#000",rich:{a:{fontSize:12,padding:[0,10,0,6],color:"#666",fontFamily:"PingFang SC",fontStyle:"normal",lineHeight:20},b:{fontSize:12,padding:[0,10,0,6],color:"#666",fontFamily:"PingFang SC",fontStyle:"normal",lineHeight:20}}}},series:[{type:"pie",zlevel:3,radius:["50","90"],center:["35%","50%"],color:a,itemStyle:{normal:{borderWidth:10,borderColor:"#fff"}},data:e,labelLine:{normal:{show:!1}},label:{show:!1}}]};const o=r.init(document.getElementById("terminals"));o.setOption(i),window.addEventListener("resize",(()=>{o.resize()}))},chartsClient(){let e=[{value:this.goosData.windows,name:"Windows",label:{color:"#666"}},{value:this.goosData.linux,name:"Linux",label:{color:"#666"}},{value:this.goosData.darwin,name:"Mac",label:{color:"#666"}}],t=0;e.forEach((function(e){t+=e.value}));let a=["#67c23a","#909399","#e6a23c"];var i={backgroundColor:"#fff",tooltip:{},title:{text:t,subtext:"客户端总数",x:"30%",y:"40%",textStyle:{fontSize:14,fontWeight:"normal",color:"#333"},subtextStyle:{fontSize:14,fontWeight:"normal",align:"center",color:"#555"}},legend:{orient:"vertical",right:"5%",align:"left",top:"middle",itemWidth:10,itemHeight:13,icon:"circle",itemGap:20,data:e,formatter:function(a){let i=0;for(var o="",s=0;s<e.length;s++)e[s].name==a&&(i=(e[s].value/t*100).toFixed(2)+"%",o+="{a|"+a+"}| {b|"+i+"}{b|"+e[s].value+"}");return o},textStyle:{color:"#000",rich:{a:{fontSize:12,padding:[0,10,0,6],color:"#666",fontFamily:"PingFang SC",fontStyle:"normal",lineHeight:20},b:{fontSize:12,padding:[0,10,0,6],color:"#666",fontFamily:"PingFang SC",fontStyle:"normal",lineHeight:20}}}},series:[{type:"pie",zlevel:3,radius:["50","90"],center:["35%","50%"],color:a,itemStyle:{normal:{borderWidth:10,borderColor:"#fff"}},data:e,labelLine:{normal:{show:!1}},label:{show:!1}}]};const o=r.init(document.getElementById("client"));o.setOption(i),window.addEventListener("resize",(()=>{o.resize()}))},ipRe(e,t){if(null!==e){var a=e.filter((e=>{var a=/(\d+)\.(\d+)\.(\d+)\.(\d+)/g;return(!t||e!==t)&&(a.test(e)?void 0:e)}));return a}},detailClick(e){this.$jumpTo({name:"details",params:{id:e.id}},e.inet)},company(e){if(0===e)return"0 B";let t=1024,a=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],i=Math.floor(Math.log(e)/Math.log(t));return i>0?(e/Math.pow(t,i)).toPrecision(3)+" "+a[i]:e.toFixed(2)+" B"},percentageChange(e,t){return 0===e?0:parseInt(e/t*1e4)/100},customColorMethod(e,t){var a=this.percentageChange(e,t);return a<30?"#67c23a":a<70?"#e6a23c":"#f56c6c"},handleSizeChange(e){this.size=e,this.getNode()},handleCurrentChange(e){this.current=e,this.getNode()},sheetode(){let e=document.createElement("a");e.href="/api/v1/sheet/minion?authorization="+localStorage.getItem("token"),e.target="_blank",e.click()},commandOfline(e){this.$refs[e.id+1].doClose();var t={id:e.id,cmd:"offline"},a=this;a.stopLoading=!0,this.$request.fetchcommand(t).then((e=>{this.$message.success("重启指令下发成功"),a.stopLoading=!1,a.getNode()})).catch((e=>{this.$message.error(e.data)}))},luoDelete(e){var t={filters:[{key:this.dataKey,operator:"eq",value:e.id}]},a=this;this.$refs[e.id].doClose(),this.$request.fetchDeleteNode(t).then((e=>{a.$message({message:"删除成功!!!",type:"success"}),a.delLoading=!1,a.getNode()})).catch((e=>{this.$message.error(e.data)}))},cheDelete(e){var t=this;t.delLoading=!0;var a={id:e.id};this.$request.fetchDeleteMinion(a).then((e=>{t.$message({message:"删除成功!!!",type:"success"}),t.delLoading=!1,t.getNode()})).catch((e=>{this.$message.error(e.data)}))},getNode(){var e={current:this.current,size:this.size,filters:this.filters?.map((e=>({key:e.key,operator:e.operator,value:e.value}))),keyword:this.keyword||null};this.$request.fetchGetNode(e).then((e=>{this.nodeData=e.data.records,this.pageTotal=e.data.total})).catch((e=>{this.$message.error(e.data||"请求出错")}))},getCond(){this.$request.fetchMinionCond().then((e=>{this.condData=e.data,this.dataKey=e.data.conditions.find((e=>"ID"===e.desc)).key,this.selectArray=e.data.conditions.filter((e=>["操作系统","状态"].includes(e.desc))).map((e=>({model:"",placeholder:e.desc,name:e.key,dataArray:e.enums||[]})))||[]}))},searchBasic(){this.current=1,this.getNode()},formatter(e,t){return e.address},leftItemClick(e){e==this.curtag&&(e=null),this.$refs.selectSearchRef?.pushFilter({key:"minion_tag.tag",operator:"eq",value:e})},async calmChange(e,t){try{await this.$confirm(e?"静默后agent上的所有任务不会执行，是否继续？":"是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch((()=>{throw"取消操作"})),await m().patch("/minion/unload",{id:t.id,unload:e}),this.$message.success("操作成功"),this.getNode()}catch(a){this.$message.error(a||"操作出错")}}},watch:{nodeData:function(e){this.nodeData=e}}},v=y,w=(0,u.Z)(v,i,o,!1,null,"0949b7ea",null),k=w.exports},28451:function(e,t,a){var i=a(20144);i["default"].filter("date",(function(e,t){var a=new Date(e),i={"M+":a.getMonth()+1,"d+":a.getDate(),"h+":a.getHours(),"m+":a.getMinutes(),"s+":a.getSeconds(),"q+":Math.floor((a.getMonth()+3)/3),S:a.getMilliseconds()};for(var o in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length))),i)new RegExp(`(${o})`).test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?i[o]:("00"+i[o]).substr((""+i[o]).length)));return t}))}}]);