"use strict";(self["webpackChunkssoc"]=self["webpackChunkssoc"]||[]).push([[6316],{84241:function(e,t,i){i.d(t,{Z:function(){return c}});var s=function(){var e=this,t=e._self._c;return e.condData?t("div",[e.multiCondition?t("el-row",{staticStyle:{"margin-bottom":"5px"}},[t("el-col",{attrs:{span:24}},e._l(e.filters,(function(i,s){return t("span",{key:s,staticStyle:{"margin-right":"5px","font-size":"12px",color:"#fff",padding:"3px","border-radius":"3px","background-color":"#409eff",display:"inline-block"}},[e._v(" "+e._s(i.keyDesc)+" "+e._s(i.operatorDesc)+" "+e._s(i.value)+" "),t("i",{staticClass:"el-icon-edit",staticStyle:{cursor:"pointer"},on:{click:function(t){return e.editTag(i,s)}}}),t("i",{staticClass:"el-icon-close",staticStyle:{cursor:"pointer"},on:{click:function(t){return e.delTag(i,s)}}})])})),0)],1):e._e(),t("div",{class:"事件详情"===e.nameIndex||"任务详情"===e.nameIndex||"风险详情"===e.nameIndex?"dom":"doms"},[e._l(e.selectArray,(function(i,s){return t("span",{key:s},["蜜罐"!==e.nameIndex?t("el-dropdown",{staticStyle:{"margin-right":"5px"},attrs:{trigger:"click"}},[t("el-button",{attrs:{type:"primary",size:"mini"}},[e._v(" "+e._s(i.placeholder)),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(i.dataArray,(function(s){return t("el-dropdown-item",{key:s.key,attrs:{value:s.key},nativeOn:{click:function(t){return e.selectActive(s,i)}}},[e._v(e._s(s.desc))])})),1)],1):e._e()],1)})),"事件展示"===e.nameIndex?t("span",[t("el-dropdown",{staticStyle:{"margin-right":"5px"},attrs:{trigger:"click"}},[t("el-button",{attrs:{type:"primary",size:"mini"}},[e._v(" 时间搜索"),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.eventTime,(function(i){return t("el-dropdown-item",{key:i.value,attrs:{value:i.value},nativeOn:{click:function(t){return e.eventTimeChange(i)}}},[e._v(e._s(i.label))])})),1)],1)],1):e._e(),"事件详情"===e.nameIndex?t("el-button",{attrs:{type:"success",size:"mini"},on:{click:e.oneClear}},[e._v("一键清除")]):e._e(),"事件详情"===e.nameIndex||"任务详情"===e.nameIndex||"风险详情"===e.nameIndex?t("el-button",{staticStyle:{"margin-right":"7px"},attrs:{type:"success",size:"mini"},on:{click:e.refresh}},[e._v("刷新")]):e._e(),t("el-select",{staticStyle:{width:"150px","margin-right":"7px"},attrs:{size:"mini","value-key":"key"},on:{change:e.selectField},model:{value:e.key,callback:function(t){e.key=t},expression:"key"}},[e._l(e.condData.conditions,(function(i,s){return[i.key!==e.eventLogon?t("el-option",{key:s,attrs:{value:i.key,label:i.desc}}):e._e()]}))],2),t("el-select",{staticStyle:{width:"100px","margin-right":"7px"},attrs:{size:"mini","value-key":"key"},on:{change:e.selectOperator},model:{value:e.operator,callback:function(t){e.operator=t},expression:"operator"}},e._l(e.selectFieldDerive.operatorArray,(function(e,i){return t("el-option",{key:i,attrs:{value:e.key,label:e.desc}})})),1),["datetime","time"].includes(e.selectFieldDerive.typeConditions)?t("span",{staticStyle:{display:"inline-block","margin-right":"7px"}},[t("el-date-picker",{attrs:{clearable:"",type:"datetime",pickerOptions:e.pickerOptions,placeholder:"选择时间",size:"mini"},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})],1):t("span",{staticStyle:{display:"inline-block","margin-right":"7px"}},[e.selectFieldDerive.selectType?t("el-select",{staticStyle:{width:"180px"},attrs:{size:"mini",clearable:"","value-key":"key",multiple:"in"===e.operator||"notin"===e.operator,"collapse-tags":""},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},e._l(e.selectFieldDerive.valueArray,(function(e,i){return t("el-option",{key:i,attrs:{value:e.key,label:e.desc}})})),1):t("span",{staticStyle:{position:"relative",display:"inline-block"}},[t("el-input",{staticStyle:{width:"200px"},attrs:{size:"mini",clearable:""},on:{focus:function(t){e.suggestVisible=!0}},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})],1)],1),t("el-button",{class:"事件详情"===e.nameIndex||"任务详情"===e.nameIndex||"风险详情"===e.nameIndex?"buttons":"buttonsearch",attrs:{icon:"el-icon-search",size:"mini"},on:{click:()=>{e.suggestVisible=!1,e.searchCond()}}},[e._v(e._s(e.titleH)+" ")])],2)],1):e._e()},a=[],r={name:"index",props:{titleH:{type:String,default:function(){return""}},condData:{type:Object,default:function(){return{}}},defaultData:{type:Object,default:function(){return{}}},eventLogon:{type:String,default:function(){return""}},nameIndex:{type:String,default:function(){return""}},selectArray:{type:Array,default:function(){return[]}},multiCondition:{default:!0},inputSuggestOptions:{type:Object}},computed:{selectFieldDerive(){var e=this.condData?.conditions?.findIndex((e=>e.key===this.key));return{operatorArray:this.condData?.conditions?.[e]?.operators||[],selectType:this.condData?.conditions?.[e]?.enum,valueArray:this.condData?.conditions?.[e]?.enums||[],typeConditions:this.condData?.conditions?.[e]?.type}},suggestOption(){return this.inputSuggestOptions&&this.inputSuggestOptions[this.key]||[]}},data(){return{operator:"",value:null,key:"",filters:[],current:1,pageSize:15,suggestVisible:!1,eventTime:[{value:"900",label:"十五分钟"},{value:"3600",label:"一小时"},{value:"86400",label:"一天"},{value:"604800",label:"一周"},{value:"2592000",label:"一个月"}],pickerOptions:{disabledDate(e){return e.getTime()>Date.now()},shortcuts:[{text:"今天",onClick(e){e.$emit("pick",new Date)}},{text:"昨天",onClick(e){const t=new Date;t.setTime(t.getTime()-864e5),e.$emit("pick",t)}},{text:"一周前",onClick(e){const t=new Date;t.setTime(t.getTime()-6048e5),e.$emit("pick",t)}},{text:"三十天前",onClick(e){const t=new Date;t.setTime(t.getTime()-2592e6),e.$emit("pick",t)}}]}}},created(){const e=this.filters.push.bind(this.filters);this.filters.push=(...t)=>{for(let i of t){const t=this.filters.find((e=>e.key===i.key));t?Object.assign(t,i):(!this.multiCondition&&this.filters.length>0&&(this.filters.length=0),e(i))}},"彻底删除"===this.nameIndex?(this.filters.push(this.getSelectItem("status","eq","4")),this.$emit("searchBasic",this.filters)):(this.key=this.defaultData?.key||null,this.operator=this.defaultData?.operator||null)},methods:{refresh(){this.$emit("refresh")},oneClear(){this.$emit("oneClear")},selectField(e){this.value=void 0,this.$nextTick((()=>{this.operator=this.selectFieldDerive.operatorArray.some((e=>"like"===e.key))?"like":this.selectFieldDerive.operatorArray?.[0].key}))},selectOperator(e){this.operatorValue=e.key,this.value=null},eventTimeChange(e){this.filters.length=0,this.filters.push(this.getSelectItem("created_at","lt",new Date)),this.filters.push(this.getSelectItem("created_at","gt",new Date(new Date-24e3*e.value))),this.$emit("searchBasic",this.filters)},selectActive(e,t){this.filters.push(this.getSelectItem(t.name,"eq",e.key)),this.$emit("searchBasic",this.filters)},delTag(e,t){("蜜罐"!==this.nameIndex&&"事件详情"!==this.nameIndex&&"风险详情"!==this.nameIndex||0!==t)&&(this.filters.splice(t,1),this.$emit("searchBasic",this.filters))},editTag(e,t){("蜜罐"!==this.nameIndex&&"事件详情"!==this.nameIndex&&"风险详情"!==this.nameIndex||0!==t)&&(this.key=e.key,this.value=e.value,this.operator=e.operator)},getSelectItem(e,t,i){return{key:e,keyDesc:this.condData?.conditions?.find((t=>t.key===e))?.desc,value:i,operator:t,operatorDesc:this.selectFieldDerive.operatorArray.find((e=>e.key===t))?.desc}},searchCond(){if(""!==this.key&&void 0!==this.value&&void 0!==this.operator&&null!==this.value&&""!==this.value){const e=this.getSelectItem(this.key,this.operator,this.value);this.filters.push(e)}if(!this.value&&this.key){const e=this.filters.find((e=>e.key===this.key));-1!==e&&this.filters.splice(e,1)}this.$emit("searchBasic",this.filters)},setOption(e,t,i){this.key=e,this.operator=t,this.value=i,this.searchCond()}},watch:{nameIndex:function(e,t){"彻底删除"===e&&e!==t&&(this.filters.push(this.getSelectItem("status","eq","4")),this.$emit("searchBasic",this.filters))}}},l=r,n=i(1001),o=(0,n.Z)(l,s,a,!1,null,"1e98ace1",null),c=o.exports},60706:function(e,t,i){i.r(t),i.d(t,{default:function(){return M}});var s=function(){var e=this,t=e._self._c;return t("el-card",{staticStyle:{"padding-bottom":"10px"}},[t("el-row",[t("el-col",{attrs:{span:12}},[t("select-search",{attrs:{condData:e.condData,selectArray:e.selectArray},on:{searchBasic:e.searchBasic}})],1),t("el-col",{staticStyle:{"text-align":"right"},attrs:{span:12}},[t("el-button",{staticStyle:{"margin-left":"0"},attrs:{"el-button":"",type:"success",plain:"",size:"mini"},on:{click:e.addThird}},[e._v("添加")])],1)],1),t("el-row",{staticStyle:{"margin-top":"5px"},attrs:{gutter:10}},e._l(e.thirdData,(function(i){return t("el-col",{key:i.id,attrs:{span:6}},[t("el-card",{staticClass:"box-card"},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",[e._v(e._s(i.name))]),t("span",{staticClass:"operate",staticStyle:{float:"right",padding:"3px 0","font-size":"12px",color:"#409eff"}},[".lua"===i.name.substring(i.name.lastIndexOf("."))?t("i",{staticClass:"fa fa-code",on:{click:function(t){return e.editCode(i)}}}):e._e(),t("i",{staticClass:"fa fa-upload",on:{click:function(t){return e.uploadThird(i)}}}),t("i",{staticClass:"fa fa-download",staticStyle:{transform:"translateY(1px)"},on:{click:function(t){return e.downThird(i)}}}),t("el-popconfirm",{staticStyle:{"margin-left":"3px"},attrs:{title:"确定删除吗？"},on:{confirm:function(t){return e.delThird(i.id)}}},[t("i",{staticClass:"fa fa-close",staticStyle:{"font-size":"20px"},attrs:{slot:"reference"},slot:"reference"})])],1)]),t("div",[t("p",[t("span",{staticClass:"title_tx"},[e._v("时间： ")]),t("span",{staticClass:"subtitle"},[e._v(e._s(e._f("date")(i.created_at,"yyyy-MM-dd hh:mm:ss")))])]),t("p",[t("span",{staticClass:"title_tx"},[e._v("哈希： ")]),t("span",{staticClass:"subtitle"},[e._v(e._s(i.hash))])]),t("p",[t("span",{staticClass:"title_tx"},[e._v("描述： ")]),t("span",{staticClass:"subtitle"},[e._v(e._s(i.desc))])]),t("p",[t("span",{staticClass:"title_tx"},[e._v("类型： ")]),t("span",{staticClass:"subtitle"},[e._v(e._s(i.extension)),t("i",{staticClass:"iconfont",class:"lua"===i.name.split(".")[1]?"icon-lua":"md"===i.name.split(".")[1]?"icon-md":"icon-txt",staticStyle:{"font-size":"18px"}})])]),t("p",[t("span",{staticClass:"title_tx"},[e._v("大小： ")]),t("span",{staticClass:"subtitle"},[e._v(e._s(e.company(i.size)||"0"))])])])])],1)})),1),t("el-col",{staticStyle:{"text-align":"right"},attrs:{span:24}},[t("Page",{attrs:{size:e.pageSize,current:e.current,pageTotal:e.pageTotal,pageSizeArray:[16,24,32]},on:{handleSizeChange:e.handleSizeChange,handleCurrentChange:e.handleCurrentChange}})],1),t("third-form",{ref:"thirdForm",attrs:{isAdd:e.isAdd}}),t("tag-form",{ref:"tagFrom"}),e.codeEditShow?t("Code",{ref:"codeForm"}):e._e()],1)},a=[],r=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:!0===e.isAdd?"新增":"编辑","el-dialog":"","close-on-click-modal":!1,visible:e.fileShow,"append-to-body":"",width:"500px"},on:{"update:visible":function(t){e.fileShow=t}}},[t("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,size:"small","label-width":"95px"}},[t("el-form-item",{attrs:{label:"文件",prop:"file"}},[t("el-upload",{ref:"file",staticClass:"upload-demo",attrs:{action:"/","on-remove":e.handleRemove,"before-remove":e.beforeRemove,"on-change":e.filseSuccess,multiple:"",limit:3,"on-exceed":e.handleExceed,"auto-upload":!1}},[t("el-button",{attrs:{size:"small",icon:"el-icon-upload"}},[e._v("点击上传")])],1)],1),t("el-form-item",{attrs:{label:"名称",prop:"name"}},[t("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),t("el-form-item",{attrs:{label:"desc",prop:"desc"}},[t("el-input",{attrs:{type:"textarea",rows:2},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onSubmit("form")}}},[e._v("提交")])],1)],1)},l=[],n={name:"thirdForm",props:["isAdd"],data(){return{form:{id:"",name:"",path:"",desc:"",file:""},fileShow:!1,rules:{name:[{required:!0,message:"请输入名称",trigger:"blur"}],path:[{required:!0,message:"请输入path",trigger:"blur"}]}}},methods:{filseSuccess(e,t){this.form.file=e.raw,this.form.name=e.name},handleRemove(e,t){var i=this;i.form.file="",i.form.name=""},beforeRemove(e,t){return this.$confirm("确定移除 $ { file.name } ？")},handleExceed(e,t){this.$message.warning(`当前限制选择 3 个文件，本次选择了 ${e.length} 个文件，共选择了 ${e.length+t.length} 个文件`)},onSubmit(e){this.$refs[e].validate((e=>{if(e){let e=new FormData;void 0!==this.form.file&&e.append("file",this.form.file),e.append("name",this.form.name),e.append("path",this.form.path),e.append("desc",this.form.desc),this.isAdd?this.$request.fetchaddThird(e).then((()=>{this.fileShow=!1,this.form={id:"",name:"",path:"",desc:"",file:""},this.$refs.file.clearFiles(),this.$parent.$parent.getThird(),this.$message({message:"添加成功!!!",type:"success"})})).catch((e=>{this.$message.error(e.data)})):(e.append("id",this.form.id),this.$request.fetchUploadThird(e).then((e=>{this.fileShow=!1,this.form={},this.$refs.file.clearFiles(),this.$parent.$parent.getThird(),this.$message({message:"修改成功!!!",type:"success"})})).catch((e=>{this.$message.error(e.data)})))}}))}}},o=n,c=i(1001),d=(0,c.Z)(o,r,l,!1,null,"0e5a894a",null),h=d.exports,u=function(){var e=this,t=e._self._c;return t("el-dialog",{staticClass:"tagTrans",attrs:{visible:e.tagshow,title:"发布",width:"35%"},on:{"update:visible":function(t){e.tagshow=t}}},[t("el-transfer",{staticClass:"transfer",staticStyle:{width:"100%"},attrs:{filterable:"",data:e.tagList,titles:["所有","已选"]},model:{value:e.tagArray,callback:function(t){e.tagArray=t},expression:"tagArray"}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("提交")])],1)],1)},p=[],m={name:"tagForm",data(){return{tagshow:!1,tagList:[],thirdId:"",tagArray:[]}},mounted(){this.getTag()},methods:{getTag(){this.$request.fetchGetTag().then((e=>{var t=this;t.tagList=[],e.data.forEach((e=>{t.tagList.push({label:e,key:e})}))}))},onSubmit(){var e={id:this.thirdId,tags:this.tagArray};this.$request.fetchAddPublish(e).then((()=>{this.tagshow=!1,this.tagArray=[],this.thirdId="",this.$parent.$parent.getThird(),this.$message({message:"发布成功!!!",type:"success"})})).catch((e=>{this.$message.error(e.data)}))}}},f=m,g=(0,c.Z)(f,u,p,!1,null,"a593041c",null),y=g.exports,v=function(){var e=this,t=e._self._c;return t("el-dialog",{staticClass:"dialogForm",attrs:{visible:e.codeShow,"show-close":!1,"close-on-click-modal":!1,top:"60px"},on:{"update:visible":function(t){e.codeShow=t}}},[t("div",{attrs:{slot:"title"},slot:"title"},[t("el-button",{attrs:{type:"text"}},[e._v(" "+e._s(e.titleCode))]),t("span",{staticStyle:{float:"right",cursor:"pointer",color:"#9e9e9e",margin:"5px"}},[t("i",{staticClass:"fa fa-cloud-upload",staticStyle:{"margin-left":"10px",color:"#3d95ff",cursor:"pointer"},attrs:{title:"提交"},on:{click:e.subCode}}),t("i",{staticClass:"fa fa-close",attrs:{title:"关闭"},on:{click:function(t){e.codeShow=!1}}})])],1),t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.textLoading,expression:"textLoading"}],ref:"generateId",staticClass:"code-editor"})])},k=[],x=i(53239),b=i.n(x),_=(i(83734),i(70790),i(37336),i(58119),i(55259)),w=i.n(_),S=i(6201),C=i.n(S),$=i(74358),T=i.n($);b().config.setModuleUrl("ace/mode/lua_worker",w()),b().config.setModuleUrl("ace/mode/lua_worker",w()),b().config.setModuleUrl("ace/mode/css_worker",C()),b().config.setModuleUrl("ace/keyboard/vim",T());var D={name:"codeIndex",data(){return{dialogValue:"",codeShow:!1,titleCode:"",form:{id:"",name:"",path:"",desc:"",file:""},textLoading:!1}},methods:{subCode(){this.form.file=this.editor.getValue(this.dialogValue);const e=new Blob([this.form.file]);let t=new FormData;t.append("file",e),t.append("name",this.form.name),t.append("path",this.form.path),t.append("desc",this.form.desc),t.append("id",this.form.id),this.$request.fetchUploadThird(t).then((()=>{this.$message({message:"修改成功!!!",type:"success"})})).catch((e=>{this.$message.error(e.data)}))}},updated(){var e=this;e.editor=b().edit(this.$refs.generateId,{keyboardHandler:"ace/keyboard/vim",enableSnippets:!0,enableLiveAutocompletion:!0,enableBasicAutocompletion:!0,mode:"ace/mode/lua",theme:"ace/theme/dracula",fontSize:12,tabSize:4,value:this.dialogValue,selectionStyle:"text'",showLineNumbers:!0,showGutter:!0,showPrintMargin:!0,printMarginColumn:150})},watch:{dialogValue:function(e,t){""!==e&&(this.dialogValue=this.editor.setValue(e))}}},I=D,A=(0,c.Z)(I,v,k,!1,null,"770afc28",null),z=A.exports,F=(i(28451),i(12037)),B=i(84241),O={components:{ThirdForm:h,TagForm:y,Code:z,Page:F.Z,selectSearch:B.Z},name:"index",data(){return{condData:{},thirdData:[],filters:[],current:1,pageSize:16,pageTotal:0,isAdd:!0,codeEditShow:!0,selectArray:[{model:"",placeholder:"文件类型",name:"extension",dataArray:[{key:".lua",desc:".lua"},{key:".csv",desc:".csv"},{key:".zip",desc:".zip"},{key:".txt",desc:".txt"},{key:".exe",desc:".exe"}]}]}},mounted(){this.getThird(),this.getCond()},methods:{searchBasic(e){this.current=1,this.filters=e,this.getThird()},getCond(){this.$request.fetchThirdCond().then((e=>{this.condData=e.data}))},company(e){if(0===e)return"0 B";let t=1024,i=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],s=Math.floor(Math.log(e)/Math.log(t));return s>0?(e/Math.pow(t,s)).toPrecision(3)+" "+i[s]:e.toFixed(2)+" B"},getThird(){var e={current:this.current,size:this.pageSize,filters:this.filters};this.$request.fetchGetThird(e).then((e=>{this.thirdData=e.data.records,this.pageTotal=e.data.total}))},delThird(e){this.$request.fetchDelThird(e).then((()=>{this.getThird(),this.$message({message:"删除成功!!!",type:"success"})}))},editCode(e){var t=this.$refs.codeForm;t.codeShow=!0,this.codeEditShow=!0,t.textLoading=!0,this.$request.fetchDownCode(e.id).then((i=>{t.textLoading=!1,t.dialogValue=i.data,t.form=e,t.form.id=e.id,t.titleCode=e.name}))},uploadThird(e){this.isAdd=!1;var t=this.$refs.thirdForm;t.form={id:e.id,name:e.name,path:e.path,desc:e.desc,file:e.file},t.fileShow=!0},handleSizeChange(e){this.pageSize=e,this.getThird()},handleCurrentChange(e){this.current=e,this.getThird()},handleRemove(e,t){var i=this;i.form.chunk=""},handleExceed(e,t){this.$message.warning(`当前限制选择 3 个文件，本次选择了 ${e.length} 个文件，共选择了 ${e.length+t.length} 个文件`)},addThird(){this.isAdd=!0;var e=this.$refs.thirdForm;e.fileShow=!0},downThird(e){let t=document.createElement("a");t.href="/api/v1/third?id="+e.id+"&authorization="+localStorage.getItem("token"),t.target="_blank",t.click()},publishTag(e){var t=this.$refs.tagFrom;t.tagshow=!0,t.thirdId=e.id,null===e.tags?t.tagArray=[]:t.tagArray=e.tags}}},q=O,L=(0,c.Z)(q,s,a,!1,null,"61f573dc",null),M=L.exports}}]);