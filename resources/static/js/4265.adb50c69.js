"use strict";(self["webpackChunkssoc"]=self["webpackChunkssoc"]||[]).push([[4265],{91938:function(e,t,a){a.d(t,{Z:function(){return u}});var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"icon-body"},[t("el-input",{staticStyle:{position:"relative"},attrs:{clearable:"",placeholder:"请输入图标名称"},on:{clear:e.filterIcons},nativeOn:{input:function(t){return e.filterIcons.apply(null,arguments)}},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}},[t("i",{staticClass:"el-icon-search el-input__icon",attrs:{slot:"suffix"},slot:"suffix"})]),t("div",{staticClass:"icon-list"},e._l(e.iconList,(function(a,i){return t("div",{key:i,on:{click:function(t){return e.selectedIcon(a)}}},[t("svg-icon",{staticStyle:{height:"40px",width:"26px"},attrs:{"icon-class":a}})],1)})),0)],1)},s=[];const o=a(87886),r=e=>e.keys(),n=/\.\/(.*)\.svg/,l=r(o).map((e=>e.match(n)[1]));var c=l,d={name:"IconSelect",data(){return{name:"",iconList:c}},methods:{filterIcons(){this.name?this.iconList=this.iconList.filter((e=>e.includes(this.name))):this.iconList=c},selectedIcon(e){this.$emit("selected",e),document.body.click()},reset(){this.name="",this.iconList=c}}},h=d,p=a(1001),m=(0,p.Z)(h,i,s,!1,null,"4634c9b8",null),u=m.exports},84265:function(e,t,a){a.r(t),a.d(t,{default:function(){return re}});var i=function(){var e=this,t=e._self._c;return t("div",[t("el-card",{staticClass:"contentCard_",staticStyle:{position:"relative"}},[e.tabs.length?[t("el-tabs",{attrs:{"before-leave":e.beforeTabLeave},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[e._l(e.tabs,(function(a,i){return t("el-tab-pane",{key:i,staticClass:"test",attrs:{name:a.value}},[t("span",{staticClass:"tabHeader",attrs:{slot:"label"},slot:"label"},[t("svg-icon",{staticClass:"el-input__icon",staticStyle:{height:"16px",width:"16px"},attrs:{"icon-class":a.icon}}),e._v(" "+e._s(a.label)+" "),a.id?t("i",{staticClass:"el-icon-error",on:{click:function(t){return t.stopPropagation(),e.deleteTag(a.id)}}}):e._e()],1)])})),t("el-tab-pane",{attrs:{name:"add"}},[t("span",{attrs:{slot:"label"},slot:"label"},[t("el-link",{attrs:{type:"primary"},on:{click:e.addNew}},[t("i",{staticClass:"el-icon-plus"}),e._v("添加新类型")])],1)])],2),t("platform",{key:e.activeName,attrs:{goosOptions:e.goosOptions||[],"agent-type":e.activeName},on:{refresTab:e.loadTabs}})]:t("el-empty",{attrs:{description:"无数据"}},[t("el-button",{attrs:{type:"primary"},on:{click:e.addNew}},[e._v("上传安装包")])],1)],2),t("addNewTab",{ref:"addNewTabRef"})],1)},s=[],o=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{display:"flex","min-height":"calc(100vh - 154px)"}},[t("div",[t("el-menu",{ref:"menuRef",staticClass:"platfrom",attrs:{"default-active":e.sysActive,router:!1},on:{select:e.select}},[e._l(e.sysTypes,(function(a,i){return t("el-menu-item",{key:i,attrs:{index:a.id}},["linux"===a.goos?t("i",{staticClass:"fa fa-linux"}):"windows"===a.goos?t("i",{staticClass:"fa fa-windows"}):t("i",{staticClass:"el-icon-menu"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v(" "+e._s(a.goos)+" - "+e._s(a.arch)+" ")])])})),t("el-menu-item",{attrs:{index:"add"},on:{click:e.addNew}},[t("span",{attrs:{slot:"title"},slot:"title"},[t("el-button",{attrs:{type:"text"}},[e._v("+添加系统")])],1)])],2)],1),t("div",{staticStyle:{flex:"1","padding-left":"10px"}},[t("agent",{key:e.sysActiveCache,attrs:{"agent-type":e.agentType,goos:e.goos,arch:e.arch},on:{refreshGoos:function(t){return e.$emit("refresTab")}}})],1),t("addNewAgent",{ref:"addNewAgentRef"})],1)},r=[],n=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{height:"100%"}},[e.activeVersionData?t("el-row",{staticStyle:{"min-height":"100%"},attrs:{type:"flex"}},[t("el-col",{attrs:{span:17}},[t("el-row",[t("el-col",{attrs:{span:4}},[t("div",{staticStyle:{display:"flex","flex-direction":"column","align-items":"center"}},[t("svg-icon",{staticStyle:{height:"100px","margin-bottom":"10px",width:"100px"},attrs:{"icon-class":e.goosIcon}})],1)]),t("el-col",{staticStyle:{"padding-left":"10px"},attrs:{span:20}},[t("div",{},[t("b",{},[t("editAndSavaBtn",{attrs:{value:e.activeVersionData.tipsEdit},on:{edit:function(t){e.activeVersionData.tipsEdit=!0},save:e.saveTips}})],1)]),e.activeVersionData.tipsEdit?t("el-input",{staticStyle:{width:"100%","margin-top":"10px"},attrs:{type:"textarea",rows:6,resize:"none",placeholder:"无"},model:{value:e.activeVersionData.caution,callback:function(t){e.$set(e.activeVersionData,"caution",t)},expression:"activeVersionData.caution"}}):t("pre",{staticStyle:{"min-height":"80px"}},[e._v(e._s(e.activeVersionData.caution))])],1)],1),t("el-row",{staticStyle:{"margin-top":"40px"}},[t("el-col",{attrs:{span:4}},[t("div",{staticStyle:{display:"flex","flex-direction":"column","align-items":"flex-end"}},[t("el-menu",{ref:"menuRef",attrs:{"default-active":e.defaultActive,router:!1},on:{select:e.select}},[t("el-menu-item",{attrs:{index:"opt"},on:{click:e.addNewAgent}},[t("el-button",{staticStyle:{transform:"translateY(-2px)"},attrs:{size:"mini",type:"text"}},[e._v(" +新版本")])],1),e._l(e.versionData,(function(a,i){return t("el-menu-item",{key:i,attrs:{index:a.id}},[e._v(" "+e._s(a.semver)),a.deprecated?t("el-tag",{staticStyle:{"margin-left":"5px"},attrs:{type:"info",size:"mini",round:""}},[e._v("已过期")]):e._e(),a.unstable?t("el-tag",{staticStyle:{"margin-left":"5px"},attrs:{type:"info",size:"mini",round:""}},[e._v("测试")]):e._e()],1)}))],2)],1)]),t("el-col",{staticStyle:{"padding-left":"10px"},attrs:{span:20}},[t("div",{staticStyle:{"font-size":"12px",display:"flex","align-items":"center","justify-content":"space-between"}},[t("span",{staticStyle:{display:"flex","list-style":"none"}},[t("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.activeVersionData.name))]),t("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.activeVersionData.arch))]),t("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.activeVersionData.ctimeFormat))])],1),t("div",[t("el-popconfirm",{staticStyle:{"margin-right":"7px"},attrs:{title:`确定推送版本v${e.activeVersionData.semver}的安装包进行更新吗？`},on:{confirm:e.operaEdition}},[t("el-button",{attrs:{slot:"reference",disabled:e.activeVersionData.deprecated,type:"primary",plain:"",size:"mini"},slot:"reference"},[e._v("推送更新")])],1),t("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:e.downLoad}},[e._v("下载")]),t("el-button",{attrs:{type:"primary",plain:"",disabled:e.activeVersionData.deprecated,size:"mini"},on:{click:()=>e.$refs.shareRef.openDialog(e.activeVersionData,"download")}},[e._v("安装")]),t("el-button",{attrs:{type:"primary",plain:"",disabled:e.activeVersionData.deprecated,size:"mini"},on:{click:()=>e.$refs.shareRef.openDialog(e.activeVersionData)}},[e._v("分享")]),t("el-popconfirm",{staticStyle:{"margin-left":"7px"},attrs:{title:`确定将版本v${e.activeVersionData.semver}的安装包标记过期吗？`},on:{confirm:e.deprecate}},[t("el-button",{attrs:{slot:"reference",disabled:e.activeVersionData.deprecated,type:"primary",plain:"",size:"mini"},slot:"reference"},[e._v("标记过期")])],1),t("el-popconfirm",{staticStyle:{"margin-left":"7px"},attrs:{title:`确定删除版本v${e.activeVersionData.semver}的安装包吗？`},on:{confirm:e.subDelete}},[t("el-button",{attrs:{slot:"reference",type:"danger",plain:"",size:"mini"},slot:"reference"},[e._v("删除")])],1)],1)]),t("div",{staticStyle:{"margin-top":"30px"}},[t("editAndSavaBtn",{attrs:{value:e.activeVersionData.changelogEdit},on:{edit:function(t){e.activeVersionData.changelogEdit=!0},save:e.saveChangelog}}),t("transition",{attrs:{mode:"out-in"}},[e.activeVersionData.changelogEdit?t("el-input",{staticStyle:{width:"100%","margin-top":"10px"},attrs:{type:"textarea",rows:6,resize:"none",placeholder:"无"},model:{value:e.activeVersionData.changelog,callback:function(t){e.$set(e.activeVersionData,"changelog",t)},expression:"activeVersionData.changelog"}}):t("pre",{key:e.activeVersionData.changelog},[e._v(e._s(e.activeVersionData.changelog))])],1)],1)])],1)],1),t("el-col",{staticClass:"desc",staticStyle:{"padding-left":"30px"},attrs:{span:7}},[t("div",{staticStyle:{"line-height":"20px","border-left":"3px solid var(--themeColor)","padding-left":"5px",transform:"translate(-5px, 2px)",display:"flex","align-items":"center","margin-bottom":"10px"}},[t("b",[e._v("功能列表 "),t("editAndSavaBtn",{attrs:{value:e.activeVersionData.featureEdit},on:{edit:function(t){e.activeVersionData.featureEdit=!0},save:e.saveFeture}})],1)]),e.activeVersionData.featureEdit?t("el-input",{staticClass:"featureList",staticStyle:{height:"100%"},attrs:{type:"textarea",resize:"none",readonly:!e.activeVersionData.featureEdit,placeholder:"无"},model:{value:e.activeVersionData.ability,callback:function(t){e.$set(e.activeVersionData,"ability",t)},expression:"activeVersionData.ability"}}):t("el-row",{key:e.activeVersionData.id,staticClass:"featureList",staticStyle:{"flex-wrap":"wrap"},attrs:{type:"flex",gutter:3}},e._l(e.textFormat(e.activeVersionData.ability),(function(a,i){return t("el-col",{key:i,staticStyle:{margin:"1px 0"},attrs:{span:8}},[t("el-tag",{attrs:{type:"info",size:"mini"}},[e._v(e._s(a))])],1)})),1)],1)],1):[t("el-empty",{attrs:{description:"无数据"}})],t("share",{ref:"shareRef"}),t("addNewAgent",{ref:"addNewAgentRef"})],2)},l=[],c=a(9669),d=a.n(c),h=a(30381),p=a.n(h),m=function(){var e=this,t=e._self._c;return t("span",[e.value?t("span",{staticStyle:{color:"var(--themeColor)",cursor:"pointer"},on:{click:e.saveHandler}},[e._v(" 保存 ")]):t("i",{staticClass:"el-icon-edit-outline",staticStyle:{cursor:"pointer",color:"#409eff"},on:{click:e.editHandler}})])},u=[],f={props:{value:Boolean},methods:{saveHandler(){this.$emit("save")},editHandler(){this.$emit("edit")}}},v=f,g=a(1001),y=(0,g.Z)(v,m,u,!1,null,"b08bc708",null),b=y.exports,w=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{visible:e.downShow,title:("share"===e.type?"分享":"下载")+"客户端",width:"300px"},on:{"update:visible":function(t){e.downShow=t}}},[t("el-select",{staticStyle:{width:"100%"},attrs:{size:"small","value-key":"id"},on:{change:e.seletRoom},model:{value:e.selectData,callback:function(t){e.selectData=t},expression:"selectData"}},e._l(e.roomData,(function(e){return t("el-option",{key:e.id,attrs:{value:e,label:e.name}})})),1),t("div",{staticStyle:{"margin-top":"20px"}},["share"===e.type?[t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.lanShare}},[e._v("内网分享 ")]),t("el-button",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:e.copyvalue,expression:"copyvalue",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:e.firstCopySuccess,expression:"firstCopySuccess",arg:"success"}],attrs:{type:"primary",size:"small"},on:{click:e.vipShare}},[e._v("外网分享 ")])]:t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.downFile}},[e._v("下载")])],2),t("button",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"},{name:"clipboard",rawName:"v-clipboard:copy",value:e.copyvalue,expression:"copyvalue",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:e.firstCopySuccess,expression:"firstCopySuccess",arg:"success"}],ref:"copyvalueRef",staticStyle:{display:"inline-block"}})],1)},x=[],D={data(){return{downShow:!1,roomData:[],selectData:{},copyvalue:"",value:"",editionId:"",activeData:{},type:"share"}},methods:{firstCopySuccess(){this.$message.success("内容已复制到剪切板！")},openDialog(e,t="share"){this.type=t,this.editionId=e.id,this.activeData=e,this.downShow=!0,this.$request.fetchGetIndices().then((e=>{this.roomData=e.data,this.selectData=this.roomData?.[0]||null}))},downFile(){if(this.selectData.id){let e=document.createElement("a");e.href="/api/v1/deploy/minion/download?id="+this.editionId+"&broker_id="+this.selectData.id,e.target="_blank",e.click()}else this.$message.error("请选择")},lanShare(){this.copyvalue="",this.selectData.id?this.selectData?.lan?.length>0?this.$request.fetchGetLan().then((e=>{const t=e.data.scheme+"://"+e.data.addr+"/api/v1/deploy/minion?"+new URLSearchParams({broker_id:this.selectData.id,goos:this.activeData.goos,arch:this.activeData.arch,version:this.activeData.semver,unstable:this.activeData.unstable,customized:this.activeData.customized});this.copyvalue="windows"!==this.activeData.goos?`curl "${t}" | /bin/bash`:t,this.$nextTick((()=>{this.$refs.copyvalueRef.click()}))})).catch((e=>{console.error(e),this.$message.error("复制地址出错")})):(this.copyvalue="",this.$message.error("暂无内网")):(this.copyvalue="",this.$message.error("请选择"))},vipShare(){if(this.copyvalue="",this.selectData.id){const e=window.location.protocol+"//"+window.location.host+"/api/v1/deploy/minion?"+new URLSearchParams({broker_id:this.selectData.id,goos:this.activeData.goos,arch:this.activeData.arch,version:this.activeData.semver,unstable:this.activeData.unstable,customized:this.activeData.customized});this.copyvalue="windows"!==this.activeData.goos?`curl "${e}" | /bin/bash`:e}else this.$message.error("请选择")},seletRoom(){this.$request.fetchGetLan().then((e=>{this.value=e.data.scheme+"://"+e.data.addr+"/api/v1/deploy/minion?goos="+this.activeData.goos+"&broker_id="+this.selectData.id+"&arch="+this.activeData.arch}))}}},_=D,S=(0,g.Z)(_,w,x,!1,null,"b884d93a",null),$=S.exports,k=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{"el-dialog":"",visible:e.fileShow,title:e.form.goos?"新增版本":"新增系统类型并上传新版本","append-to-body":"",width:"500px","destroy-on-close":""},on:{"update:visible":function(t){e.fileShow=t},close:e.onClose}},[t("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,size:"small","label-width":"100px"}},[t("el-form-item",{attrs:{label:"名称",prop:"name"}},[t("el-input",{attrs:{type:"text",placeholder:"请输入安装包名称",size:"mini"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e.editcustomized?t("el-form-item",{attrs:{label:"发行版本",prop:"customized"}},[t("el-input",{attrs:{type:"text",readonly:!e.editcustomized,placeholder:"请输入发行版本名称，例：标准版",size:"mini"},model:{value:e.form.customized,callback:function(t){e.$set(e.form,"customized",t)},expression:"form.customized"}})],1):e._e(),e.eidtGoos?t("el-form-item",{attrs:{label:"操作系统",prop:"goos"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{disabled:!e.eidtGoos,size:"mini"},model:{value:e.form.goos,callback:function(t){e.$set(e.form,"goos",t)},expression:"form.goos"}},e._l(e.paltformList,(function(e,a){return t("el-option",{key:a,attrs:{value:e,label:e}})})),1)],1):e._e(),e.eidtGoos?t("el-form-item",{attrs:{label:"系统架构",prop:"arch"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{disabled:!e.eidtGoos},model:{value:e.form.arch,callback:function(t){e.$set(e.form,"arch",t)},expression:"form.arch"}},e._l(e.archData,(function(e){return t("el-option",{key:e.label,attrs:{value:e.value,label:e.label}})})),1)],1):e._e(),t("el-form-item",{attrs:{label:"版本号",prop:"semver"}},[t("el-input",{attrs:{type:"text",placeholder:"例:1.1.0",size:"mini"},model:{value:e.form.semver,callback:function(t){e.$set(e.form,"semver",t)},expression:"form.semver"}})],1),t("el-form-item",{attrs:{label:"是否测试版",prop:"unstable"}},[t("el-radio-group",{model:{value:e.form.unstable,callback:function(t){e.$set(e.form,"unstable",t)},expression:"form.unstable"}},[t("el-radio",{attrs:{label:!1}},[e._v("否")]),t("el-radio",{attrs:{label:!0}},[e._v("是")])],1)],1),t("el-form-item",{attrs:{label:"文件",prop:"file"}},[t("el-upload",{ref:"file",staticClass:"upload-demo",attrs:{action:"/","on-remove":e.handleRemove,"before-remove":e.beforeRemove,"on-change":e.filseSuccess,multiple:"",limit:1,accept:"windows"===e.form.goos?".exe":"","on-exceed":e.handleExceed,"auto-upload":!1}},[t("el-button",{attrs:{size:"small",icon:"el-icon-upload"}},[e._v("点击上传")])],1)],1),t("el-form-item",{attrs:{label:"功能列表",prop:"ability"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:2},placeholder:"请输入内容"},model:{value:e.form.ability,callback:function(t){e.$set(e.form,"ability",t)},expression:"form.ability"}})],1),t("el-form-item",{attrs:{label:"注意事项",prop:"caution"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:2},placeholder:"请输入内容"},model:{value:e.form.caution,callback:function(t){e.$set(e.form,"caution",t)},expression:"form.caution"}})],1),t("el-form-item",{attrs:{label:"版本更新日志",prop:"changelog"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:2},placeholder:"请输入内容"},model:{value:e.form.changelog,callback:function(t){e.$set(e.form,"changelog",t)},expression:"form.changelog"}})],1)],1),e.showProgress?t("el-progress",{attrs:{percentage:e.percentageformat}}):e._e(),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"small"},on:{click:function(t){e.fileShow=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.onSubmit("form")}}},[e._v("提交")])],1)],1)},z=[];function V(e,t,a){return t=C(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function C(e){var t=N(e,"string");return"symbol"===typeof t?t:String(t)}function N(e,t){if("object"!==typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var i=a.call(e,t||"default");if("object"!==typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}class T{constructor(){V(this,"customized",""),V(this,"name",""),V(this,"goos",""),V(this,"file",""),V(this,"arch",""),V(this,"semver",""),V(this,"changelog",""),V(this,"unstable",!1),V(this,"ability",""),V(this,"caution","")}formatter(){let e=new FormData;return e.append("name",this.name),e.append("semver",this.semver),e.append("goos",this.goos),e.append("arch",this.arch),e.append("changelog",this.changelog),e.append("ability",this.ability),e.append("unstable",this.unstable),e.append("caution",this.caution),e.append("customized","标准版"===this.customized?"":this.customized),e.append("file",this.file),e}}var A={data(){return{form:new T,fileShow:!1,showProgress:!1,percentage:0,paltformList:["linux","windows","darwin"],timer:null,eidtGoos:!1,editcustomized:!1,rules:{file:[{required:!0,message:"请上传文件",trigger:"change"}],customized:[{required:!0,message:"请输入发行版本名称",trigger:"change"}],semver:[{required:!0,message:"请输入版本",trigger:"blur"}],name:[{required:!0,message:"请输入文件名",trigger:"blur"}],arch:[{required:!0,message:"请输入系统架构",trigger:"change"}],goos:[{required:!0,message:"请输入操作系统",trigger:"blur"}]},archData:[{value:"386",label:"386"},{value:"amd64",label:"amd64"}],res:null,rej:null}},computed:{percentageformat(){return Math.min(100,+Number(this.percentage).toFixed(1))}},methods:{openDialog(e,t,a){return this.$nextTick((()=>{this.$refs.form?.resetFields()})),this.form=new T,this.form.customized=e,this.form.goos=t,this.form.arch=a,this.fileShow=!0,this.showProgress=!1,this.percentage=0,this.eidtGoos=!t,this.editcustomized=!e,clearInterval(this.timer),new Promise(((e,t)=>{this.res=e,this.rej=t}))},filseSuccess(e,t){this.form.file=e.raw},handleRemove(e,t){this.form.file=""},beforeRemove(e,t){return this.$confirm(`确定移除 ${e.name} ？`)},handleExceed(e,t){this.$message.warning(`当前限制选择 3 个文件，本次选择了 ${e.length} 个文件，共选择了 ${e.length+t.length} 个文件`)},onSubmit(){const e=this.form.formatter();this.showProgress=!0,this.percentage=0,clearInterval(this.timer),this.timer=setInterval((()=>{this.percentage<30?this.percentage+=.3:this.percentage<80?this.percentage+=50/150:this.percentage<90?this.percentage+=.1:this.percentage<98?this.percentage+=.04:this.percentage+=.004,this.percentage>=100&&clearInterval(this.timer)}),100),this.$request.fetchUploadFile(e).then((e=>{this.$message({message:"添加成功!!!",type:"success"}),this.fileShow=!1,this.res()})).catch((e=>{this.$message.error(e.data)})).finally((()=>{this.showProgress=!1}))},onClose(){this.rej?.()}}},R=A,E=(0,g.Z)(R,k,z,!1,null,"6c4ee850",null),q=E.exports,I=a(42325),L={components:{editAndSavaBtn:b,addNewAgent:q,share:$},props:{agentType:{required:!0,type:String},goos:{required:!0,type:String},arch:{required:!0,type:String}},data(){return{versionData:[],defaultActive:"",textarea:""}},computed:{activeVersionData(){return this.versionData.find((e=>e.id===this.defaultActive))},goosIcon(){return/^\s*(mac|ios|darwin)\s*$/i.test(this.goos)?"mac":/^\s*(windows|win|window)\s*$/i.test(this.goos)?"Windows":/^\s*(linux)\s*$/i.test(this.goos)?"linux":"应用"}},created(){this.loadVerion()},methods:{async loadVerion(){try{const e=[{key:"goos",operator:"eq",value:this.goos},{key:"arch",operator:"eq",value:this.arch},{key:"customized",operator:"eq",value:"标准版"==this.agentType?"":this.agentType}].map((e=>"filters="+encodeURIComponent(JSON.stringify(e)))).join("&"),{data:t}=await d().get("/monbins?current=1&size=100&"+e);this.versionData=t.records?.filter((e=>e.goos===this.goos)).map((e=>({...e,changelogEdit:!1,featureEdit:!1,tipsEdit:!1,ctimeFormat:p()(e.created_at).format("YYYY-MM-DD HH:mm:ss")})))||[],this.defaultActive=this.versionData[0]?.id}catch(e){}},select(e){let t=this.defaultActive;this.defaultActive=e,"opt"===e&&setTimeout((()=>{this.defaultActive=t}),0)},async saveAgentInfo(){try{await d().patch("/monbin",this.activeVersionData),this.$message.success("保存成功")}catch(e){return this.$message.error(e),Promise.reject()}},async saveChangelog(){await this.saveAgentInfo(),this.activeVersionData.changelogEdit=!1},async saveFeture(){await this.saveAgentInfo(),this.activeVersionData.featureEdit=!1},async saveTips(){await this.saveAgentInfo(),this.activeVersionData.tipsEdit=!1},subDelete(){const e=this.activeVersionData.id;this.$request.fetchDeleteAgent(e).then((async e=>{this.$message({message:"删除成功!!!",type:"success"}),await this.loadVerion(),0===this.versionData.length&&this.$emit("refreshGoos")})).catch((e=>{this.$message.error(e)}))},operaEdition(){const e=this.activeVersionData.id;this.$request.fetchCheckEdtion({id:e}).then((e=>{this.$message({message:"推送成功!!!",type:"success"})})).catch((e=>{this.$message.error(e)}))},deprecate(){const e=this.activeVersionData.id;this.$request.fetchDeprecate({id:e}).then((e=>{this.$message({message:"标记成功",type:"success"}),this.loadVerion()})).catch((e=>{this.$message.error(e.data)}))},addNewAgent(){this.$refs.addNewAgentRef.openDialog(this.agentType,this.goos,this.arch).then((()=>{this.loadVerion()})).catch((()=>{}))},downLoad(){(0,I.NM)("monbin?id="+this.activeVersionData.id)},textFormat(e){return e?.split("\n").filter((e=>!!e))}}},P=L,j=(0,g.Z)(P,n,l,!1,null,"c553390e",null),F=j.exports,G={props:{agentType:String,goosOptions:Array},components:{agent:F,addNewAgent:q},data(){return{sysActive:"",sysActiveCache:"",sysTypes:[],arch:"",goos:""}},watch:{goosOptions:{handler(e){this.sysTypes=e.map((e=>({id:e.goos+"-"+e.arch,...e}))),e?.length&&this.select(this.sysTypes?.[0]?.id)},immediate:!0}},created(){},methods:{async loadAgentDetail(){},select(e){const t=this.sysActive;if(this.sysActive=e,"add"===e)setTimeout((()=>{this.sysActive=t}),0);else if(t!==e){this.sysActiveCache=e;const t=this.sysTypes.find((t=>t.id===e));this.goos=t.goos,this.arch=t.arch}},addNew(){this.$refs.addNewAgentRef.openDialog(this.agentType).then((()=>{this.$emit("refresTab")}))}}},O=G,Z=(0,g.Z)(O,o,r,!1,null,"42f758ba",null),H=Z.exports,B=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{"el-dialog":"",visible:e.show,title:"新增类型","append-to-body":"",width:"300px","destroy-on-close":""},on:{"update:visible":function(t){e.show=t},close:e.onClose}},[t("el-form",{ref:"formRef",attrs:{model:e.form,size:"small","label-position":"top"}},[t("el-form-item",{attrs:{label:"名称:",prop:"name",rules:e.required}},[t("el-input",{attrs:{placeholder:"请输入类型名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),t("el-form-item",{attrs:{label:"图标:",prop:"icon",rules:e.required}},[t("el-popover",{attrs:{placement:"bottom-start",width:"460",trigger:"click"},on:{show:function(t){return e.$refs["iconSelect"].reset()}}},[t("IconSelect",{ref:"iconSelect",on:{selected:t=>e.form.icon=t}}),t("el-input",{attrs:{slot:"reference",placeholder:"点击选择图标",readonly:""},slot:"reference",model:{value:e.form.icon,callback:function(t){e.$set(e.form,"icon",t)},expression:"form.icon"}},[e.form.icon?t("svg-icon",{staticClass:"el-input__icon",staticStyle:{height:"16px",width:"16px"},attrs:{slot:"prefix","icon-class":e.form.icon},slot:"prefix"}):t("i",{staticClass:"el-icon-search el-input__icon",attrs:{slot:"prefix"},slot:"prefix"})],1)],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"small"},on:{click:function(t){e.show=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.onSubmit("form")}}},[e._v("提交")])],1)],1)},Y=[],M=a(90023),U=a(91938);function J(e,t,a){return t=W(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function W(e){var t=K(e,"string");return"symbol"===typeof t?t:String(t)}function K(e,t){if("object"!==typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var i=a.call(e,t||"default");if("object"!==typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}class Q{constructor(){J(this,"name",""),J(this,"icon","")}}var X={components:{IconSelect:U.Z},data(){return{form:new Q,show:!1,required:{required:!0,message:"请填写必填选项",trigger:"change"},res:null,rej:null}},computed:{},methods:{openDialog(e,t,a){return this.$nextTick((()=>{this.$refs.form?.resetFields()})),this.form=new Q,this.show=!0,new Promise(((e,t)=>{this.res=e,this.rej=t}))},async onSubmit(){try{await this.$refs.formRef.validate().catch((()=>{throw"请输入必填项"}));const e=this.form;await M.Z.post("/monbin/customized",e),this.show=!1,this.$message.success("保存成功"),this.res()}catch(e){this.$message.error(e)}},onClose(){this.rej?.()}}},ee=X,te=(0,g.Z)(ee,B,Y,!1,null,"44d8393e",null),ae=te.exports,ie={components:{platform:H,addNewTab:ae},data(){return{activeName:"",tabs:[],goosOptions:[]}},created(){this.loadTabs()},methods:{async loadTabs(){try{const{data:e}=await d().get("/monbin/customizes"),t=(await d().get("/monbin/classify"))?.data?.reduce(((e,t)=>(e[t.customized||"标准版"]=t.structures,e)),{});this.tabs=[{name:"标准版",value:"标准版"},...e].map(((e,a)=>({id:e.id,label:e.name,value:e.name,icon:e.icon||"通用",children:t[e.name]||[]}))),this.activeName=this.activeName||this.tabs[0].value;const a=this.tabs.find((e=>e.value===this.activeName));this.goosOptions=a.children||[]}catch(e){}},addNew(){this.$refs.addNewTabRef.openDialog().then((()=>{this.loadTabs()})).catch((()=>{}))},beforeTabLeave(e,t){if("add"===e)return this.addNew(),!1;const a=this.tabs.find((t=>t.value===e));return this.goosOptions=a.children,!0},async deleteTag(e){try{await d()["delete"]("/monbin/customized",{data:{id:e}}),this.$message.success("删除成功"),this.loadTabs()}catch(t){this.$message.error(t)}}}},se=ie,oe=(0,g.Z)(se,i,s,!1,null,"0f3e370c",null),re=oe.exports}}]);