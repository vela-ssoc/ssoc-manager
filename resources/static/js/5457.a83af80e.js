"use strict";(self["webpackChunkssoc"]=self["webpackChunkssoc"]||[]).push([[5457],{85457:function(t,e,r){r.r(e),r.d(e,{default:function(){return y}});var a=function(){var t=this,e=t._self._c;return e("div",[e("div",[t._t("prefix"),e("el-button",{staticStyle:{"margin-left":"0"},attrs:{type:"primary",size:"mini"},on:{click:t.addRelation}},[t._v("添加 ")])],2),e("el-table",{staticStyle:{width:"100%","margin-top":"5px"},attrs:{data:t.roomData,"header-cell-style":{color:"#909399",textAlign:"center",background:"#f5f7fa"}}},[e("el-table-column",{attrs:{prop:"status",label:"状态",width:"70"},scopedSlots:t._u([{key:"default",fn:function(r){return[e("el-tag",{attrs:{type:!0===r.row.status?"success":"danger",size:"mini"}},[t._v(" "+t._s(!0===r.row.status?"在线":"离线")+" ")])]}}])}),e("el-table-column",{attrs:{prop:"name",label:"名称",width:"175"}}),e("el-table-column",{attrs:{label:"证书名称",width:"175"},scopedSlots:t._u([{key:"default",fn:function({row:r}){return[e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.$jumpTo({path:"/brkbin",query:{page:"cert",keyword:r.certificate&&r.certificate.name}},"证书管理")}}},[t._v(" "+t._s(r.certificate&&r.certificate.name)+" ")])]}}])}),e("el-table-column",{attrs:{prop:"name",label:"证书过期时间",width:"225"},scopedSlots:t._u([{key:"default",fn:function({row:r}){return[r.certificate?e("div",[e("span",[t._v(t._s(r.certificate&&r.certificate.not_after&&t.moment(r.certificate.not_after).format("YYYY-MM-DD HH:mm:ss")))]),t.isDeadLing(r.certificate.not_after)?e("el-tag",{attrs:{size:"mini",type:"danger"}},[t._v(" 临近过期 ")]):t._e()],1):t._e()]}}])}),e("el-table-column",{attrs:{label:"端点"},scopedSlots:t._u([{key:"default",fn:function(r){return[e("div",{staticStyle:{width:"95%",margin:"0 auto","text-align":"left"}},[e("p",[t._v(" vip: "),t._l(r.row.vip,(function(r,a){return e("el-tag",{key:a,staticStyle:{"margin-right":"5px"},attrs:{size:"mini"}},[t._v(" "+t._s(r)+" ")])}))],2),e("p",[t._v(" lan: "),t._l(r.row.lan,(function(r,a){return e("el-tag",{key:a,staticStyle:{"margin-right":"5px"},attrs:{size:"mini"}},[t._v(" "+t._s(r)+" ")])}))],2)])]}}])}),e("el-table-column",{attrs:{prop:"servername",label:"服务名称"}}),e("el-table-column",{attrs:{prop:"updated_at",label:"最后一次心跳时间",width:"175"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("date")(e.row.updated_at,"yyyy-MM-dd hh:mm:ss"))+" ")]}}])}),e("el-table-column",{attrs:{label:"操作",width:"100",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(r){return[e("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(e){return t.editRoom(r.row)}}},[t._v("编辑")]),e("el-popconfirm",{attrs:{"confirm-button-text":"确认","cancel-button-text":"取消",icon:"el-icon-info","icon-color":"red",title:"确定删除？"},on:{confirm:function(e){return t.delCode(r.row)}}},[e("el-button",{attrs:{slot:"reference",type:"text",size:"mini"},slot:"reference"},[t._v("删除")])],1)]}}])})],1),e("RoomForm",{ref:"room",on:{getRooms:t.getRooms}})],1)},o=[],i=function(){var t=this,e=t._self._c;return e("el-dialog",{attrs:{visible:t.roomShow,title:"add"===t.form.operateType?"添加链接":"编辑链接",width:"30%"},on:{"update:visible":function(e){t.roomShow=e}}},[e("el-form",{ref:"form",attrs:{model:t.form,"label-width":"95px"}},[e("el-form-item",{attrs:{label:"名称"}},[e("el-input",{attrs:{size:"small"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),e("el-form-item",{attrs:{label:"bind"}},[e("el-input",{attrs:{size:"small"},model:{value:t.form.bind,callback:function(e){t.$set(t.form,"bind",e)},expression:"form.bind"}})],1),e("el-form-item",{attrs:{label:"servername"}},[e("el-input",{attrs:{size:"small"},model:{value:t.form.servername,callback:function(e){t.$set(t.form,"servername",e)},expression:"form.servername"}})],1),e("el-form-item",{attrs:{label:"lan"}},[e("el-input",{attrs:{type:"textarea",rows:2,placeholder:"每行输入一个（域名或ip），例10.224.111.162:1433"},model:{value:t.form.lanStr,callback:function(e){t.$set(t.form,"lanStr",e)},expression:"form.lanStr"}})],1),e("el-form-item",{attrs:{label:"vip"}},[e("el-input",{attrs:{type:"textarea",rows:2,placeholder:"每行输入一个（域名或ip），例10.224.111.162:1433"},model:{value:t.form.vipStr,callback:function(e){t.$set(t.form,"vipStr",e)},expression:"form.vipStr"}})],1),e("el-form-item",{attrs:{label:"证书"}},[e("el-select",{staticStyle:{width:"100%"},attrs:{clearable:""},model:{value:t.form.cert_id,callback:function(e){t.$set(t.form,"cert_id",e)},expression:"form.cert_id"}},t._l(t.certList,(function(t,r){return e("el-option",{key:r,attrs:{label:t.name,value:t.id}})})),1)],1)],1),e("span",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){return t.submit()}}},[t._v("提交")])],1)],1)},s=[],n=r(9669),l=r.n(n);class m{constructor(t){this.operateType=t?.operateType||"add",this.name=t?.name,this.bind=t?.bind,this.servername=t?.servername,this.lan=t?.lan,this.vip=t?.vip,this.id=t?.id,this.lanStr=this.lan?.join("\n")||"",this.vipStr=this.vip?.join("\n")||"",this.cert_id=t?.cert_id}formatter(){return{...this,lan:this.lanStr?this.lanStr?.split("\n"):[],vip:this.vipStr?this.vipStr?.split("\n"):[],cert_id:this.cert_id||null}}}var c={name:"formRoom",data(){return{roomShow:!1,isAdd:!0,lanText:"",vipText:"",form:new m,certList:[]}},created(){this.loadCertList()},methods:{openDialog(t){this.form=new m(t),this.roomShow=!0},async submit(){try{await this.$refs.form.validate().catch((()=>{throw"请检查必填项"})),""!==this.lanText&&(this.form.lan=this.lanText.split("\n")),""!==this.vipText&&(this.form.vip=this.vipText.split("\n")),"add"===this.form.operateType?await this.$request.fetchAddRooms(this.form.formatter()):await l().patch("/broker",this.form.formatter()),this.$message({message:"提交成功",type:"success"}),this.$emit("getRooms"),this.roomShow=!1}catch(t){this.$message.error(t)}},async loadCertList(){try{const{data:t}=await l().get("/cert/indices");this.certList=t||[]}catch(t){this.$message.error(t)}}}},f=c,u=r(1001),d=(0,u.Z)(f,i,s,!1,null,"2153b45c",null),p=d.exports,h=(r(28451),r(30381)),b=r.n(h),v={name:"index",components:{RoomForm:p},data(){return{moment:b(),delLoading:!1,roomData:[]}},mounted(){this.getRooms()},methods:{isDeadLing(t){return b()(t).subtract(1,"months")<b()()},getRooms(){this.$request.fetchGetRooms().then((t=>{this.roomData=t.data.records}))},addRoom(){this.$refs.room?.openDialog()},editRoom(t){this.$refs.room?.openDialog({operateType:"edit",...t})},async delCode(t){try{await l()({url:"/broker",method:"delete",data:{id:t.id}}),this.$message({message:"删除成功!!!",type:"success"}),this.getRooms()}catch(e){this.$message.error(e)}},addRelation(){var t=this.$refs.room;t.roomShow=!0}}},g=v,_=(0,u.Z)(g,a,o,!1,null,"1a861165",null),y=_.exports},28451:function(t,e,r){var a=r(20144);a["default"].filter("date",(function(t,e){var r=new Date(t),a={"M+":r.getMonth()+1,"d+":r.getDate(),"h+":r.getHours(),"m+":r.getMinutes(),"s+":r.getSeconds(),"q+":Math.floor((r.getMonth()+3)/3),S:r.getMilliseconds()};for(var o in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(r.getFullYear()+"").substr(4-RegExp.$1.length))),a)new RegExp(`(${o})`).test(e)&&(e=e.replace(RegExp.$1,1===RegExp.$1.length?a[o]:("00"+a[o]).substr((""+a[o]).length)));return e}))}}]);