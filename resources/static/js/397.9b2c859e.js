"use strict";(self["webpackChunkssoc"]=self["webpackChunkssoc"]||[]).push([[397],{74804:function(t,e,i){i.d(e,{A:function(){return m}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"icon-body"},[e("el-input",{staticStyle:{position:"relative"},attrs:{clearable:"",placeholder:"请输入图标名称"},on:{clear:t.filterIcons},nativeOn:{input:function(e){return t.filterIcons.apply(null,arguments)}},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}},[e("i",{staticClass:"el-icon-search el-input__icon",attrs:{slot:"suffix"},slot:"suffix"})]),e("div",{staticClass:"icon-list"},t._l(t.iconList,(function(i,s){return e("div",{key:s,on:{click:function(e){return t.selectedIcon(i)}}},[e("svg-icon",{staticStyle:{height:"40px",width:"26px"},attrs:{"icon-class":i}})],1)})),0)],1)},o=[];const a=i(72922),l=t=>t.keys(),n=/\.\/(.*)\.svg/,r=l(a).map((t=>t.match(n)[1]));var c=r,d={name:"IconSelect",data(){return{name:"",iconList:c}},methods:{filterIcons(){this.name?this.iconList=this.iconList.filter((t=>t.includes(this.name))):this.iconList=c},selectedIcon(t){this.$emit("selected",t),document.body.click()},reset(){this.name="",this.iconList=c}}},u=d,p=i(81656),h=(0,p.A)(u,s,o,!1,null,"4634c9b8",null),m=h.exports},32268:function(t,e,i){i.d(e,{A:function(){return x}});var s=function(){var t=this,e=t._self._c;return e("div",{staticStyle:{width:"100%"}},[e("div",{staticClass:"tableHead"},[e("div",{staticStyle:{flex:"1","margin-right":"5px"}},[t._t("right_top_btn")],2),e("span",{staticClass:"icon"},[t.refreshAble?e("i",{staticClass:"el-icon-refresh",attrs:{title:"重加载数据"},on:{click:t.loadData}}):t._e(),t.configAble&&"inhead"!==t.configIconPos?e("i",{class:{"el-icon-setting":!0},attrs:{title:"编辑表格"},on:{click:function(e){t.dialogVisible=!0}}}):t._e()])]),e("div",{staticStyle:{position:"relative"}},[t.configAble&&"inhead"===t.configIconPos?e("i",{staticClass:"el-icon-setting iconInHead",attrs:{title:"编辑表格"},on:{click:function(e){t.dialogVisible=!0}}}):t._e()]),e("el-table",t._g(t._b({ref:"table",staticStyle:{width:"100%"},attrs:{"header-cell-style":t.$attrs["header-cell-style"]||{color:"#909399",textAlign:"center",background:"#f5f7fa"},data:t.showData,stripe:t.stripe},on:{"selection-change":t.selectionChange}},"el-table",t.$attrs,!1),t.$listeners),[t.selection?e("el-table-column",{attrs:{selectable:t.selectable,type:"selection"}}):t._e(),t.index?e("el-table-column",{attrs:{type:"index",label:"序号",align:"center",fixed:"left"}}):t._e(),t._l(t.showColumn,(function(i,s){return[e("el-table-column",{key:s,attrs:{prop:i&&i.prop,label:i&&i.label,width:i&&i.width,"min-width":i&&i["min-width"],fixed:i&&i.fixed,formatter:i&&i.formatter,"show-overflow-tooltip":i&&i["show-overflow-tooltip"]||!1,sortable:i&&i.sortable,"sort-method":i&&i["sort-method"],"sort-by":i&&i["sort-by"],align:i&&i.align||"center","sort-orders":i&&i["sort-orders"],type:i&&i.type,"class-name":i&&i["class-name"]},scopedSlots:t._u([i&&i.slotHeader?{key:"header",fn:function(e){return[t._t(i&&i.slotHeader,null,{row:e.row,col:i,$index:e.$index})]}}:null,i&&i.slot?{key:"default",fn:function(e){return[t._t(i&&i.slot,null,{row:e.row,col:i,$index:e.$index})]}}:null],null,!0)})]}))],2),t.needPagination?e("div",{style:t.paginationStyle},[e("el-pagination",{attrs:{"current-page":t.pagination.pageIndex,"page-sizes":t.pagination.pageSizes||[15,30,50],"page-size":t.pagination.pageSize,layout:t.pagination.layout||"jumper, sizes, prev, pager, next,total",total:t.pagination.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange,"update:currentPage":function(e){return t.$set(t.pagination,"pageIndex",e)},"update:current-page":function(e){return t.$set(t.pagination,"pageIndex",e)},"update:pageSize":function(e){return t.$set(t.pagination,"pageSize",e)},"update:page-size":function(e){return t.$set(t.pagination,"pageSize",e)}}})],1):t._e(),e("ColumnConfig",{attrs:{columns:t.filterColumns,visible:t.dialogVisible,selectColumn:t.selectedColumn},on:{"update:visible":function(e){t.dialogVisible=e},"update:selectColumn":function(e){t.selectedColumn=e},"update:select-column":function(e){t.selectedColumn=e}}})],1)},o=[],a=function(){var t=this,e=t._self._c;return e("div",[e("el-dialog",{attrs:{title:"设置需展示的列",visible:t.dialogVisible,width:"800px","append-to-body":""},on:{open:function(e){return t.opened()},"update:visible":function(e){t.dialogVisible=e}}},[e("div",[e("el-checkbox",{attrs:{indeterminate:t.isIndeterminate},on:{change:t.handleCheckAllChange},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}},[t._v("全选")]),e("el-button",{staticStyle:{"text-decoration":"underline",color:"red"},attrs:{type:"text"},on:{click:function(e){return t.$refs.SortColumn.open()}}},[t._v("手动排序")]),e("el-button",{staticStyle:{"text-decoration":"underline",color:"red"},attrs:{type:"text"},on:{click:t.reset}},[t._v("重置配置")]),e("div",{staticStyle:{margin:"15px 0"}}),e("el-checkbox-group",{on:{change:t.handleCheckedCitiesChange},model:{value:t.checkboxSelectBuff,callback:function(e){t.checkboxSelectBuff=e},expression:"checkboxSelectBuff"}},t._l(t.__column,(function(i){return e("el-col",{key:i.columnUUkey,staticClass:"colCheckbox",attrs:{span:8}},[e("el-checkbox",{attrs:{title:i.label,label:i.columnUUkey}},[t._v(t._s(i.label)+" ")])],1)})),1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{size:"small"},on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.confirm}},[t._v("确 定")])],1)]),e("SortColumn",{ref:"SortColumn",attrs:{column:t.__column},on:{close:t.clsoeSort}})],1)},l=[],n=function(){var t=this,e=t._self._c;return e("el-dialog",{attrs:{title:"拖动节点进行排序",visible:t.dialogVisible,width:"500px","append-to-body":""},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("el-tree",{attrs:{data:t.data,"node-key":"columnUUkey","default-expand-all":"",draggable:"","allow-drop":t.allowDrog}}),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.close}},[t._v("确 定")])],1)],1)},r=[],c={props:{column:{type:Array,require:!0}},data(){return{data:[],dialogVisible:!1}},created(){},methods:{open(){this.dialogVisible=!0,this.data=this.column.map((t=>({columnUUkey:t.columnUUkey,label:t.label})))},close(){this.dialogVisible=!1,this.$emit("close",this.data.map((t=>t.columnUUkey)))},allowDrog(t,e,i){return"inner"!==i}}},d=c,u=i(81656),p=(0,u.A)(d,n,r,!1,null,null,null),h=p.exports,m={props:{columns:{type:Array,default:()=>[]},visible:{type:Boolean,require:!0,default:!1},selectColumn:{type:Array,default:()=>[]}},components:{SortColumn:h},computed:{dialogVisible:{get(){return this.visible},set(t){this.$emit("update:visible",t)}},checkboxSelect:{get(){return this.selectColumn},set(t){this.$emit("update:selectColumn",t)}},__column(){return this.columns.map((t=>({label:t.label,columnUUkey:t.prop||t.slot}))).sort(((t,e)=>(this.__sortWeight[t.columnUUkey]||0)-(this.__sortWeight[e.columnUUkey]||0)))},__sortWeight(){const t={};for(let e=0;e<this.sortColumnList.length;e++)t[this.sortColumnList[e]]=e;return t}},data(){return{sortColumnList:[],checkAll:!1,isIndeterminate:!1,checkboxSelectBuff:[],oldColumns:[]}},methods:{handleCheckAllChange(t){this.checkboxSelectBuff=t?this.__column.map((t=>t.columnUUkey)):[],this.isIndeterminate=!1},handleCheckedCitiesChange(t){this.checkboxSelectBuff=t;let e=t.length;this.checkAll=e===this.__column.length,this.isIndeterminate=e>0&&e<this.__column.length},opened(){const t=this.__column.filter((t=>!this.oldColumns.includes(t.columnUUkey))).map((t=>t.columnUUkey));this.checkboxSelectBuff=this.checkboxSelectBuff.concat(t).sort(((t,e)=>(this.__sortWeight[t]||0)-(this.__sortWeight[e]||0))),this.oldColumns=this.__column.map((t=>t.columnUUkey)),this.checkAll=this.checkboxSelectBuff.length===this.__column.length,this.isIndeterminate=this.checkboxSelectBuff.length>0&&this.checkboxSelectBuff.length<this.__column.length},clsoeSort(t){this.sortColumnList=this.oldColumns=t||[],this.checkboxSelectBuff=this.checkboxSelectBuff.sort(((t,e)=>(this.__sortWeight[t]||0)-(this.__sortWeight[e]||0)))},reset(){this.sortColumnList=[],this.checkboxSelectBuff=this.__column.map((t=>t.columnUUkey))},confirm(){this.checkboxSelect=this.checkboxSelectBuff,this.sortColumnList=this.oldColumns,this.dialogVisible=!1}}},f=m,g=(0,u.A)(f,a,l,!1,null,"25f6eb76",null),b=g.exports,y={name:"table_list",components:{ColumnConfig:b},props:{data:{type:Array,required:!0,default:()=>[]},pagination:{type:Object,default:()=>({pageIndex:1,pageSize:15,total:0,pageSizes:[15,30,50],layout:"jumper, sizes, prev, pager, next,total"})},localPaginate:{type:Boolean,default:!1},needPagination:{type:Boolean,default:!0},columns:{required:!0,type:Array,default:()=>[]},index:{type:Boolean,default:!1},selection:{type:Boolean,default:!1},selectable:{type:Function,default:()=>()=>{}},selectCountLimit:{type:Number,default:1e6},checkedData:{type:Array,default:()=>[]},configAble:{type:[Boolean],default:!0},configIconPos:{default:"",type:String},refreshAble:{type:Boolean,default:!1},stripe:{type:Boolean,default:!1}},computed:{paginationStyle(){return{display:"flex","padding-top":"10px","flex-direction":"row","justify-content":"left"===this.pagination.align?"flex-start":"flex-end"}},filterColumns(){return this.columns.filter((t=>t.hidden&&"function"===typeof t.hidden?!t.hidden():!t.hidden))},showColumn(){let t=this.filterColumns;return this.selectedColumn.length&&(t=this.selectedColumn.map((t=>this.filterColumns.find((e=>e.prop===t||e.slot===t)))).filter((t=>!!t))),t.map((t=>({...t,columnUUkey:t.prop||t.slot})))},showData(){if(!this.data||!this.data.length)return[];if(!this.needPagination)return this.data;const t=Math.max(this.pagination.pageSize*(this.pagination.pageIndex-1),0),e=Math.min(this.data.length,t+this.pagination.pageSize);return this.data.length===this.pagination.total?this.data.slice(t,e):this.data},_checkedData:{get(){return this.checkedData},set(t){this.$emit("update:checkedData",t)}}},data(){return{selectedColumn:[],dialogVisible:!1}},watch:{data:{handler(t,e){this.resetSelect(),this.localPaginate&&(this.pagination.total=this.data&&this.data.length||0)},immediate:!0},filterColumns(){this.selectedColumn=[]}},mounted(){this.resetSelect()},methods:{loadData(){this.$emit("loadData")},reload(){this.pagination.pageIndex=1,this._checkedData=[],this.$emit("loadData")},selectionChange(t,e){if(t&&t.length>this.selectCountLimit){this.$refs.table.clearSelection();for(let e=0;e<this.selectCountLimit;e++)this.$refs.table.toggleRowSelection(t[t.length-e-1],!0)}else this._checkedData=t},resetSelect(){if(this.$refs.table){this.$refs.table.clearSelection();for(let t of this.data)for(let e of this._checkedData)JSON.stringify(t)===JSON.stringify(e)&&this.$refs.table.toggleRowSelection(t,!0)}},handleSizeChange(){this.localPaginate||(this.pagination.pageIndex=1,this.loadData())},handleCurrentChange(){!this.localPaginate&&this.loadData()}}},v=y,_=(0,u.A)(v,s,o,!1,null,"6202e7cb",null),x=_.exports},60397:function(t,e,i){i.r(e),i.d(e,{default:function(){return M}});var s=function(){var t=this,e=t._self._c;return e("el-card",{staticClass:"contentCard_"},[0===t.page?e("div",[e("div",{staticStyle:{display:"flex","justify-content":"space-between"}},[e("div",[e("el-input",{staticStyle:{width:"300px","margin-right":"10px"},attrs:{size:"small",placeholder:"根据类别名称或者描述过滤",clearable:""},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}}),e("el-button",{attrs:{type:"primary",size:"small"}},[t._v("搜索")])],1),e("div",[e("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.fetchType({})}}},[t._v("新建类型")]),e("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.loadData}},[t._v("刷新")])],1)]),e("div",{staticStyle:{"margin-top":"10px"}},t._l(t.options,(function(i,s){return e("el-card",{key:s,staticStyle:{"margin-bottom":"10px"},attrs:{shadow:"hover"}},[e("div",{staticStyle:{display:"flex","justify-content":"space-between"}},[e("div",[e("b",{staticStyle:{"font-size":"15px"}},[t._v(t._s(i.name||"通用工具"))]),e("p",{staticStyle:{"margin-top":"10px"}},[e("span",{staticClass:"title"},[t._v(" "+t._s(i.remark||"--"))])])]),e("div",[e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.fetchType(i,"edit")}}},[t._v("设置")]),e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.clickCard(s)}}},[t._v("浏览")]),e("el-popconfirm",{staticStyle:{"margin-left":"10px"},attrs:{title:"确定删除吗？"},on:{confirm:function(e){return t.deleteType(i.id)}}},[e("el-button",{staticStyle:{color:"red"},attrs:{slot:"reference",type:"text"},slot:"reference"},[t._v(" 删除")])],1)],1)]),e("div",{staticStyle:{"margin-top":"20px",display:"flex","align-items":"center"},on:{click:function(e){return t.clickCard(s)}}},[e("svg-icon",{staticStyle:{height:"60px","margin-bottom":"10px",width:"60px"},attrs:{"icon-class":i.icon||"通用"}}),e("div",{staticStyle:{flex:"1","margin-left":"20px",display:"flex"}},[e("div",[e("ul",{staticClass:"ulc"},[e("li",[t._v("文件数目")])]),e("p",{staticClass:"fileCount"},[t._v(" "+t._s(i.records?.length||0)+" ")])]),e("div",{staticStyle:{"margin-left":"50px"}},[e("ul",{staticClass:"ulc"},[e("li",[t._v("创建时间")])]),e("p",{staticStyle:{"margin-top":"10px"}},[t._v(" "+t._s(i.created_at_f)+" ")])]),e("div",{staticStyle:{"margin-left":"50px"}},[e("ul",{staticClass:"ulc"},[e("li",[t._v("更新时间")])]),e("p",{staticStyle:{"margin-top":"10px"}},[t._v(" "+t._s(i.updated_at_f)+" ")])])])],1)])})),1)]):e("div",[e("div",{staticStyle:{cursor:"pointer"},on:{click:function(e){t.page=0}}},[e("i",{staticClass:"el-icon-arrow-left"}),t._v(" 返回 "),e("span",{staticStyle:{"margin-left":"10px"}},[t._v(" "+t._s(t.activeOption.name||"通用工具"))])]),e("div",{staticStyle:{display:"flex","justify-content":"space-between","margin-top":"20px"}},[e("div",{staticStyle:{display:"flex","align-items":"center"}},[e("svg-icon",{staticStyle:{height:"40px",width:"40px"},attrs:{"icon-class":t.activeOption.icon||"通用"}}),e("div",{staticStyle:{"margin-left":"10px"}},[e("p",[e("span",{staticClass:"title"},[t._v("创建时间：")]),e("b",[t._v(t._s(t.activeOption.created_at_f))]),e("span",{staticClass:"title",staticStyle:{"margin-left":"10px"}},[t._v("更新时间：")]),e("b",[t._v(t._s(t.activeOption.updated_at_f))]),e("span",{staticClass:"title",staticStyle:{"margin-left":"10px"}},[t._v("描述：")]),e("b",[t._v(t._s(t.activeOption.remark||"--"))])])])],1),e("div",[e("el-input",{staticStyle:{width:"400px","margin-right":"10px"},attrs:{size:"small",placeholder:"根据文件名称,描述或者修改时间过滤",clearable:""},model:{value:t.subkeyword,callback:function(e){t.subkeyword=e},expression:"subkeyword"}},[e("el-button",{attrs:{slot:"append",icon:"el-icon-search"},slot:"append"})],1),e("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.upNewFile}},[t._v("上传")])],1)]),e("div",{staticStyle:{display:"flex",width:"100%"}},[e("div",{staticStyle:{flex:"1","overflow-x":"hidden"}},[e("tableList",{attrs:{data:t.subOptions,columns:t.columns,localPaginate:"",configAble:!1,pagination:t.pagination,"row-class-name":t.rowClassName},on:{"row-click":t.rowClick}})],1),t.subActiveOption?e("div",{staticClass:"right",staticStyle:{width:"400px","padding-left":"20px",display:"flex","flex-direction":"column"}},[e("el-card",{staticStyle:{"margin-top":"5px"}},[e("b",[t._v(t._s(t.subActiveOption.name))]),e("ul",[e("li",[e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.downThird(t.subActiveOption.id)}}},[t._v(" 下载")]),e("el-button",{attrs:{type:"text"},on:{click:t.edit}},[t._v(" 更新")]),t.canEdit?e("el-button",{attrs:{type:"text"},on:{click:t.editFile}},[t._v(" 编辑")]):t._e(),e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.edit("move")}}},[t._v(" 移动")]),e("el-popconfirm",{staticStyle:{"margin-left":"10px"},attrs:{title:"确定删除吗？"},on:{confirm:function(e){return t.delThird(t.subActiveOption.id)}}},[e("el-button",{staticStyle:{color:"red"},attrs:{slot:"reference",type:"text"},slot:"reference"},[t._v(" 删除")])],1)],1)])]),e("el-card",{staticStyle:{"margin-top":"5px",flex:"1"}},[e("b",[t._v(" 文件信息")]),e("el-descriptions",{staticStyle:{"margin-top":"10px"},attrs:{column:1}},[e("el-descriptions-item",{attrs:{label:"名称"}},[t._v(t._s(t.subActiveOption.name))]),e("el-descriptions-item",{attrs:{label:"大小"}},[t._v(t._s(t.company(t.subActiveOption.size)))]),e("el-descriptions-item",{attrs:{label:"hash"}},[t._v(t._s(t.subActiveOption.hash))]),e("el-descriptions-item",{attrs:{label:"路径"}},[t._v(t._s(t.subActiveOption.path))]),e("el-descriptions-item",{attrs:{label:"编号"}},[t._v(t._s(t.subActiveOption.file_id))]),e("el-descriptions-item",{attrs:{label:"描述"}},[t._v(t._s(t.subActiveOption.desc))])],1)],1)],1):t._e()]),e("third-form",{ref:"thirdFormRef",attrs:{typeOptions:t.options?.map((t=>({label:t.name||"通用工具",value:t.name})))||[]}})],1),e("addNewType",{ref:"addNewTypeRef"}),e("editFileContent",{ref:"editRef"})],1)},o=[],a=i(95093),l=i.n(a),n=i(32268),r=i(98362),c=function(){var t=this,e=t._self._c;return e("el-dialog",{attrs:{title:!0===t.isAdd?"新增":"编辑","el-dialog":"","close-on-click-modal":!1,visible:t.fileShow,"append-to-body":"",width:"400px","destroy-on-close":""},on:{"update:visible":function(e){t.fileShow=e},closed:function(e){t.rej?.()}}},[e("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,size:"small","label-width":"75px"}},["move"===t.optType?e("el-form-item",{attrs:{label:"移动到"}},[e("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:""},model:{value:t.form.customized,callback:function(e){t.$set(t.form,"customized",e)},expression:"form.customized"}},t._l(t.typeOptions,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label||"通用工具",value:t.value}})})),1)],1):[t.isAdd?t._e():e("el-form-item",{attrs:{label:""}},[e("el-checkbox",{model:{value:t.form.hasNewFile,callback:function(e){t.$set(t.form,"hasNewFile",e)},expression:"form.hasNewFile"}},[t._v("是否上传新文件覆盖旧文件？")])],1),t.isAdd||t.form.hasNewFile?e("el-form-item",{attrs:{label:"文件",prop:"file"}},[e("el-upload",{ref:"file",staticClass:"upload-demo",attrs:{action:"/","on-remove":t.handleRemove,"before-remove":t.beforeRemove,"on-change":t.filseSuccess,"on-exceed":t.handleExceed,limit:1,"auto-upload":!1}},[e("el-button",{attrs:{size:"small",icon:"el-icon-upload"}},[t._v("点击上传")])],1)],1):t._e(),e("el-form-item",{attrs:{label:"文件名",prop:"name"}},[e("el-input",{attrs:{placeholder:""},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),e("el-form-item",{attrs:{label:"desc",prop:"desc"}},[e("el-input",{attrs:{type:"textarea",rows:2},model:{value:t.form.desc,callback:function(e){t.$set(t.form,"desc",e)},expression:"form.desc"}})],1)]],2),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.onSubmit("form")}}},[t._v("提交")])],1)],1)},d=[];function u(t,e,i){return(e=p(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function p(t){var e=h(t,"string");return"symbol"==typeof e?e:e+""}function h(t,e){if("object"!=typeof t||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}class m{constructor(){u(this,"id",""),u(this,"name",""),u(this,"path",""),u(this,"desc",""),u(this,"file",""),u(this,"customized",""),u(this,"hasNewFile",!1)}}var f={name:"thirdForm",props:{typeOptions:Array},data(){return{form:new m,isAdd:!0,optType:"add",fileShow:!1,res:null,rej:null,rules:{customized:[{required:!0,message:"请选择类别",trigger:"change"}],name:[{required:!0,message:"请输入名称",trigger:"blur"}],path:[{required:!0,message:"请输入path",trigger:"blur"}]}}},methods:{openDialog(t,e="add"){return this.isAdd="add"===e,this.optType=e,this.fileShow=!0,this.form={...new m,...t||{}},new Promise(((t,e)=>{this.res=t,this.rej=e}))},filseSuccess(t,e){console.log(t),this.form.file=t.raw,this.form.name=t.name},handleRemove(t,e){var i=this;i.form.file="",i.form.name=""},beforeRemove(t,e){return this.$confirm(`确定移除${t.name}？`)},handleExceed(t,e){this.$message.warning("只能上传一个文件")},onSubmit(t){this.$refs[t].validate((async t=>{if(t)try{let t=new FormData;this.form.file&&(t.append("file",this.form.file),t.append("name",this.form.name)),t.append("path",this.form.path),t.append("desc",this.form.desc),t.append("customized",this.form.customized),this.isAdd||t.append("id",this.form.id);const e=this.isAdd?this.$request.fetchaddThird:this.$request.fetchUploadThird;await e(t),this.$message({message:"操作成功",type:"success"}),this.fileShow=!1,this.res()}catch(e){this.$message.error(e)}}))}}},g=f,b=i(81656),y=(0,b.A)(g,c,d,!1,null,"386b67e5",null),v=y.exports,_=function(){var t=this,e=t._self._c;return e("el-dialog",{attrs:{"el-dialog":"",visible:t.show,title:"add"===t.form.type?"新增类型":"编辑类型","append-to-body":"",width:"400px","destroy-on-close":""},on:{"update:visible":function(e){t.show=e},close:t.onClose}},[e("el-form",{ref:"formRef",attrs:{model:t.form,size:"small","label-width":"75px"}},[e("el-form-item",{attrs:{label:"名称:",prop:"name",rules:t.required}},[e("el-input",{attrs:{readonly:"edit"===t.form.type,placeholder:"请输入类型名称"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),e("el-form-item",{attrs:{label:"图标:",prop:"icon",rules:t.required}},[e("el-popover",{attrs:{placement:"bottom-start",width:"460",trigger:"click"},on:{show:function(e){return t.$refs["iconSelect"].reset()}}},[e("IconSelect",{ref:"iconSelect",on:{selected:e=>t.form.icon=e}}),e("el-input",{attrs:{slot:"reference",placeholder:"点击选择图标",readonly:""},slot:"reference",model:{value:t.form.icon,callback:function(e){t.$set(t.form,"icon",e)},expression:"form.icon"}},[t.form.icon?e("svg-icon",{staticClass:"el-input__icon",staticStyle:{height:"16px",width:"16px"},attrs:{slot:"prefix","icon-class":t.form.icon},slot:"prefix"}):e("i",{staticClass:"el-icon-search el-input__icon",attrs:{slot:"prefix"},slot:"prefix"})],1)],1)],1),e("el-form-item",{attrs:{label:"说明:",prop:"remark",rules:t.required}},[e("el-input",{attrs:{type:"textarea"},model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark",e)},expression:"form.remark"}})],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{size:"small"},on:{click:function(e){t.show=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.onSubmit("form")}}},[t._v("提交")])],1)],1)},x=[],w=i(74804);function k(t,e,i){return(e=S(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function S(t){var e=C(t,"string");return"symbol"==typeof e?e:e+""}function C(t,e){if("object"!=typeof t||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}class A{constructor(){k(this,"id",""),k(this,"name",""),k(this,"icon",""),k(this,"remark",""),k(this,"type","add")}}var $={components:{IconSelect:w.A},data(){return{form:new A,show:!1,required:{required:!0,message:"请填写必填选项",trigger:"change"},res:null,rej:null}},computed:{},methods:{openDialog(t){return this.$nextTick((()=>{this.$refs.form?.resetFields()})),this.form={...new A,...t||{}},this.show=!0,this.$nextTick((()=>{this.$refs.formRef.clearValidate()})),new Promise(((t,e)=>{this.res=t,this.rej=e}))},async onSubmit(){try{await this.$refs.formRef.validate().catch((()=>{throw"请输入必填项"}));const t=this.form;await r.A["add"===this.form.type?"post":"patch"]("/third/customized",t),this.show=!1,this.$message.success("保存成功"),this.res()}catch(t){this.$message.error(t)}},onClose(){this.rej?.()}}},z=$,D=(0,b.A)(z,_,x,!1,null,"729b0738",null),O=D.exports,B=function(){var t=this,e=t._self._c;return e("el-dialog",{attrs:{title:t.form.name,"close-on-click-modal":!1,visible:t.dialogShow,width:"1000px","close-on-press-escape":!1,"destroy-on-close":"","custom-class":"editFileDialog"},on:{"update:visible":function(e){t.dialogShow=e},closed:function(e){t.rej?.()}},scopedSlots:t._u([{key:"title",fn:function(){return[e("div",{staticStyle:{display:"flex","justify-content":"space-between",color:"#e5e5e5","margin-right":"21px"}},[e("span",[t._v(" "+t._s(t.form.name)+" ")]),e("a",{staticClass:"save",on:{click:t.onSubmit}},[t._v("保存")])])]},proxy:!0}])},[e("el-form",{ref:"formRef",attrs:{model:t.form,size:"small","label-width":"75px"}},[e("CodeEditor",{staticStyle:{width:"100%","min-height":"800px"},attrs:{mode:"js"===t.form.ext?"javascript":t.form.ext},model:{value:t.form.content,callback:function(e){t.$set(t.form,"content",e)},expression:"form.content"}})],1)],1)},U=[],j=i(85967);class T{constructor(t){this.content=t?.content||"",this.ext=t?.ext||"",this.name=t?.name||"",this.path=t?.path||"",this.desc=t?.desc||"",this.id=t?.id||"",this.customized=t?.customized||""}}var I={props:{},components:{CodeEditor:j.A},data(){return{form:new T,optType:"add",dialogShow:!1,res:null,rej:null,required:{required:!0,message:"请选择类别",trigger:"change"}}},methods:{async openDialog(t,e="add"){return this.optType=e,this.dialogShow=!0,this.form=new T(t||{}),"object"===typeof this.form.content&&(this.form.content=JSON.stringify(this.form.content)),new Promise(((t,e)=>{this.res=t,this.rej=e}))},async onSubmit(){try{await this.$refs.formRef.validate().catch((()=>{throw"请检查必填项"}));const t=new File([new Blob([this.form.content])],this.form.name),e=new FormData;e.append("file",t),e.append("name",this.form.name),e.append("path",this.form.path),e.append("desc",this.form.desc),e.append("id",this.form.id),e.append("customized",this.form.customized),await this.$request.fetchUploadThird(e),this.dialogShow=!1,this.res?.()}catch(t){this.message.error(t)}}}},F=I,P=(0,b.A)(F,B,U,!1,null,"574d6fd6",null),q=P.exports;function L(t){if(0===t)return"0 B";let e=1024,i=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],s=Math.floor(Math.log(t)/Math.log(e));return s>0?(t/Math.pow(e,s)).toPrecision(3)+" "+i[s]:t.toFixed(2)+" B"}var N={components:{tableList:n.A,ThirdForm:v,addNewType:O,editFileContent:q},data(){return{keyword:"",allOptions:[],subkeyword:"",codeEditShow:!0,page:0,pagination:{pageIndex:1,pageSize:30,total:0,pageSizes:[30,60,90],layout:"total, sizes, prev, pager, next"},active:0,subActive:0,columns:[{label:"名称",prop:"name"},{label:"修改时间",prop:"updated_at_f"},{label:"文件大小",prop:"size",formatter(t){return L(t.size)}}]}},computed:{activeOption(){return this.options[this.active]},subOptions(){return this.activeOption?.records?.map((t=>({...t,updated_at_f:l()(t.updated_at).format("YYYY-MM-DD HH:mm:ss")}))).filter((t=>!!t.updated_at_f.includes(this.subkeyword)||(!!t.name.includes(this.subkeyword)||!!t.desc.includes(this.subkeyword))))||[]},subActiveOption(){let t=this.subOptions.find((t=>t.id===this.subActive));return t},options(){return this.allOptions.filter((t=>""===t.name||(!!t.name.includes(this.keyword)||!!t.remark.includes(this.keyword))))},canEdit(){return console.log(this.subActiveOption.ext),/^\.(js|json|txt|lua|yaml|html)$/i.test(this.subActiveOption.extension||"")}},created(){this.loadData()},methods:{company:L,rowClick(t){this.subActive=t.id},rowClassName({row:t}){if(t.id===this.subActive)return"subActive"},async loadData(){try{const{data:t}=await r.A.get("/thirds");this.allOptions=t.map((t=>({...t,created_at_f:l()(t.created_at).format("YYYY-MM-DD HH:mm:ss"),updated_at_f:l()(t.updated_at).format("YYYY-MM-DD HH:mm:ss")})))||[]}catch(t){this.$message.error(t)}},clickCard(t){this.subActive=-1,this.active=t,this.page=1},delThird(t){this.$request.fetchDelThird(t).then((()=>{this.$message({message:"删除成功!!!",type:"success"}),this.loadData()}))},downThird(t){const e="/api/v1/third?id="+t+"&authorization="+localStorage.getItem("token");window.open(e,"_blank")},edit(t="edit"){this.$refs.thirdFormRef.openDialog(this.subActiveOption,t).then((()=>{this.loadData()}))},upNewFile(){this.$refs.thirdFormRef.openDialog({customized:this.activeOption.name}).then((()=>{this.loadData()}))},editCode(t){const e=this.$refs.codeForm;e.codeShow=!0,this.codeEditShow=!0,e.textLoading=!0,this.$request.fetchDownCode(t.id).then((i=>{e.textLoading=!1,e.dialogValue=i.data,e.form=t,e.form.id=t.id,e.titleCode=t.name}))},fetchType(t,e="add"){console.log(this),this.$refs.addNewTypeRef.openDialog({...t||{},type:e}).then((()=>{this.loadData()}))},async deleteType(t){try{await r.A.delete("third/customized",{params:{id:t}}),this.$message.success("删除成功"),this.loadData()}catch(e){this.$message.error(e)}},async editFile(){try{const{data:t}=await this.$request.fetchDownCode(this.subActiveOption.id),e={...this.subActiveOption,content:t,ext:this.subActiveOption?.extension?.slice(1)||""};this.$refs.editRef.openDialog(e).then((()=>{this.$message.success("保存成功"),this.loadData()}))}catch(t){this.$message.error(t)}}}},R=N,V=(0,b.A)(R,s,o,!1,null,"67132298",null),M=V.exports}}]);