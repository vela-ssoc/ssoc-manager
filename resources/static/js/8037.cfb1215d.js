"use strict";(self["webpackChunkssoc"]=self["webpackChunkssoc"]||[]).push([[751,8037],{56383:function(e,t,a){a.r(t),a.d(t,{default:function(){return A}});var s=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{width:"100%"}},[t("el-card",[t("el-row",[t("el-col",{attrs:{span:12}},[t("el-input",{staticClass:"input-with-select",staticStyle:{width:"20%"},attrs:{placeholder:"请输入名称",clearable:"",size:"mini"},on:{blur:e.getCode},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getCode.apply(null,arguments)}},model:{value:e.selectInput,callback:function(t){e.selectInput=t},expression:"selectInput"}}),t("el-button",{staticStyle:{color:"#909399",background:"#f4f4f5","border-color":"#d3d4d6"},attrs:{icon:"el-icon-search",size:"mini"},on:{click:e.getCode}})],1),t("el-col",{staticStyle:{"text-align":"right"},attrs:{span:12}},[t("el-button",{staticStyle:{"margin-left":"0"},attrs:{"el-button":"",type:"success",plain:"",size:"mini"},on:{click:e.addCode}},[e._v("添加")])],1)],1),null!==e.codeData?t("div",{staticClass:"ivu-list-split"},e._l(e.codeData,(function(a){return t("ul",{key:a.id,staticClass:"ivu-list-items"},[t("li",{staticClass:"ivu-list-item"},[t("div",{staticClass:"ivu-list-item-meta"},[t("div",{staticClass:"ivu-list-item-meta-avatar"},[t("span",{staticClass:"ivu-avatar ivu-avatar-square ivu-avatar-image ivu-avatar-large"},[t("svg-icon",{staticClass:"el-input__icon",staticStyle:{height:"42px",width:"32px"},attrs:{slot:"prefix","icon-class":e.iconImg(a.icon)},slot:"prefix"})],1)]),t("div",{staticClass:"ivu-list-item-meta-content"},[t("div",{staticClass:"ivu-list-item-meta-title"},[e._v(e._s(a.desc))]),t("div",{staticClass:"ivu-list-item-meta-description"},[e._v(" "+e._s(a.name)+" ")])])]),t("div",{staticClass:"list-basic-list-content"},[t("div",{staticClass:"list-basic-list-content-item",staticStyle:{width:"240px"}},[t("span",[e._v("开始时间")]),t("p",[e._v(e._s(e._f("date")(a.created_at,"yyyy-MM-dd hh:mm:ss")))])])]),t("ul",{staticClass:"ivu-list-item-action"},[t("li",[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.edit(a)}}},[e._v("编辑")])],1),t("li",[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.subDelete(a.id)}}},[e._v("删除")])],1)])])])})),0):e._e(),t("Page",{attrs:{size:e.size,current:e.current,pageSizeArray:e.pageSizeArray,pageTotal:e.pageTotal},on:{handleSizeChange:e.handleSizeChange,handleCurrentChange:e.handleCurrentChange}})],1),t("codeEdit",{ref:"codeEditRef",on:{handleEdit:e.getCode}}),t("AddForm",{ref:"formAdd"})],1)},i=[],o=a(60751),l=a(92161),n=function(){var e=this,t=e._self._c;return t("el-dialog",{staticClass:"code-form",attrs:{"show-close":!1,"close-on-press-escape":!1,"close-on-click-modal":!1,top:"50px","el-dialog":"",visible:e.dialogVisible,"append-to-body":"",width:"70%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{ref:"form",staticClass:"formAdd",attrs:{model:e.form,rules:e.rules,"label-width":"40px"}},[t("el-row",[t("el-col",{staticStyle:{margin:"20px 20px"},attrs:{span:5}},[t("el-form-item",{attrs:{label:" ",prop:"chunk"}},[t("el-upload",{ref:"file",staticClass:"upload-demo",attrs:{action:"/","on-remove":e.handleRemove,"before-remove":e.beforeRemove,"on-change":e.filseSuccess,multiple:"",limit:3,"on-exceed":e.handleExceed,"auto-upload":!1}},[t("el-button",{attrs:{size:"mini",type:"primary"}},[e._v("点击上传 chunk")])],1)],1),t("el-form-item",{attrs:{label:"名称",prop:"name"}},[t("el-input",{attrs:{type:"text",size:"mini"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),t("el-form-item",{attrs:{label:"图标",prop:"icon"}},[t("el-popover",{attrs:{placement:"bottom-start",width:"460",trigger:"click"},on:{show:function(t){return e.$refs["iconSelect"].reset()}}},[t("IconSelect",{ref:"iconSelect",on:{selected:e.selected}}),t("el-input",{attrs:{slot:"reference",placeholder:"点击选择图标",size:"mini",readonly:""},slot:"reference",model:{value:e.form.icon,callback:function(t){e.$set(e.form,"icon",t)},expression:"form.icon"}},[e.form.icon?t("svg-icon",{staticClass:"el-input__icon",staticStyle:{height:"42px",width:"16px"},attrs:{slot:"prefix","icon-class":e.form.icon},slot:"prefix"}):t("i",{staticClass:"el-icon-search el-input__icon",attrs:{slot:"prefix"},slot:"prefix"})],1)],1)],1),t("el-form-item",{attrs:{label:"描述",prop:"desc"}},[t("el-input",{attrs:{type:"textarea",placeholder:"请输入描述"},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1),t("span",{staticStyle:{width:"100%","text-align":"right",display:"inline-block"}},[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.onSubmit("form")}}},[e._v("提交")])],1)],1),t("div",{staticStyle:{height:"20px","text-align":"right",padding:"5px"}},[t("el-dropdown",{on:{command:e.handleCommand}},[t("span",{staticStyle:{color:"#fff"}},[e._v(" "+e._s(e.editCodeType))]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"vim"}},[e._v("vim")]),t("el-dropdown-item",{attrs:{command:"vscode"}},[e._v("vscode")]),t("el-dropdown-item",{attrs:{command:"sublime"}},[e._v("sublime")])],1)],1),t("i",{staticClass:"fa fa-close",staticStyle:{margin:"0 5px 0 10px",color:"#9e9e9e",cursor:"pointer"},on:{click:function(t){e.dialogVisible=!1}}})],1),t("div",{ref:"generateId",staticClass:"code-editor"})],1)],1),t("div",{attrs:{slot:"title"},slot:"title"})],1)},r=[],c=a(74804),d=a(80952),h=a.n(d),p=(a(94274),a(61670),a(16987),a(50086),a(15802)),u=a.n(p),m=a(45631),f=a.n(m),g=a(31570),v=a.n(g),y=a(9017),C=a.n(y),b=a(61742),k=a.n(b);h().config.setModuleUrl("ace/keyboard/vim",k()),h().config.setModuleUrl("ace/keyboard/sublime",C()),h().config.setModuleUrl("ace/keyboard/vscode",v()),h().config.setModuleUrl("ace/mode/lua_worker",u()),h().config.setModuleUrl("ace/mode/lua_worker",u()),h().config.setModuleUrl("ace/mode/css_worker",f());var w={name:"addForm",components:{IconSelect:c.A},props:{isAdd:Boolean},data(){return{codeIcon:"",codeName:"",linkArray:[],form:{name:"",icon:"通用",desc:"",links:[],chunk:"",id:""},dialogVisible:!1,linkData:[],dialogValue:"",rules:{},editor:"",editCodeType:"vscode"}},created(){let e=localStorage.getItem("cacheEditCodeType");e&&(this.editCodeType=e)},updated(){var e=this;e.editor=h().edit(this.$refs.generateId,{keyboardHandler:"ace/keyboard/"+this.editCodeType,enableSnippets:!0,enableLiveAutocompletion:!0,enableBasicAutocompletion:!0,mode:"ace/mode/lua",theme:"ace/theme/dracula",fontSize:12,tabSize:4,value:this.dialogValue,selectionStyle:"text'",showLineNumbers:!0,showGutter:!0,showPrintMargin:!0,printMarginColumn:170}),e.editor.getSession().on("change",(function(t){e.form.chunk=e.editor.getValue(this.dialogValue)}))},created(){},methods:{handleCommand(e){this.editCodeType=e,localStorage.setItem("cacheEditCodeType",e),this.editor.blur(),this.editor.setKeyboardHandler("ace/keyboard/"+e)},linkCompare(e){var t=this.linkArray.some((t=>{if(t.id===e.id)return!0}));return t},deleteLink(e){JSON.stringify(this.linkArray);var t=this.linkArray.indexOf(e);this.linkArray.splice(t,1)},pushLink(e){this.linkArray.push(e)},selected(e){this.form.icon=e,this.codeIcon=e},beforeRemove(e,t){return this.$confirm("确定移除 $ { file.name } ？")},filseSuccess(e,t){var a=this;if(e.raw){let t=new FileReader;t.onload=function(e){a.form.chunk=e.target.result},t.readAsText(e.raw)}},handleRemove(e,t){var a=this;a.form.chunk=""},handleExceed(e,t){this.$message.warning(`当前限制选择 3 个文件，本次选择了 ${e.length} 个文件，共选择了 ${e.length+t.length} 个文件`)},handleClose(){this.dialogVisible=!1,this.form={}},onSubmit(e){this.$refs[e].validate((e=>{if(e){let e=a(8127).Base64,s=e.encode(this.form.icon),i=e.encode(this.form.chunk);var t={name:this.form.name,icon:s,desc:this.form.desc,links:this.form.links,chunk:i,id:this.form.id};this.$request.fetchAddCode(t).then((e=>{this.$parent.getCode(),this.dialogVisible=!1,this.editor.setValue(""),this.form={name:"",icon:"kafka",desc:"",links:[],chunk:"",id:""},this.$refs.file.clearFiles(),this.$message({message:"新增成功",type:"success"})})).catch((e=>{this.$message.error(e.data)}))}}))}}},S=w,_=a(81656),x=(0,_.A)(S,n,r,!1,null,"87a151ec",null),D=x.exports,$=(a(12878),{name:"node",components:{codeEdit:o["default"],Page:l.A,AddForm:D},data(){return{current:1,size:10,pageTotal:0,pageSizeArray:["10","20","30","40"],codeData:[],isAdd:!0,delLoading:!1,selectInput:""}},created(){this.getCode()},methods:{iconImg:function(e){let t=a(8127).Base64;return t.decode(e)},edit(e){this.$refs.codeEditRef.openTaskDetail({dialect:!1,taskId:e.id})},format(e){return 100===e?"100%":`${e}%`},percentageChange(e,t){return 0===e?0:parseInt(e/t*1e4)/100},customColorMethod(e,t){var a=this.percentageChange(e,t);return a<30?"#67c23a":a<70?"#e6a23c":"#f56c6c"},handleSizeChange(e){this.size=e,this.getCode()},handleCurrentChange(e){this.current=e,this.getCode()},addCode(){this.$nextTick((()=>{const e=this.$refs.formAdd;e.dialogVisible=!0}))},async subDelete(e){try{await this.$confirm("是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch((()=>{throw"取消操作"})),this.delLoading=!0,await this.$request.fetchDeleteCode(e),this.$message({message:"删除成功!!!",type:"success"}),this.getCode()}catch(t){this.$message.error(t||"操作出错")}finally{this.delLoading=!1}},getCode(){var e={current:this.current,size:this.size,keyword:this.selectInput||""};this.$request.fetchGetCode(e).then((e=>{this.codeData=e.data.records,this.pageTotal=e.data.total})).catch((e=>{this.$message.error(e.data)}))},handleEdit(e,t){},handleDelete(e,t){this.$message({showClose:!0,message:e,row:t,type:"success"})},formatter(e,t){return e.address},filterTag(e,t){return t.tag===e},filterHandler(e,t,a){const s=a["property"];return t[s]===e}}}),z=$,T=(0,_.A)(z,s,i,!1,null,"6fbb875a",null),A=T.exports},60751:function(e,t,a){a.r(t),a.d(t,{default:function(){return u}});var s=function(){var e=this,t=e._self._c;return t("el-drawer",{staticClass:"systemSet",attrs:{visible:e.dialogVisible,"show-close":!1,direction:"rtl","custom-class":"taskEditDrawer","close-on-press-escape":!1,"append-to-body":!0,"close-on-click-modal":!1,"before-close":e.handleClose,withHeader:!1,size:"90%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[e.dialogVisible?t("div",[t("el-row",{attrs:{type:"flex"}},[t("el-col",{attrs:{span:e.showDesc?19:24}},[t("el-row",[e.codeShow?t("el-col",{attrs:{span:24}},[t("codeEditor",{style:`min-height: calc(100vh - ${e.showPane?200:8}px)`,attrs:{theme:"dark"},scopedSlots:e._u([{key:"icon",fn:function(){return[t("div")]},proxy:!0},{key:"extra",fn:function(){return[t("div",[t("span",{staticStyle:{"margin-left":"14px",cursor:"pointer"},on:{click:e.refreshCode}},[t("i",{staticClass:"fa fa-refresh",attrs:{title:"刷新"}}),t("span",{staticStyle:{"margin-left":"3px"}},[e._v("刷新")])]),t("el-popconfirm",{attrs:{title:"确定继续？"},on:{confirm:e.onSubmit}},[t("span",{staticStyle:{"margin-left":"6px",cursor:"pointer"},attrs:{slot:"reference"},slot:"reference"},[t("i",{staticClass:"fa fa-cloud-upload",staticStyle:{"margin-left":"10px",cursor:"pointer"},attrs:{title:"提交"}}),t("span",{staticStyle:{"margin-left":"0px"}},[e._v(" 提交 ")])])]),t("span",{staticStyle:{"margin-left":"12px",cursor:"pointer"},on:{click:e.reloadService}},[t("i",{staticClass:"fa fa-undo",staticStyle:{cursor:"pointer"},attrs:{title:"重启"}}),t("span",[e._v(" 重启 ")])]),t("span",{staticStyle:{"margin-left":"12px",cursor:"pointer"},on:{click:function(t){e.dialogVisible=!1}}},[t("i",{staticClass:"fa fa-close",attrs:{title:"关闭"}}),t("span",[e._v(" 关闭 ")])]),e.showDesc?e._e():t("span",{staticStyle:{"margin-left":"12px",cursor:"pointer"},on:{click:function(t){e.showDesc=!0}}},[t("i",{staticClass:"el-icon-arrow-left",staticStyle:{cursor:"pointer","font-size":"18px"},attrs:{title:"任务"}})])],1)]},proxy:!0}],null,!1,2379433083),model:{value:e.dialogValue,callback:function(t){e.dialogValue=t},expression:"dialogValue"}}),e.showPane?e._e():t("span",{staticStyle:{cursor:"pointer",position:"absolute",right:"10px","z-index":"10",color:"aliceblue",bottom:"10px"},on:{click:function(t){e.showPane=!0}}},[t("i",{staticClass:"el-icon-arrow-up",staticStyle:{cursor:"pointer","font-size":"20px"},attrs:{title:"日志"}})])],1):e._e()],1),e.showPane?t("el-row",{staticStyle:{"margin-top":"10px"}},[t("el-col",{attrs:{span:24}},[t("EventTask",{attrs:{dataTask:e.dataTask}}),t("div",{staticClass:"tool"},[e.codeShow?t("i",{staticClass:"el-icon-arrow-up",attrs:{title:"最大化显示"},on:{click:function(t){e.codeShow=!1}}}):t("i",{staticClass:"el-icon-arrow-down",attrs:{title:"常规显示"},on:{click:function(t){e.codeShow=!0}}}),t("span",{staticStyle:{"margin-left":"3px"},attrs:{title:"关闭面板"},on:{click:function(t){e.showPane=!1,e.codeShow=!0}}},[t("i",{staticClass:"el-icon-close"})])])],1)],1):e._e()],1),e.showDesc?t("el-col",{staticStyle:{"padding-left":"5px","padding-right":"0px"},attrs:{span:5}},[t("el-card",{staticClass:"card",staticStyle:{height:"100%"}},[t("el-row",[t("el-col",{staticStyle:{"margin-bottom":"10px",display:"flex","justify-content":"space-between","align-items":"center"}},[t("div",{staticClass:"flex items-center"},[t("el-popover",{attrs:{placement:"bottom-start",width:"460",trigger:"click"},on:{show:function(t){return e.$refs["iconSelect"].reset()}}},[t("IconSelect",{ref:"iconSelect",on:{selected:e.iconSelected}}),t("template",{slot:"reference"},[t("span",{},[e.serverData.icon?t("svg-icon",{staticClass:"iconfont",staticStyle:{"font-size":"23px"},attrs:{"icon-class":e.serverData.icon&&e.Base64.decode(e.serverData.icon)||""}}):t("i",{staticClass:"el-icon-paperclip",staticStyle:{"font-size":"23px",color:"white",transform:"translateY(3px)"}})],1)])],2),t("span",{staticClass:"ml-2"},[e.serverData?.dialect?t("el-tag",{attrs:{size:"mini",effect:"dark",type:"warning"}},[e._v("私有模块")]):t("el-tag",{attrs:{size:"mini",effect:"dark",type:"danger"}},[e._v("公有模块")])],1)],1),t("i",{staticClass:"el-icon-arrow-right",staticStyle:{"font-size":"20px",cursor:"pointer"},on:{click:function(t){e.showDesc=!1}}})]),t("el-col",{staticStyle:{"margin-bottom":"8px"}},[t("span",{staticClass:"label"},[e._v(" 任务名称：")]),e._v(" "+e._s(e.serverData.name)+" ")]),t("el-col",{staticStyle:{"margin-bottom":"8px"}},[t("span",{staticClass:"label"},[e._v("外链详情：")]),e._v(e._s(e.nullChange(e.serverData.link))+" ")]),t("el-col",{staticStyle:{"margin-bottom":"8px"}},[t("span",{staticClass:"label"},[e._v("本地哈希：")]),e._v(" "+e._s(e.serverData.legal_hash)+" ")]),t("el-col",{staticStyle:{"margin-bottom":"8px"}},[t("span",{staticClass:"label"},[e._v(" 上报哈希： ")]),e._v(" "+e._s(e.serverData.actual_hash)+" ")]),t("el-col",{staticStyle:{"margin-bottom":"8px"}},[t("span",{staticClass:"label"},[e._v(" 报错信息： ")]),e._v(" "+e._s(e.nullChange(e.serverData.cause))+" ")]),t("el-col",{staticStyle:{"margin-bottom":"20px"}},[t("span",{staticClass:"label"},[e._v(" 描述信息： ")]),e._v(" "+e._s(e.nullChange(e.serverData.desc))+" ")])],1),t("el-row",[t("el-col",{staticStyle:{"margin-bottom":"10px"}},[t("h3",[e._v("服务进程")]),e.serverData.runners&&e.serverData.runners.length?e._e():t("div",{staticClass:"label"},[e._v(" -- ")])]),e._l(e.serverData.runners,(function(a,s){return t("div",{key:s},[t("el-col",{staticStyle:{"margin-bottom":"5px"}},[t("span",{attrs:{type:"info",size:"mini"}},[t("span",{staticClass:"label"},[e._v(" 名称： ")]),e._v(" "+e._s(a.name))])]),t("el-col",{staticStyle:{"margin-bottom":"5px"}},[t("span",{attrs:{type:"info",size:"mini"}},[t("span",{staticClass:"label"},[e._v("类型：")]),""!==a.type?t("span",[e._v(e._s(a.type))]):e._e()])]),t("el-col",{staticStyle:{"margin-bottom":"15px"}},[t("span",{attrs:{type:"info",size:"mini"}},[t("span",{staticClass:"label"},[e._v(" 状态： ")]),e._v(e._s(a.status))])])],1)}))],2)],1)],1):e._e()],1)],1):e._e()])},i=[],o=a(74804),l=a(95814);let n=a(8127).Base64;const r="CODEEDIT";var c={name:"codeEdit",components:{IconSelect:o.A,codeEditor:l.A,EventTask:()=>a.e(2668).then(a.bind(a,22668))},props:{},data(){return{Base64:n,serverData:{},dialogVisible:!1,dialogValue:"",dataTask:{},codeShow:!0,showPane:!0,showDesc:!0,minionId:"",initData:null}},created(){this.initConfig()},watch:{showDesc(){this.saveConifg()},codeShow(){this.saveConifg()},showPane(){this.saveConifg()}},methods:{reloadService(){var e={id:this.dataTask.minion_id,substance_id:this.serverData.id,dialect:this.serverData.dialect};this.$request.fetchPatchReload(e).then((e=>{this.$message.success("重启成功！！"),this.loadData(this.initData)})).catch((e=>{this.$message.error(e.data)}))},dateTime(e){var t=a(95093);return t(e).format("YYYY-MM-DD HH:mm:ss")},refreshCode(){this.loadData(this.initData)},editCode(){this.codeShow=!this.codeShow},nullChange(e){return""!==e&&" "!==e?e:"无"},handleClose(){},async iconSelected(e){try{this.serverData.icon=n.encode(e),await this.savaTask({id:this.serverData.id,icon:this.serverData.icon,chunk:this.serverData.chunk,version:this.serverData.version}),this.$emit("handleEdit",this.dataTask),this.$message.success("切换icon成功"),this.loadData(this.initData)}catch(t){this.$message.error(t||"操作出错")}},async savaTask(e){let t;return t=this.initData.dialect?()=>this.$request.fetchUpdateDialect(e):()=>this.$request.fetchUpdataCode(e),t()},async onSubmit(){try{let t=n.encode(this.dialogValue);var e={id:this.serverData.id,icon:this.serverData.icon,chunk:t,version:this.serverData.version};await this.savaTask(e),this.$message({message:"编辑成功",type:"success"}),this.$emit("handleEdit",this.dataTask),this.loadData(this.initData)}catch(t){this.$message.error(t)}},async loadData({dialect:e,minionId:t,taskId:a=null}){try{let e;e=t?()=>this.$request.fetchdetailDialect(t,a):()=>this.$request.fetchUpdataCodeEdit(a),this.minionId=t;const{data:s}=await e()||{};this.dataTask={minion_id:t,name:s.name,id:s.id},this.dialogValue=n.decode(s.chunk||" "),this.serverData=s||{}}catch(s){this.$message.error(s||"查询出错")}},async openTaskDetail(e){try{this.initData=e,await this.loadData(e),this.dialogVisible=!0}catch(t){this.$message.error(t||"查询出错")}},initConfig(){const e=localStorage.getItem(r);if(e)try{const t=JSON.parse(e);this.showDesc=t.showDesc,this.showPane=t.showPane,this.codeShow=t.codeShow}catch(t){}},saveConifg(){localStorage.setItem(r,JSON.stringify({showDesc:this.showDesc,showPane:this.showPane,codeShow:this.codeShow}))}}},d=c,h=a(81656),p=(0,h.A)(d,s,i,!1,null,"0e715314",null),u=p.exports}}]);