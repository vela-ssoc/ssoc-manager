"use strict";(self["webpackChunkssoc"]=self["webpackChunkssoc"]||[]).push([[6105],{32268:function(e,t,a){a.d(t,{A:function(){return v}});var i=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{width:"100%"}},[t("div",{staticClass:"tableHead"},[t("div",{staticStyle:{flex:"1","margin-right":"5px"}},[e._t("right_top_btn")],2),t("span",{staticClass:"icon"},[e.refreshAble?t("i",{staticClass:"el-icon-refresh",attrs:{title:"重加载数据"},on:{click:e.loadData}}):e._e(),e.configAble&&"inhead"!==e.configIconPos?t("i",{class:{"el-icon-setting":!0},attrs:{title:"编辑表格"},on:{click:function(t){e.dialogVisible=!0}}}):e._e()])]),t("div",{staticStyle:{position:"relative"}},[e.configAble&&"inhead"===e.configIconPos?t("i",{staticClass:"el-icon-setting iconInHead",attrs:{title:"编辑表格"},on:{click:function(t){e.dialogVisible=!0}}}):e._e()]),t("el-table",e._g(e._b({ref:"table",staticStyle:{width:"100%"},attrs:{"header-cell-style":e.$attrs["header-cell-style"]||{color:"#909399",textAlign:"center",background:"#f5f7fa"},data:e.showData,stripe:e.stripe},on:{"selection-change":e.selectionChange}},"el-table",e.$attrs,!1),e.$listeners),[e.selection?t("el-table-column",{attrs:{selectable:e.selectable,type:"selection"}}):e._e(),e.index?t("el-table-column",{attrs:{type:"index",label:"序号",align:"center",fixed:"left"}}):e._e(),e._l(e.showColumn,(function(a,i){return[t("el-table-column",{key:i,attrs:{prop:a&&a.prop,label:a&&a.label,width:a&&a.width,"min-width":a&&a["min-width"],fixed:a&&a.fixed,formatter:a&&a.formatter,"show-overflow-tooltip":a&&a["show-overflow-tooltip"]||!1,sortable:a&&a.sortable,"sort-method":a&&a["sort-method"],"sort-by":a&&a["sort-by"],align:a&&a.align||"center","sort-orders":a&&a["sort-orders"],type:a&&a.type,"class-name":a&&a["class-name"]},scopedSlots:e._u([a&&a.slotHeader?{key:"header",fn:function(t){return[e._t(a&&a.slotHeader,null,{row:t.row,col:a,$index:t.$index})]}}:null,a&&a.slot?{key:"default",fn:function(t){return[e._t(a&&a.slot,null,{row:t.row,col:a,$index:t.$index})]}}:null],null,!0)})]}))],2),e.needPagination?t("div",{style:e.paginationStyle},[t("el-pagination",{attrs:{"current-page":e.pagination.pageIndex,"page-sizes":e.pagination.pageSizes||[15,30,50],"page-size":e.pagination.pageSize,layout:e.pagination.layout||"jumper, sizes, prev, pager, next,total",total:e.pagination.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){return e.$set(e.pagination,"pageIndex",t)},"update:current-page":function(t){return e.$set(e.pagination,"pageIndex",t)},"update:pageSize":function(t){return e.$set(e.pagination,"pageSize",t)},"update:page-size":function(t){return e.$set(e.pagination,"pageSize",t)}}})],1):e._e(),t("ColumnConfig",{attrs:{columns:e.filterColumns,visible:e.dialogVisible,selectColumn:e.selectedColumn},on:{"update:visible":function(t){e.dialogVisible=t},"update:selectColumn":function(t){e.selectedColumn=t},"update:select-column":function(t){e.selectedColumn=t}}})],1)},l=[],n=function(){var e=this,t=e._self._c;return t("div",[t("el-dialog",{attrs:{title:"设置需展示的列",visible:e.dialogVisible,width:"800px","append-to-body":""},on:{open:function(t){return e.opened()},"update:visible":function(t){e.dialogVisible=t}}},[t("div",[t("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选")]),t("el-button",{staticStyle:{"text-decoration":"underline",color:"red"},attrs:{type:"text"},on:{click:function(t){return e.$refs.SortColumn.open()}}},[e._v("手动排序")]),t("el-button",{staticStyle:{"text-decoration":"underline",color:"red"},attrs:{type:"text"},on:{click:e.reset}},[e._v("重置配置")]),t("div",{staticStyle:{margin:"15px 0"}}),t("el-checkbox-group",{on:{change:e.handleCheckedCitiesChange},model:{value:e.checkboxSelectBuff,callback:function(t){e.checkboxSelectBuff=t},expression:"checkboxSelectBuff"}},e._l(e.__column,(function(a){return t("el-col",{key:a.columnUUkey,staticClass:"colCheckbox",attrs:{span:8}},[t("el-checkbox",{attrs:{title:a.label,label:a.columnUUkey}},[e._v(e._s(a.label)+" ")])],1)})),1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.confirm}},[e._v("确 定")])],1)]),t("SortColumn",{ref:"SortColumn",attrs:{column:e.__column},on:{close:e.clsoeSort}})],1)},o=[],s=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:"拖动节点进行排序",visible:e.dialogVisible,width:"500px","append-to-body":""},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-tree",{attrs:{data:e.data,"node-key":"columnUUkey","default-expand-all":"",draggable:"","allow-drop":e.allowDrog}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.close}},[e._v("确 定")])],1)],1)},r=[],c={props:{column:{type:Array,require:!0}},data(){return{data:[],dialogVisible:!1}},created(){},methods:{open(){this.dialogVisible=!0,this.data=this.column.map((e=>({columnUUkey:e.columnUUkey,label:e.label})))},close(){this.dialogVisible=!1,this.$emit("close",this.data.map((e=>e.columnUUkey)))},allowDrog(e,t,a){return"inner"!==a}}},u=c,d=a(81656),h=(0,d.A)(u,s,r,!1,null,null,null),p=h.exports,f={props:{columns:{type:Array,default:()=>[]},visible:{type:Boolean,require:!0,default:!1},selectColumn:{type:Array,default:()=>[]}},components:{SortColumn:p},computed:{dialogVisible:{get(){return this.visible},set(e){this.$emit("update:visible",e)}},checkboxSelect:{get(){return this.selectColumn},set(e){this.$emit("update:selectColumn",e)}},__column(){return this.columns.map((e=>({label:e.label,columnUUkey:e.prop||e.slot}))).sort(((e,t)=>(this.__sortWeight[e.columnUUkey]||0)-(this.__sortWeight[t.columnUUkey]||0)))},__sortWeight(){const e={};for(let t=0;t<this.sortColumnList.length;t++)e[this.sortColumnList[t]]=t;return e}},data(){return{sortColumnList:[],checkAll:!1,isIndeterminate:!1,checkboxSelectBuff:[],oldColumns:[]}},methods:{handleCheckAllChange(e){this.checkboxSelectBuff=e?this.__column.map((e=>e.columnUUkey)):[],this.isIndeterminate=!1},handleCheckedCitiesChange(e){this.checkboxSelectBuff=e;let t=e.length;this.checkAll=t===this.__column.length,this.isIndeterminate=t>0&&t<this.__column.length},opened(){const e=this.__column.filter((e=>!this.oldColumns.includes(e.columnUUkey))).map((e=>e.columnUUkey));this.checkboxSelectBuff=this.checkboxSelectBuff.concat(e).sort(((e,t)=>(this.__sortWeight[e]||0)-(this.__sortWeight[t]||0))),this.oldColumns=this.__column.map((e=>e.columnUUkey)),this.checkAll=this.checkboxSelectBuff.length===this.__column.length,this.isIndeterminate=this.checkboxSelectBuff.length>0&&this.checkboxSelectBuff.length<this.__column.length},clsoeSort(e){this.sortColumnList=this.oldColumns=e||[],this.checkboxSelectBuff=this.checkboxSelectBuff.sort(((e,t)=>(this.__sortWeight[e]||0)-(this.__sortWeight[t]||0)))},reset(){this.sortColumnList=[],this.checkboxSelectBuff=this.__column.map((e=>e.columnUUkey))},confirm(){this.checkboxSelect=this.checkboxSelectBuff,this.sortColumnList=this.oldColumns,this.dialogVisible=!1}}},m=f,g=(0,d.A)(m,n,o,!1,null,"25f6eb76",null),b=g.exports,k={name:"table_list",components:{ColumnConfig:b},props:{data:{type:Array,required:!0,default:()=>[]},pagination:{type:Object,default:()=>({pageIndex:1,pageSize:15,total:0,pageSizes:[15,30,50],layout:"jumper, sizes, prev, pager, next,total"})},localPaginate:{type:Boolean,default:!1},needPagination:{type:Boolean,default:!0},columns:{required:!0,type:Array,default:()=>[]},index:{type:Boolean,default:!1},selection:{type:Boolean,default:!1},selectable:{type:Function,default:()=>()=>{}},selectCountLimit:{type:Number,default:1e6},checkedData:{type:Array,default:()=>[]},configAble:{type:[Boolean],default:!0},configIconPos:{default:"",type:String},refreshAble:{type:Boolean,default:!1},stripe:{type:Boolean,default:!1}},computed:{paginationStyle(){return{display:"flex","padding-top":"10px","flex-direction":"row","justify-content":"left"===this.pagination.align?"flex-start":"flex-end"}},filterColumns(){return this.columns.filter((e=>e.hidden&&"function"===typeof e.hidden?!e.hidden():!e.hidden))},showColumn(){let e=this.filterColumns;return this.selectedColumn.length&&(e=this.selectedColumn.map((e=>this.filterColumns.find((t=>t.prop===e||t.slot===e)))).filter((e=>!!e))),e.map((e=>({...e,columnUUkey:e.prop||e.slot})))},showData(){if(!this.data||!this.data.length)return[];if(!this.needPagination)return this.data;const e=Math.max(this.pagination.pageSize*(this.pagination.pageIndex-1),0),t=Math.min(this.data.length,e+this.pagination.pageSize);return this.data.length===this.pagination.total?this.data.slice(e,t):this.data},_checkedData:{get(){return this.checkedData},set(e){this.$emit("update:checkedData",e)}}},data(){return{selectedColumn:[],dialogVisible:!1}},watch:{data:{handler(e,t){this.resetSelect(),this.localPaginate&&(this.pagination.total=this.data&&this.data.length||0)},immediate:!0},filterColumns(){this.selectedColumn=[]}},mounted(){this.resetSelect()},methods:{loadData(){this.$emit("loadData")},reload(){this.pagination.pageIndex=1,this._checkedData=[],this.$emit("loadData")},selectionChange(e,t){if(e&&e.length>this.selectCountLimit){this.$refs.table.clearSelection();for(let t=0;t<this.selectCountLimit;t++)this.$refs.table.toggleRowSelection(e[e.length-t-1],!0)}else this._checkedData=e},resetSelect(){if(this.$refs.table){this.$refs.table.clearSelection();for(let e of this.data)for(let t of this._checkedData)JSON.stringify(e)===JSON.stringify(t)&&this.$refs.table.toggleRowSelection(e,!0)}},handleSizeChange(){this.localPaginate||(this.pagination.pageIndex=1,this.loadData())},handleCurrentChange(){!this.localPaginate&&this.loadData()}}},y=k,_=(0,d.A)(y,i,l,!1,null,"6202e7cb",null),v=_.exports},26105:function(e,t,a){a.r(t),a.d(t,{default:function(){return Y}});var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"min-h-full grid grid-cols-[220px,1fr] gap-2"},[t("leftTree",{on:{clickNode:e.nodeClick}}),t("el-card",{staticClass:"contentCard_",attrs:{shadow:"none"}},[t("tableList",{attrs:{columns:e.columns,data:e.tableData,pagination:e.pagination,configAble:!1},on:{loadData:e.loadData},scopedSlots:e._u([{key:"right_top_btn",fn:function(){return[t("div",{staticClass:"flex justify-between"},[t("div",{staticClass:"w-3/6"},[t("el-input",{staticStyle:{width:"300px",margin:"0 5px 0 -2px"},attrs:{size:"mini",placeholder:"输入关键字过滤key",clearable:""},on:{blur:e.keywordSearch},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.keywordSearch.apply(null,arguments)}},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}}),t("el-button",{staticClass:"buttonsearch",attrs:{size:"mini"},on:{click:e.searchBasic}},[t("div",{staticStyle:{margin:"0 5px"}},[t("i",{staticClass:"el-icon-search"})])]),e.bucket?t("span",{staticStyle:{margin:"2px","font-size":"12px",color:"#fff",padding:"3px","border-radius":"3px","background-color":"#409eff",display:"inline-block"}},[e._v(" bucket 等于 "+e._s(e.bucket)+" "),t("i",{staticClass:"el-icon-close",staticStyle:{cursor:"pointer"},on:{click:function(t){t.stopPropagation(),e.bucket=""}}})]):e._e()],1),t("el-popconfirm",{attrs:{title:`确定清理${e.bucket?e.bucket+"下的":""}过期数据吗？`},on:{confirm:function(t){return e.clearData({bucket:e.bucket})}}},[t("el-button",{attrs:{slot:"reference",size:"mini",type:"danger"},slot:"reference"},[e._v("清理过期数据")])],1)],1)]},proxy:!0},{key:"opt",fn:function({row:a}){return[t("el-button",{staticClass:"cursor-pointer",attrs:{type:"text"},on:{click:function(t){return e.$refs.detailRef.openDialog(a)}}},[e._v("详情")]),t("el-divider",{attrs:{direction:"vertical"}}),t("el-button",{staticClass:"cursor-pointer",attrs:{type:"text"},on:{click:function(t){return e.editKV(a)}}},[e._v("编辑")]),t("el-divider",{attrs:{direction:"vertical"}}),t("el-button",{staticClass:"cursor-pointer",attrs:{type:"text"},on:{click:function(t){return e.audit(a)}}},[e._v("审计")]),t("el-divider",{attrs:{direction:"vertical"}}),t("el-popconfirm",{attrs:{title:"确定清理过期数据吗？"},on:{confirm:function(t){return e.clearData(a)}}},[t("el-button",{staticClass:"cursor-pointer",staticStyle:{color:"red"},attrs:{slot:"reference",type:"text"},slot:"reference"},[e._v("清理")])],1)]}}])}),t("auditsDrawer",{ref:"auditsDrawerRef"}),t("editKV",{ref:"editKVRef"}),t("detail",{ref:"detailRef"})],1)],1)},l=[],n=a(72505),o=a.n(n),s=a(32268),r=a(22562),c=function(){var e=this,t=e._self._c;return t("el-card",{staticClass:"w-full",attrs:{shadow:"none"}},[t("el-input",{staticClass:"mb-1",attrs:{size:"mini",placeholder:"过滤bucket"},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}}),t("el-tree",{ref:"tree",attrs:{data:e.treeData,"highlight-current":"","filter-node-method":e.filterNode,"icon-class":"el-icon-menu translate-y-[2px]"},on:{"node-click":e.handleNodeClick}})],1)},u=[],d={data(){return{treeData:[],keyword:""}},watch:{keyword(e){this.$refs.tree.filter(e)}},created(){this.queryBucket()},methods:{async queryBucket(){try{const{data:e}=await o().get("shared/strings/buckets");this.treeData=e?.map((e=>({label:e,id:e})))||[]}catch(e){}},handleNodeClick(e){this.$emit("clickNode",e.id)},filterNode(e,t){return!e||new RegExp(e,"i").test(t.label)}}},h=d,p=a(81656),f=(0,p.A)(h,c,u,!1,null,"7df7314a",null),m=f.exports,g=function(){var e=this,t=e._self._c;return t("el-drawer",{attrs:{visible:e.open,title:"审计",direction:"rtl"},on:{"update:visible":function(t){e.open=t}}},[t("div",{staticClass:"p-2"},[t("tableList",{attrs:{columns:e.columns,data:e.tableData,pagination:e.pagination,configAble:!1},on:{loadData:e.loadData}})],1)])},b=[],k=a(95093),y=a.n(k),_={components:{tableList:s.A},data(){return{open:!1,tableData:[],bucket:"",key:"",pagination:{pageIndex:1,pageSize:15,total:0,pageSizes:[15,30,50],layout:"total, sizes, prev, pager, next"},columns:[{label:"inet",prop:"inet"},{label:"时间",prop:"time",formatter(e){return y()(e.updated_at).format("YYYY-MM-DD HH:mm:ss")}}]}},methods:{loadData(){var e={current:this.pagination.pageIndex,size:this.pagination.pageSize,bucket:this.bucket,key:this.key};o().get("shared/strings/audits",{params:e}).then((e=>{this.tableData=e.data.records,this.pagination.total=e.data.total})).catch((e=>{this.$message.error(e.data||"请求出错")}))},openDialog({bucket:e,key:t}){this.bucket=e,this.key=t,this.open=!0,this.loadData()}}},v=_,x=(0,p.A)(v,g,b,!1,null,"6567a580",null),C=x.exports,w=function(){var e=this,t=e._self._c;return t("el-drawer",{attrs:{visible:e.open,title:"编辑",direction:"rtl",size:"50%"},on:{"update:visible":function(t){e.open=t},closed:function(t){e.rej?.()}}},[t("div",{staticClass:"p-4"},[t("el-form",{attrs:{modal:e.form,"label-width":"60px",size:"small"}},[t("el-form-item",{attrs:{label:"bucket"}},[t("el-input",{attrs:{disabled:"",readonly:""},model:{value:e.form.bucket,callback:function(t){e.$set(e.form,"bucket",t)},expression:"form.bucket"}})],1),t("el-form-item",{attrs:{label:"key"}},[t("el-input",{attrs:{disabled:"",readonly:""},model:{value:e.form.key,callback:function(t){e.$set(e.form,"key",t)},expression:"form.key"}})],1),t("el-form-item",[t("el-checkbox",{model:{value:e.origin,callback:function(t){e.origin=t},expression:"origin"}},[e._v(" 展示原始数据 ")])],1),t("el-form-item",{attrs:{label:"值"}},[e.origin?[e._v(" "+e._s(e.form.value)+" ")]:t("el-input",{attrs:{type:"textarea"},model:{value:e.form.newValue,callback:function(t){e.$set(e.form,"newValue",t)},expression:"form.newValue"}})],2),t("el-form-item",[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.confirm}},[e._v("保存")])],1)],1)],1)])},S=[],D=a(98362),$=a(2543);function z(e){const t=e/10**9,a=Math.floor(t/3600),i=Math.floor(t%3600/60),l=t%60,n=`${a}小时${i}分${l}秒`;return n}var A={data(){return{res:null,rej:null,open:!1,origin:!1,form:{bucket:null,key:null,value:null,newValue:null}}},methods:{async confirm(){try{const e={...this.form};(0,$.isString)(e.value)?e.value=e.newValue:(0,$.isObjectLike)(e.value)&&"data"in e.value?e.value.data=e.newValue:e.value=e.newValue,delete e.newValue,await D.A.post("shared/strings/update",e),this.$message.success("更新成功"),this.res(),this.open=!1}catch(e){this.$message.error(e)}},openDialog({bucket:e,key:t,value:a}){return this.form.bucket=e,this.origin=!1,this.form.key=t,this.form.value=a,(0,$.isString)(a)?this.form.newValue=a:this.form.newValue=a?.data?a?.data:JSON.stringify(a),this.open=!0,new Promise(((e,t)=>{this.res=e,this.rej=t}))}}},U=A,V=(0,p.A)(U,w,S,!1,null,"521f21bf",null),B=V.exports,I=function(){var e=this,t=e._self._c;return t("el-drawer",{attrs:{visible:e.open,title:"详情",direction:"rtl",size:"50%"},on:{"update:visible":function(t){e.open=t}}},[t("div",{},[t("el-descriptions",{attrs:{column:1,border:""}},[t("el-descriptions-item",{attrs:{label:"bucket"}},[e._v(e._s(e.form?.bucket))]),t("el-descriptions-item",{attrs:{label:"key"}},[e._v(e._s(e.form?.key))]),t("el-descriptions-item",{attrs:{label:"count"}},[e._v(e._s(e.form?.count))]),t("el-descriptions-item",{attrs:{label:"value"}},[e._v(e._s(e.form?.value))]),t("el-descriptions-item",{attrs:{label:"lifetime"}},[e._v(e._s(e.formatNanonsecondsToTime(e.form.lifetime)))]),t("el-descriptions-item",{attrs:{label:"有效期"}},[e._v(e._s(e.moment(e.form.expired_at).format("YYYY-MM-DD HH:mm:ss")))])],1)],1)])},L=[],N={data(){return{open:!1,form:{}}},methods:{moment:y(),formatNanonsecondsToTime:z,openDialog(e){this.form=e,this.open=!0,this.$forceUpdate()}}},P=N,j=(0,p.A)(P,I,L,!1,null,"25130687",null),R=j.exports,H={name:"clientList",components:{tableList:s.A,leftTree:m,auditsDrawer:C,editKV:B,detail:R},data(){return{tableData:[],condData:{},filters:[],bucket:"",pagination:{pageIndex:1,pageSize:15,total:0,pageSizes:[15,30,50],layout:"total, sizes, prev, pager, next"},keyword:null,columns:[{label:"key",prop:"key"},{label:"value",prop:"value",formatter(e){return JSON.stringify(e.value)}},{label:"操作",width:200,align:"center",slot:"opt"}]}},created(){this.loadData(),this.getCond()},methods:{keywordSearch(){this.current=1,this.loadData()},nodeClick(e){this.bucket=e,this.pagination.pageIndex=1,this.loadData()},loadData(){var e={current:this.pagination.pageIndex,size:this.pagination.pageSize,filters:[],keyword:this.keyword||null};this.bucket&&e.filters.push({key:"bucket",operator:"eq",value:this.bucket}),this.keyword&&e.filters.push({key:"key",operator:"like",value:this.keyword}),o().get("/shared/strings/keys?"+r["default"].parses(e)).then((e=>{this.tableData=e.data.records,this.pagination.total=e.data.total})).catch((e=>{this.$message.error(e.data||"请求出错")}))},getCond(){o().get("/shared/strings/cond").then((e=>{this.condData=e.data}))},searchBasic(){this.current=1,this.loadData()},async clearData(e){try{await o()["delete"]("/shared/strings/sweep",{params:{bucket:e?.bucket,key:e?.key}}),this.$message.success("清除成功"),this.loadData()}catch(t){this.$message.error(t)}},audit(e){this.$refs.auditsDrawerRef.openDialog({bucket:e.bucket,key:e.key})},editKV(e){this.$refs.editKVRef.openDialog({bucket:e.bucket,key:e.key,value:e.value}).then((e=>this.loadData()))}}},M=H,O=(0,p.A)(M,i,l,!1,null,"7aa3bf87",null),Y=O.exports}}]);