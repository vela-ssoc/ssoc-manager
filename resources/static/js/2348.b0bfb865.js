"use strict";(self["webpackChunkssoc"]=self["webpackChunkssoc"]||[]).push([[2348],{12037:function(e,t,a){a.d(t,{Z:function(){return c}});var r=function(){var e=this,t=e._self._c;return t("div",{class:"事件详情"===e.nameShow?"pageClass":"",staticStyle:{height:"20px","padding-top":"10px"}},[t("span",{staticStyle:{display:"inline-block","font-size":"13px","min-width":"35.5px",height:"28px","line-height":"30px","vertical-align":"top","box-sizing":"border-box",float:"right"}},[e._v("共"+e._s(e.pageTotal)+"条")]),t("el-pagination",{staticStyle:{float:"right"},attrs:{background:"",layout:"jumper,sizes,prev, pager, next","page-size":e.size||15,"current-page":e.pageCurrent,total:e.pageTotal,"page-sizes":e.pageSizeArray||[15,30,45]},on:{"update:currentPage":function(t){e.pageCurrent=t},"update:current-page":function(t){e.pageCurrent=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)},s=[],i={name:"page",props:{pageSizeArray:Array,size:Number,pageTotal:Number,current:Number,nameShow:String},data(){return{pageCurrent:this.current}},methods:{handleSizeChange(e){this.$emit("handleSizeChange",e)},handleCurrentChange(e){this.$emit("handleCurrentChange",e)}},watch:{current:function(e){this.pageCurrent=e}}},o=i,l=a(1001),n=(0,l.Z)(o,r,s,!1,null,"277403d7",null),c=n.exports},42348:function(e,t,a){a.r(t),a.d(t,{default:function(){return f}});var r=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{width:"100%"}},[t("el-card",[t("el-row",[t("el-col",{attrs:{span:12}},[t("el-button",{staticStyle:{"margin-left":"0","margin-right":"3px"},attrs:{"el-button":"",type:"primary",size:"mini"},on:{click:function(t){return e.uploadClick("新增")}}},[e._v("添加 ")]),t("el-input",{staticClass:"input-with-select",staticStyle:{width:"20%","margin-right":"3px"},attrs:{placeholder:"请输入名称",size:"mini"},model:{value:e.selectInput,callback:function(t){e.selectInput=t},expression:"selectInput"}}),t("el-button",{staticStyle:{color:"#909399",background:"#f4f4f5","border-color":"#d3d4d6"},attrs:{icon:"el-icon-search",size:"mini"},on:{click:e.selectSearch}})],1)],1),t("el-table",{staticClass:"tableCell",staticStyle:{width:"100%","margin-top":"5px"},attrs:{data:e.agentData,"cell-style":{padding:"0px"},"header-cell-style":{color:"#909399",textAlign:"center",background:"#f5f7fa"}}},[t("el-table-column",{attrs:{prop:"name",label:"名称",width:"180"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-badge",{staticClass:"item",attrs:{value:!0===a.row.deprecated?"已过期":"",type:"warning"}},[t("el-button",{attrs:{size:"small",type:"text"}},[e._v(" "+e._s(a.row.name))])],1)]}}])}),t("el-table-column",{attrs:{prop:"goos",label:"平台",width:"150"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row?t("span"):e._e(),t("svg",{staticClass:"iconTabel",attrs:{"aria-hidden":"true"}},[t("use",{attrs:{"xlink:href":"linux"===a.row.goos?"#icon-linux1":"windows"===a.row.goos?"#icon-Windows1":"#icon-pingguo"}})]),e._v(" "+e._s(a.row.goos)+" ")]}}])}),t("el-table-column",{attrs:{prop:"arch",label:"arch",width:"100"}}),t("el-table-column",{attrs:{prop:"semver",label:"版本",width:"130"}}),t("el-table-column",{attrs:{prop:"created_at",label:"创建时间",width:"170"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("date")(t.row.created_at,"yyyy-MM-dd hh:mm:ss"))+" ")]}}])}),t("el-table-column",{attrs:{prop:"updated_at",label:"更新时间",width:"170"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("date")(t.row.updated_at,"yyyy-MM-dd hh:mm:ss"))+" ")]}}])}),t("el-table-column",{attrs:{prop:"changelog",label:"更新日志"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-popover",{attrs:{placement:"top-start",width:"300",trigger:"hover"}},[t("pre",[e._v(e._s(a.changelog))]),t("div",{staticClass:"changelogBox",attrs:{slot:"reference"},slot:"reference"},[e._v(" "+e._s(a.changelog)+" ")])])]}}])}),t("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-popover",{ref:a.row.id+1,attrs:{placement:"top",width:"200"}},[t("p",[e._v("确定推送?")]),t("div",{staticStyle:{"text-align":"right",margin:"0"}},[t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){e.$refs[a.row.id+1].doClose()}}},[e._v("取消")]),t("el-button",{attrs:{loading:e.delLoading,type:"primary",size:"mini"},on:{click:function(t){return e.operaEdition(a.row)}}},[e._v("确定 ")])],1),t("el-button",{attrs:{slot:"reference",type:"text",size:"mini",disabled:!0===a.row.deprecated},slot:"reference"},[e._v("推送")])],1),t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"text",size:"mini"},on:{click:function(t){return e.fileDownload(a.row)}}},[e._v("下载")]),t("el-popover",{ref:a.row.id,attrs:{placement:"top",width:"200"}},[t("p",[e._v("确定删除?")]),t("div",{staticStyle:{"text-align":"right",margin:"0"}},[t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){e.$refs[a.row.id].doClose()}}},[e._v("取消")]),t("el-button",{attrs:{loading:e.delLoading,type:"primary",size:"mini"},on:{click:function(t){return e.subDelete(a.row.id)}}},[e._v("确定 ")])],1),t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{slot:"reference",type:"text",size:"mini"},slot:"reference"},[e._v("删除")])],1),t("el-popover",{ref:a.row.id+2,attrs:{placement:"top",width:"200"}},[t("p",[e._v("将Agent版本标记为过期?")]),t("div",{staticStyle:{"text-align":"right",margin:"0"}},[t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){e.$refs[a.row.id+2].doClose()}}},[e._v("取消")]),t("el-button",{attrs:{loading:e.delLoading,type:"primary",size:"mini"},on:{click:function(t){return e.deprecate(a.row)}}},[e._v("确定")])],1),t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{slot:"reference",type:"text",size:"mini",disabled:!0===a.row.deprecated},slot:"reference"},[e._v("标记过期 ")])],1)]}}])})],1),t("Page",{attrs:{size:e.size,current:e.current,pageTotal:e.pageTotal,pageSizeArray:e.pageSizeArray},on:{handleSizeChange:e.handleSizeChange,handleCurrentChange:e.handleCurrentChange}})],1),t("EditForm",{ref:"forms",attrs:{"is-add":e.isAdd,agentList:e.agentList}}),t("el-dialog",{attrs:{"before-close":e.handleClose,"el-dialog":"","close-on-click-modal":!1,visible:e.fileShow,title:!0===e.upShow?"新增":"上传","append-to-body":"",width:"500px"},on:{"update:visible":function(t){e.fileShow=t},open:e.dialogOpen,close:e.dialogClose}},[t("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,size:"small","label-width":"100px"}},[t("el-form-item",{attrs:{label:"文件名",prop:"name"}},[t("el-input",{attrs:{type:"text",size:"mini"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),t("el-form-item",{attrs:{label:"版本",prop:"semver"}},[t("el-input",{attrs:{type:"text",size:"mini"},model:{value:e.form.semver,callback:function(t){e.$set(e.form,"semver",t)},expression:"form.semver"}})],1),t("el-form-item",{attrs:{label:"操作系统",prop:"goos"}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.form.goos,callback:function(t){e.$set(e.form,"goos",t)},expression:"form.goos"}},e._l(e.paltformList,(function(e,a){return t("el-option",{key:a,attrs:{value:e,label:e}})})),1)],1),t("el-form-item",{attrs:{label:"文件",prop:"file"}},[t("el-upload",{ref:"file",staticClass:"upload-demo",attrs:{action:"/","on-remove":e.handleRemove,"before-remove":e.beforeRemove,"on-change":e.filseSuccess,multiple:"",limit:1,accept:"windows"===e.form.goos?".exe":"","on-exceed":e.handleExceed,"auto-upload":!1}},[t("el-button",{attrs:{size:"small",icon:"el-icon-upload"}},[e._v("点击上传")])],1)],1),t("el-form-item",{attrs:{label:"系统架构",prop:"arch"}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.form.arch,callback:function(t){e.$set(e.form,"arch",t)},expression:"form.arch"}},e._l(e.archData,(function(e){return t("el-option",{key:e.label,attrs:{value:e.value,label:e.label}})})),1)],1),t("el-form-item",{attrs:{label:"版本更新日志",prop:"changelog"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:2},placeholder:"请输入内容"},model:{value:e.form.changelog,callback:function(t){e.$set(e.form,"changelog",t)},expression:"form.changelog"}})],1)],1),e.showProgress?t("el-progress",{attrs:{percentage:e.percentageformat}}):e._e(),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.fileShow=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onSubmit("form")}}},[e._v("提交")])],1)],1),t("el-dialog",{attrs:{visible:e.downShow,title:"下载客户端",width:"30%"},on:{"update:visible":function(t){e.downShow=t}}},[t("el-select",{attrs:{size:"mini","value-key":"id"},on:{change:e.seletRoom},model:{value:e.selectData,callback:function(t){e.selectData=t},expression:"selectData"}},e._l(e.roomData,(function(e){return t("el-option",{key:e.id,attrs:{value:e,label:e.name}})})),1),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.downFile}},[e._v("下载")]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.lanShare}},[e._v("内网分享 ")]),t("el-button",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:e.copyvalue,expression:"copyvalue",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:e.firstCopySuccess,expression:"firstCopySuccess",arg:"success"}],attrs:{type:"primary",size:"mini"},on:{click:e.vipShare}},[e._v("外网分享 ")]),t("button",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"},{name:"clipboard",rawName:"v-clipboard:copy",value:e.copyvalue,expression:"copyvalue",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:e.firstCopySuccess,expression:"firstCopySuccess",arg:"success"},{name:"clipboard",rawName:"v-clipboard:error",value:e.copyError,expression:"copyError",arg:"error"}],ref:"copyvalueRef",staticStyle:{display:"inline-block"}})],1)],1)},s=[],i=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{"before-close":e.handleClose,"el-dialog":"","close-on-click-modal":!1,visible:e.dialogVisible,title:e.isAdd?"新增服务":"编辑服务","append-to-body":"",width:"500px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,size:"small","label-width":"95px"}},[t("el-form-item",{attrs:{label:"名称",prop:"name"}},[t("el-input",{attrs:{type:"text"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),t("el-form-item",{attrs:{label:"描述",prop:"desc"}},[t("el-input",{attrs:{type:"text"},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1),t("el-form-item",{attrs:{label:"插件",prop:"code_ids"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{multiple:""},model:{value:e.form.code_ids,callback:function(t){e.$set(e.form,"code_ids",t)},expression:"form.code_ids"}},e._l(e.codeList,(function(e){return t("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onSubmit("form")}}},[e._v(e._s(e.isAdd?"创建":"修改"))])],1)],1)},o=[],l={name:"formService",props:{isAdd:Boolean,codeList:Array},data(){return{form:{id:"",name:"",desc:"",code_ids:[],semver:""},dialogVisible:!1,rules:{name:[{required:!0,message:"请输入名称",trigger:"blur"}],desc:[{required:!0,message:"请输入描述",trigger:"blur"}],code_ids:[{required:!0,message:"请选择插件",trigger:"change"}]}}},methods:{handleClose(){this.dialogVisible=!1},onSubmit(e){this.$refs[e].validate((e=>{e&&(this.isAdd?this.$request.fetchAddService(this.form).then((()=>{this.$message({message:"添加成功!!!",type:"success"}),this.$parent.getService(),this.dialogVisible=!1,this.form={}})).catch((e=>{this.$message.error(e.data)})):this.$request.fetchUpdataService(this.form).then((()=>{this.$message({message:"编辑成功!!!",type:"success"}),this.$parent.getService(),this.dialogVisible=!1,this.form={}})).catch((e=>{this.$message.error(e.data)})))}))}}},n=l,c=a(1001),d=(0,c.Z)(n,i,o,!1,null,"89f5a772",null),h=d.exports,p=(a(28451),a(12037)),u={name:"index",components:{Page:p.Z,EditForm:h},data(){return{archData:[{value:"386",label:"386"},{value:"amd64",label:"amd64"}],paltformList:["linux","windows","darwin"],downShow:!1,copyvalue:"",roomData:[],selectData:{},editionId:"",activeData:{},current:1,size:10,pageTotal:0,agentData:[],isAdd:!0,delLoading:!1,agentList:[],selectInput:"",fileShow:!1,form:{name:"",goos:"",file:"",arch:"",semver:"",changelog:""},rules:{file:[{required:!0,message:"请上传文件",trigger:"change"}],semver:[{required:!0,message:"请输入版本",trigger:"blur"}],name:[{required:!0,message:"请输入文件名",trigger:"blur"}],arch:[{required:!0,message:"请输入系统架构",trigger:"change"}],goos:[{required:!0,message:"请输入操作系统",trigger:"blur"}]},value:"",pageSizeArray:[10,20,30,40],upShow:!1,percentage:0,showProgress:!1,timer:null}},computed:{percentageformat(){return Math.min(100,+Number(this.percentage).toFixed(1))}},created(){this.getAgent()},beforeDestroy(){clearInterval(this.timer)},methods:{firstCopySuccess(){this.$message.success("内容已复制到剪切板！")},onSubmit(){let e=new FormData;e.append("name",this.form.name),e.append("file",this.form.file),e.append("semver",this.form.semver),e.append("goos",this.form.goos),e.append("arch",this.form.arch),e.append("changelog",this.form.changelog),this.showProgress=!0,this.percentage=0,clearInterval(this.timer),this.timer=setInterval((()=>{this.percentage<30?this.percentage+=.3:this.percentage<80?this.percentage+=50/150:this.percentage<90?this.percentage+=.1:this.percentage<98?this.percentage+=.04:this.percentage+=.004,this.percentage>=100&&clearInterval(this.timer)}),100),this.$request.fetchUploadFile(e).then((e=>{this.$message({message:"添加成功!!!",type:"success"}),this.fileShow=!1,this.form={},this.$refs.file.clearFiles(),this.getAgent()})).catch((e=>{this.$message.error(e.data)})).finally((()=>{this.showProgress=!1}))},uploadClick(e){"新增"!==e?(this.form=e,this.upShow=!1):this.upShow=!0,this.fileShow=!0},handleClose(){this.form={},this.fileShow=!1},operaEdition(e){this.$refs[e.id+1].doClose();var t=this;this.$request.fetchCheckEdtion({id:e.id}).then((e=>{t.$message({message:"推送成功!!!",type:"success"}),t.getAgent()})).catch((e=>{this.$message.error(e.data)}))},fileDownload(e){this.activeData=e,this.editionId=e.id,this.downShow=!0,this.$request.fetchGetIndices().then((e=>{this.roomData=e.data}))},downFile(){if(this.selectData.id){let e=document.createElement("a");e.href="/api/v1/deploy/minion/download?id="+this.editionId+"&broker_id="+this.selectData.id,e.target="_blank",e.click()}else this.$message.error("请选择")},seletRoom(){this.$request.fetchGetLan().then((e=>{this.value=e.data.scheme+"://"+e.data.addr+"/api/v1/deploy/minion?goos="+this.activeData.goos+"&broker_id="+this.selectData.id+"&arch="+this.activeData.arch}))},lanShare(){this.copyvalue="",this.selectData.id?this.selectData?.lan?.length>0?this.$request.fetchGetLan().then((e=>{this.copyvalue=e.data.scheme+"://"+e.data.addr+"/api/v1/deploy/minion?goos="+this.activeData.goos+"&broker_id="+this.selectData.id+"&arch="+this.activeData.arch+"&version="+this.activeData.semver,this.$nextTick((()=>{this.$refs.copyvalueRef.click()}))})).catch((e=>{console.error(e),this.$message.error("复制地址出错")})):(this.copyvalue="",this.$message.error("暂无内网")):(this.copyvalue="",this.$message.error("请选择"))},vipShare(){this.copyvalue="",this.selectData.id?this.copyvalue=window.location.protocol+"//"+window.location.host+"/api/v1/deploy/minion?goos="+this.activeData.goos+"&broker_id="+this.selectData.id+"&arch="+this.activeData.arch+"&version="+this.activeData.semver:this.$message.error("请选择")},wsJudge(e){return"ws"===e?"http":"https"},filseSuccess(e,t){this.form.file=e.raw},handleRemove(e,t){var a=this;a.form.file=""},beforeRemove(e,t){return this.$confirm(`确定移除 ${e.name} ？`)},handleExceed(e,t){this.$message.warning(`当前限制选择 3 个文件，本次选择了 ${e.length} 个文件，共选择了 ${e.length+t.length} 个文件`)},subDelete(e){this.$refs[e].doClose();var t=this;t.delLoading=!0,this.$request.fetchDeleteAgent(e).then((e=>{t.$message({message:"删除成功!!!",type:"success"}),t.delLoading=!1,t.getAgent()})).catch((e=>{this.$message.error(e.data)}))},deprecate(e){this.$refs[e.id+2].doClose();var t=this;this.$request.fetchDeprecate({id:e.id}).then((e=>{t.$message({message:"标记成功!!!",type:"success"}),t.getAgent()})).catch((e=>{this.$message.error(e.data)}))},getAgent(){var e={current:this.current,size:this.size};this.$request.fetchGetAgent(e).then((e=>{this.agentData=e.data.records,this.pageTotal=e.data.total})).catch((e=>{this.$message.error(e.data)}))},percentageChange(e,t){return 0===e?0:parseInt(e/t*1e4)/100},customColorMethod(e,t){var a=this.percentageChange(e,t);return a<30?"#67c23a":a<70?"#e6a23c":"#f56c6c"},handleSizeChange(e){this.size=e,this.getAgent()},handleCurrentChange(e){this.current=e,this.getAgent()},handleDelete(e,t){this.$message({showClose:!0,message:e,row:t,type:"success"})},formatter(e,t){return e.address},filterTag(e,t){return t.tag===e},filterHandler(e,t,a){const r=a["property"];return t[r]===e},selectSearch(){""!==this.selectInput?this.agentData=this.agentData.filter((e=>!this.selectInput||e.name.toLowerCase().includes(this.selectInput.toLowerCase()))):this.getAgent()},copyError(e){console.error(e)},dialogOpen(){this.showProgress=!1,this.percentage=0,clearInterval(this.timer)},dialogClose(){this.showProgress=!1,this.percentage=0,clearInterval(this.timer)}}},g=u,m=(0,c.Z)(g,r,s,!1,null,"2fbef0a2",null),f=m.exports},28451:function(e,t,a){var r=a(20144);r["default"].filter("date",(function(e,t){var a=new Date(e),r={"M+":a.getMonth()+1,"d+":a.getDate(),"h+":a.getHours(),"m+":a.getMinutes(),"s+":a.getSeconds(),"q+":Math.floor((a.getMonth()+3)/3),S:a.getMilliseconds()};for(var s in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length))),r)new RegExp(`(${s})`).test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?r[s]:("00"+r[s]).substr((""+r[s]).length)));return t}))}}]);