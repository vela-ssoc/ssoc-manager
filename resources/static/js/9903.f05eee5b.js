"use strict";(self["webpackChunkssoc"]=self["webpackChunkssoc"]||[]).push([[9903,984,5012],{49236:function(t,e,a){a.d(e,{Z:function(){return d}});var s=function(){var t=this,e=t._self._c;return e("detail",t._g(t._b({},"detail",t.$attrs,!1),t.$listeners))},i=[],n=a(50265),l={components:{detail:n.Z}},r=l,o=a(1001),c=(0,o.Z)(r,s,i,!1,null,null,null),d=c.exports},84241:function(t,e,a){a.d(e,{Z:function(){return c}});var s=function(){var t=this,e=t._self._c;return t.condData?e("div",[t.multiCondition?e("el-row",{staticStyle:{"margin-bottom":"5px"}},[e("el-col",{attrs:{span:24}},t._l(t.filters,(function(a,s){return e("span",{key:s,staticStyle:{"margin-right":"5px","font-size":"12px",color:"#fff",padding:"3px","border-radius":"3px","background-color":"#409eff",display:"inline-block"}},[t._v(" "+t._s(a.keyDesc)+" "+t._s(a.operatorDesc)+" "+t._s(a.value)+" "),e("i",{staticClass:"el-icon-edit",staticStyle:{cursor:"pointer"},on:{click:function(e){return t.editTag(a,s)}}}),e("i",{staticClass:"el-icon-close",staticStyle:{cursor:"pointer"},on:{click:function(e){return t.delTag(a,s)}}})])})),0)],1):t._e(),e("div",{class:"事件详情"===t.nameIndex||"任务详情"===t.nameIndex||"风险详情"===t.nameIndex?"dom":"doms"},[t._l(t.selectArray,(function(a,s){return e("span",{key:s},["蜜罐"!==t.nameIndex?e("el-dropdown",{staticStyle:{"margin-right":"5px"},attrs:{trigger:"click"}},[e("el-button",{attrs:{type:"primary",size:"mini"}},[t._v(" "+t._s(a.placeholder)),e("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(a.dataArray,(function(s){return e("el-dropdown-item",{key:s.key,attrs:{value:s.key},nativeOn:{click:function(e){return t.selectActive(s,a)}}},[t._v(t._s(s.desc))])})),1)],1):t._e()],1)})),"事件展示"===t.nameIndex?e("span",[e("el-dropdown",{staticStyle:{"margin-right":"5px"},attrs:{trigger:"click"}},[e("el-button",{attrs:{type:"primary",size:"mini"}},[t._v(" 时间搜索"),e("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.eventTime,(function(a){return e("el-dropdown-item",{key:a.value,attrs:{value:a.value},nativeOn:{click:function(e){return t.eventTimeChange(a)}}},[t._v(t._s(a.label))])})),1)],1)],1):t._e(),"事件详情"===t.nameIndex?e("el-button",{attrs:{type:"success",size:"mini"},on:{click:t.oneClear}},[t._v("一键清除")]):t._e(),"事件详情"===t.nameIndex||"任务详情"===t.nameIndex||"风险详情"===t.nameIndex?e("el-button",{staticStyle:{"margin-right":"7px"},attrs:{type:"success",size:"mini"},on:{click:t.refresh}},[t._v("刷新")]):t._e(),e("el-select",{staticStyle:{width:"150px","margin-right":"7px"},attrs:{size:"mini","value-key":"key"},on:{change:t.selectField},model:{value:t.key,callback:function(e){t.key=e},expression:"key"}},[t._l(t.condData.conditions,(function(a,s){return[a.key!==t.eventLogon?e("el-option",{key:s,attrs:{value:a.key,label:a.desc}}):t._e()]}))],2),e("el-select",{staticStyle:{width:"100px","margin-right":"7px"},attrs:{size:"mini","value-key":"key"},on:{change:t.selectOperator},model:{value:t.operator,callback:function(e){t.operator=e},expression:"operator"}},t._l(t.selectFieldDerive.operatorArray,(function(t,a){return e("el-option",{key:a,attrs:{value:t.key,label:t.desc}})})),1),["datetime","time"].includes(t.selectFieldDerive.typeConditions)?e("span",{staticStyle:{display:"inline-block","margin-right":"7px"}},[e("el-date-picker",{attrs:{clearable:"",type:"datetime",pickerOptions:t.pickerOptions,placeholder:"选择时间",size:"mini"},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})],1):e("span",{staticStyle:{display:"inline-block","margin-right":"7px"}},[t.selectFieldDerive.selectType?e("el-select",{staticStyle:{width:"180px"},attrs:{size:"mini",clearable:"","value-key":"key",multiple:"in"===t.operator||"notin"===t.operator,"collapse-tags":""},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}},t._l(t.selectFieldDerive.valueArray,(function(t,a){return e("el-option",{key:a,attrs:{value:t.key,label:t.desc}})})),1):e("span",{staticStyle:{position:"relative",display:"inline-block"}},[e("el-input",{staticStyle:{width:"200px"},attrs:{size:"mini",clearable:""},on:{focus:function(e){t.suggestVisible=!0}},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})],1)],1),e("el-button",{class:"事件详情"===t.nameIndex||"任务详情"===t.nameIndex||"风险详情"===t.nameIndex?"buttons":"buttonsearch",attrs:{icon:"el-icon-search",size:"mini"},on:{click:()=>{t.suggestVisible=!1,t.searchCond()}}},[t._v(t._s(t.titleH)+" ")])],2)],1):t._e()},i=[],n={name:"index",props:{titleH:{type:String,default:function(){return""}},condData:{type:Object,default:function(){return{}}},defaultData:{type:Object,default:function(){return{}}},eventLogon:{type:String,default:function(){return""}},nameIndex:{type:String,default:function(){return""}},selectArray:{type:Array,default:function(){return[]}},multiCondition:{default:!0},inputSuggestOptions:{type:Object}},computed:{selectFieldDerive(){var t=this.condData?.conditions?.findIndex((t=>t.key===this.key));return{operatorArray:this.condData?.conditions?.[t]?.operators||[],selectType:this.condData?.conditions?.[t]?.enum,valueArray:this.condData?.conditions?.[t]?.enums||[],typeConditions:this.condData?.conditions?.[t]?.type}},suggestOption(){return this.inputSuggestOptions&&this.inputSuggestOptions[this.key]||[]}},data(){return{operator:"",value:null,key:"",filters:[],current:1,pageSize:15,suggestVisible:!1,eventTime:[{value:"900",label:"十五分钟"},{value:"3600",label:"一小时"},{value:"86400",label:"一天"},{value:"604800",label:"一周"},{value:"2592000",label:"一个月"}],pickerOptions:{disabledDate(t){return t.getTime()>Date.now()},shortcuts:[{text:"今天",onClick(t){t.$emit("pick",new Date)}},{text:"昨天",onClick(t){const e=new Date;e.setTime(e.getTime()-864e5),t.$emit("pick",e)}},{text:"一周前",onClick(t){const e=new Date;e.setTime(e.getTime()-6048e5),t.$emit("pick",e)}},{text:"三十天前",onClick(t){const e=new Date;e.setTime(e.getTime()-2592e6),t.$emit("pick",e)}}]}}},created(){const t=this.filters.push.bind(this.filters);this.filters.push=(...e)=>{for(let a of e){const e=this.filters.find((t=>t.key===a.key));e?Object.assign(e,a):(!this.multiCondition&&this.filters.length>0&&(this.filters.length=0),t(a))}},"彻底删除"===this.nameIndex?(this.filters.push(this.getSelectItem("status","eq","4")),this.$emit("searchBasic",this.filters)):(this.key=this.defaultData?.key||null,this.operator=this.defaultData?.operator||null)},methods:{refresh(){this.$emit("refresh")},oneClear(){this.$emit("oneClear")},selectField(t){this.value=void 0,this.$nextTick((()=>{this.operator=this.selectFieldDerive.operatorArray.some((t=>"like"===t.key))?"like":this.selectFieldDerive.operatorArray?.[0].key}))},selectOperator(t){this.operatorValue=t.key,this.value=null},eventTimeChange(t){this.filters.length=0,this.filters.push(this.getSelectItem("created_at","lt",new Date)),this.filters.push(this.getSelectItem("created_at","gt",new Date(new Date-24e3*t.value))),this.$emit("searchBasic",this.filters)},selectActive(t,e){this.filters.push(this.getSelectItem(e.name,"eq",t.key)),this.$emit("searchBasic",this.filters)},delTag(t,e){("蜜罐"!==this.nameIndex&&"事件详情"!==this.nameIndex&&"风险详情"!==this.nameIndex||0!==e)&&(this.filters.splice(e,1),this.$emit("searchBasic",this.filters))},editTag(t,e){("蜜罐"!==this.nameIndex&&"事件详情"!==this.nameIndex&&"风险详情"!==this.nameIndex||0!==e)&&(this.key=t.key,this.value=t.value,this.operator=t.operator)},getSelectItem(t,e,a){return{key:t,keyDesc:this.condData?.conditions?.find((e=>e.key===t))?.desc,value:a,operator:e,operatorDesc:this.selectFieldDerive.operatorArray.find((t=>t.key===e))?.desc}},searchCond(){if(""!==this.key&&void 0!==this.value&&void 0!==this.operator&&null!==this.value&&""!==this.value){const t=this.getSelectItem(this.key,this.operator,this.value);this.filters.push(t)}if(!this.value&&this.key){const t=this.filters.find((t=>t.key===this.key));-1!==t&&this.filters.splice(t,1)}this.$emit("searchBasic",this.filters)},setOption(t,e,a){this.key=t,this.operator=e,this.value=a,this.searchCond()}},watch:{nameIndex:function(t,e){"彻底删除"===t&&t!==e&&(this.filters.push(this.getSelectItem("status","eq","4")),this.$emit("searchBasic",this.filters))}}},l=n,r=a(1001),o=(0,r.Z)(l,s,i,!1,null,"1e98ace1",null),c=o.exports},19325:function(t,e,a){a.r(e),a.d(e,{default:function(){return P}});var s=function(){var t=this,e=t._self._c;return e("div",{staticStyle:{width:"100%"}},[e("el-card",[e("el-row",[e("el-col",{attrs:{span:12}},[e("el-input",{staticClass:"input-with-select",staticStyle:{width:"20%"},attrs:{placeholder:"请输入名称",size:"mini"},model:{value:t.selectInput,callback:function(e){t.selectInput=e},expression:"selectInput"}}),e("el-button",{staticStyle:{color:"#909399",background:"#f4f4f5","border-color":"#d3d4d6"},attrs:{icon:"el-icon-search",size:"mini"},on:{click:t.getCode}})],1),e("el-col",{staticStyle:{"text-align":"right"},attrs:{span:12}},[e("el-button",{staticStyle:{"margin-left":"0"},attrs:{"el-button":"",type:"success",plain:"",size:"mini"},on:{click:t.addCode}},[t._v("添加")])],1)],1),null!==t.codeData?e("div",{staticClass:"ivu-list-split"},t._l(t.codeData,(function(a){return e("ul",{key:a.id,staticClass:"ivu-list-items"},[e("li",{staticClass:"ivu-list-item"},[e("div",{staticClass:"ivu-list-item-meta"},[e("div",{staticClass:"ivu-list-item-meta-avatar"},[e("span",{staticClass:"ivu-avatar ivu-avatar-square ivu-avatar-image ivu-avatar-large"},[e("svg-icon",{staticClass:"el-input__icon",staticStyle:{height:"42px",width:"32px"},attrs:{slot:"prefix","icon-class":t.iconImg(a.icon)},slot:"prefix"})],1)]),e("div",{staticClass:"ivu-list-item-meta-content"},[e("div",{staticClass:"ivu-list-item-meta-title"},[t._v(t._s(a.desc))]),e("div",{staticClass:"ivu-list-item-meta-description"},[t._v(" "+t._s(a.name)+" ")])])]),e("div",{staticClass:"list-basic-list-content"},[e("div",{staticClass:"list-basic-list-content-item",staticStyle:{width:"240px"}},[e("span",[t._v("开始时间")]),e("p",[t._v(t._s(t._f("date")(a.created_at,"yyyy-MM-dd hh:mm:ss")))])])]),e("ul",{staticClass:"ivu-list-item-action"},[e("li",[e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.edit(a)}}},[t._v("编辑")])],1),e("li",[e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.subDelete(a.id)}}},[t._v("删除")])],1)])])])})),0):e("div",[e("el-empty",{attrs:{description:"暂无数据"}})],1),e("Page",{attrs:{size:t.size,current:t.current,pageSizeArray:t.pageSizeArray,pageTotal:t.pageTotal},on:{handleSizeChange:t.handleSizeChange,handleCurrentChange:t.handleCurrentChange}})],1),e("Form",{ref:"forms",attrs:{"is-add":t.isAdd}}),e("AddForm",{ref:"formAdd"})],1)},i=[],n=function(){var t=this,e=t._self._c;return e("el-drawer",{staticClass:"systemSet",attrs:{visible:t.dialogVisible,"show-close":!1,direction:"rtl","before-close":t.handleClose,size:"90%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("div",{attrs:{slot:"title"},slot:"title"}),e("el-form",{ref:"form",staticStyle:{padding:"5px 10px 0"},attrs:{model:t.form,"label-width":"70px","label-position":"top"}},[e("el-row",[e("el-col",{attrs:{span:12}},[e("el-button",{attrs:{type:"text"}},[t._v(t._s(t.serverData.name))])],1),e("el-col",{staticStyle:{"text-align":"right"},attrs:{span:12}},[e("i",{staticClass:"fa fa-code",staticStyle:{color:"#3d95ff"},attrs:{title:"显示/隐藏代码"},on:{click:t.editCode}}),e("i",{staticClass:"fa fa-refresh",staticStyle:{"margin-left":"10px",color:"#63a35c",cursor:"pointer"},attrs:{title:"刷新"},on:{click:t.refreshCode}}),e("i",{staticClass:"fa fa-cloud-upload",staticStyle:{"margin-left":"10px",color:"#3d95ff",cursor:"pointer"},attrs:{title:"提交"},on:{click:function(e){return t.onSubmit("form")}}}),e("i",{staticClass:"fa fa-close",staticStyle:{margin:"0 5px 0 10px",color:"#9e9e9e",cursor:"pointer"},attrs:{title:"关闭"},on:{click:function(e){t.dialogVisible=!1}}})])],1),e("el-row",[e("el-col",{attrs:{span:24}},[e("el-row",[t.codeShow?e("el-col",{attrs:{span:24}},[e("div",{ref:"generateId",staticClass:"code-editor"})]):t._e()],1)],1)],1)],1)],1)},l=[],r=a(68632),o=a(3645),c=a(91938),d=a(53239),h=a.n(d),p=(a(83734),a(70790),a(37336),a(58119),a(55259)),u=a.n(p),m=a(6201),f=a.n(m),v=a(74358),g=a.n(v);h().config.setModuleUrl("ace/mode/lua_worker",u()),h().config.setModuleUrl("ace/mode/lua_worker",u()),h().config.setModuleUrl("ace/mode/css_worker",f()),h().config.setModuleUrl("ace/keyboard/vim",g());var y={name:"formCode",components:{IconSelect:c.Z,Event:r.Z,IndexForm:o["default"]},props:{isAdd:Boolean},data(){return{activeName:"first",evnetShow:!0,taskShow:!1,codeIcon:"",codeName:"",linkArray:[],form:{id:"",icon:"",chunk:"",version:0,name:""},serverData:[],dialogVisible:!1,linkData:[],dialogValue:"",dataTask:{},codeShow:!0}},updated(){this.editor=h().edit(this.$refs.generateId,{keyboardHandler:"ace/keyboard/vim",enableSnippets:!0,enableLiveAutocompletion:!0,enableBasicAutocompletion:!0,mode:"ace/mode/lua",theme:"ace/theme/dracula",fontSize:12,tabSize:2,value:this.dialogValue,selectionStyle:"text",showLineNumbers:!0,showGutter:!0,showPrintMargin:!0,printMarginColumn:170})},methods:{handleClick(t,e){"1"===t.index?this.taskShow=!0:this.taskShow=!1},dateTime(t){var e=a(30381);return e(t).format("YYYY-MM-DD HH:mm:ss")},refreshCode(){this.$emit("handleEdit",this.dataTask)},editCode(){this.codeShow=!this.codeShow},deleteLink(t){JSON.stringify(this.linkArray);var e=this.linkArray.indexOf(t);this.linkArray.splice(e,1)},pushLink(t){this.linkArray.push(t)},selected(t){this.form.icon=t,this.codeIcon=t},nullChange(t){return""!==t&&" "!==t?t:"无"},filseSuccess(t,e){var a=this;if(t.raw){let e=new FileReader;e.onload=function(t){a.editor.setValue(t.target.result)},e.readAsText(t.raw)}},handleRemove(t,e){var a=this;a.editor.setValue("")},handlePreview(t){},handleExceed(t,e){this.$message.warning(`当前限制选择 3 个文件，本次选择了 ${t.length} 个文件，共选择了 ${t.length+e.length} 个文件`)},beforeRemove(t,e){return this.$confirm("确定移除 $ { file.name } ？")},handleClose(){this.dialogVisible=!1,this.form={}},onSubmit(){let t=a(19575).Base64,e=t.encode(this.editor.getValue(this.dialogValue)),s=t.encode(this.form.icon);var i={id:this.form.id,icon:s,chunk:e,version:this.form.version,name:this.form.name};this.$request.fetchPatchCodeJob(i).then((t=>{this.refreshCode(),this.$message({message:"编辑成功",type:"success"})})).catch((t=>{this.$message.error(t.data)}))}},watch:{dialogValue:function(t){void 0!==this.editor&&(this.dialogValue=this.editor.setValue(t))}}},b=y,_=a(1001),w=(0,_.Z)(b,n,l,!1,null,"61cc2794",null),k=w.exports,S=a(12037),D=function(){var t=this,e=t._self._c;return e("el-dialog",{staticClass:"code-form",attrs:{"show-close":!1,"close-on-press-escape":!1,"close-on-click-modal":!1,top:"50px","el-dialog":"",visible:t.dialogVisible,"append-to-body":"",width:"70%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("el-form",{ref:"form",staticClass:"formAdd",attrs:{model:t.form,rules:t.rules,"label-width":"40px"}},[e("el-row",[e("el-col",{staticStyle:{margin:"20px 20px"},attrs:{span:5}},[e("el-form-item",{attrs:{label:" ",prop:"chunk"}},[e("el-upload",{ref:"file",staticClass:"upload-demo",attrs:{action:"/","on-remove":t.handleRemove,"before-remove":t.beforeRemove,"on-change":t.filseSuccess,multiple:"",limit:3,"on-exceed":t.handleExceed,"auto-upload":!1}},[e("el-button",{attrs:{size:"mini",type:"primary"}},[t._v("点击上传 chunk")])],1)],1),e("el-form-item",{attrs:{label:"名称",prop:"name"}},[e("el-input",{attrs:{type:"text",size:"mini"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),e("el-form-item",{attrs:{label:"图标",prop:"icon"}},[e("el-popover",{attrs:{placement:"bottom-start",width:"460",trigger:"click"},on:{show:function(e){return t.$refs["iconSelect"].reset()}}},[e("IconSelect",{ref:"iconSelect",on:{selected:t.selected}}),e("el-input",{attrs:{slot:"reference",placeholder:"点击选择图标",size:"mini",readonly:""},slot:"reference",model:{value:t.form.icon,callback:function(e){t.$set(t.form,"icon",e)},expression:"form.icon"}},[t.form.icon?e("svg-icon",{staticClass:"el-input__icon",staticStyle:{height:"42px",width:"16px"},attrs:{slot:"prefix","icon-class":t.form.icon},slot:"prefix"}):e("i",{staticClass:"el-icon-search el-input__icon",attrs:{slot:"prefix"},slot:"prefix"})],1)],1)],1),e("el-form-item",{attrs:{label:"描述",prop:"desc"}},[e("el-input",{attrs:{type:"textarea",placeholder:"请输入描述"},model:{value:t.form.desc,callback:function(e){t.$set(t.form,"desc",e)},expression:"form.desc"}})],1),e("span",{staticStyle:{width:"100%","text-align":"right",display:"inline-block"}},[e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.onSubmit("form")}}},[t._v("提交")])],1)],1),e("div",{staticStyle:{height:"20px","text-align":"right",padding:"5px"}},[e("i",{staticClass:"fa fa-close",staticStyle:{margin:"0 5px 0 10px",color:"#9e9e9e",cursor:"pointer"},on:{click:function(e){t.dialogVisible=!1}}})]),e("div",{ref:"generateId",staticClass:"code-editor"})],1)],1),e("div",{attrs:{slot:"title"},slot:"title"})],1)},C=[];h().config.setModuleUrl("ace/mode/lua_worker",u()),h().config.setModuleUrl("ace/mode/lua_worker",u()),h().config.setModuleUrl("ace/mode/css_worker",f()),h().config.setModuleUrl("ace/keyboard/vim",g());var x={name:"addForm",components:{IconSelect:c.Z},props:{isAdd:Boolean},data(){return{codeIcon:"",codeName:"",linkArray:[],form:{name:"",icon:"通用",desc:"",chunk:""},dialogVisible:!1,linkData:[],dialogValue:"",rules:{},editor:""}},updated(){var t=this;t.editor=h().edit(this.$refs.generateId,{keyboardHandler:"ace/keyboard/vim",enableSnippets:!0,enableLiveAutocompletion:!0,enableBasicAutocompletion:!0,mode:"ace/mode/lua",theme:"ace/theme/dracula",fontSize:12,tabSize:4,value:this.dialogValue,selectionStyle:"text'",showLineNumbers:!0,showGutter:!0,showPrintMargin:!0,printMarginColumn:170}),t.editor.getSession().on("change",(function(e){t.form.chunk=t.editor.getValue(this.dialogValue)}))},created(){this.getLinks()},methods:{linkCompare(t){var e=this.linkArray.some((e=>{if(e.id===t.id)return!0}));return e},deleteLink(t){JSON.stringify(this.linkArray);var e=this.linkArray.indexOf(t);this.linkArray.splice(e,1)},pushLink(t){this.linkArray.push(t)},selected(t){this.form.icon=t,this.codeIcon=t},getLinks(){this.$request.fetchGetLinks("").then((t=>{this.linkData=t.data})).catch((t=>{this.$message.error(t.data)}))},beforeRemove(t,e){return this.$confirm("确定移除 $ { file.name } ？")},filseSuccess(t,e){var a=this;if(t.raw){let e=new FileReader;e.onload=function(t){a.form.chunk=t.target.result},e.readAsText(t.raw)}},handleRemove(t,e){var a=this;a.form.chunk=""},handleExceed(t,e){this.$message.warning(`当前限制选择 3 个文件，本次选择了 ${t.length} 个文件，共选择了 ${t.length+e.length} 个文件`)},handleClose(){this.dialogVisible=!1,this.form={}},onSubmit(t){this.$refs[t].validate((t=>{if(t){let t=a(19575).Base64,s=t.encode(this.form.chunk),i=t.encode(this.form.icon);var e={name:this.form.name,icon:i,desc:this.form.desc,chunk:s};this.$request.fetchAddJobCode(e).then((t=>{this.$parent.getCode(),this.dialogVisible=!1,this.editor.setValue(""),this.form={name:"",icon:"kafka",desc:"",chunk:""},this.$refs.file.clearFiles(),this.$message({message:"新增成功",type:"success"})})).catch((t=>{this.$message.error(t.data)}))}}))}}},$=x,z=(0,_.Z)($,D,C,!1,null,"775d93fd",null),T=z.exports,E=(a(28451),{name:"node",components:{Form:k,Page:S.Z,AddForm:T},data(){return{current:1,size:10,pageTotal:0,pageSizeArray:["10","20","30","40"],codeData:[],isAdd:!0,delLoading:!1,selectInput:""}},created(){this.getCode()},methods:{iconImg:function(t){let e=a(19575).Base64;return e.decode(t)},edit(t){this.$request.fetchGetChunk(t.id).then((e=>{let s=a(19575).Base64;const i=this.$refs.forms;i.serverData=t,i.dialogValue=s.decode(e.data.chunk),i.form={name:e.data.name,icon:s.decode(e.data.icon),desc:e.data.desc,links:e.data.links,chunk:s.decode(e.data.chunk),id:e.data.id,version:e.data.version},i.codeIcon=s.decode(e.data.icon),i.codeName=e.data.name,i.linkArray=e.data.links,i.dialogVisible=!0})).catch((t=>{this.$message.error(t.data)}))},format(t){return 100===t?"100%":`${t}%`},percentageChange(t,e){return 0===t?0:parseInt(t/e*1e4)/100},customColorMethod(t,e){var a=this.percentageChange(t,e);return a<30?"#67c23a":a<70?"#e6a23c":"#f56c6c"},handleSizeChange(t){this.size=t,this.getCode()},handleCurrentChange(t){this.current=t,this.getCode()},addCode(){this.$nextTick((()=>{const t=this.$refs.formAdd;t.dialogVisible=!0}))},subDelete(t){var e=this;e.delLoading=!0;var a={id:t};this.$request.fetchDeleteJob(a).then((t=>{e.$message({message:"删除成功!!!",type:"success"}),e.delLoading=!1,e.getCode()})).catch((t=>{this.$message.error(t.data)}))},getCode(){var t={current:this.current,size:this.size,name:this.selectInput};this.$request.fetchGetJobCdes(t).then((t=>{this.codeData=t.data.records,this.pageTotal=t.data.total})).catch((t=>{this.$message.error(t.data)}))},handleEdit(t,e){},handleDelete(t,e){this.$message({showClose:!0,message:t,row:e,type:"success"})},formatter(t,e){return t.address},filterTag(t,e){return e.tag===t},filterHandler(t,e,a){const s=a["property"];return e[s]===t}}}),I=E,A=(0,_.Z)(I,s,i,!1,null,"25b64130",null),P=A.exports},3645:function(t,e,a){a.r(e),a.d(e,{default:function(){return M}});var s=function(){var t=this,e=t._self._c;return e("el-card",[t.chartShow?e("el-row",{attrs:{gutter:10}},[e("el-col",{staticStyle:{"margin-bottom":"10px"},attrs:{span:24}},[e("taskCount")],1)],1):t._e(),t.taskDetailShow?e("taskDetail",{on:{activeClick:t.activeClick,activechartShow:t.activechartShow}}):t._e(),t.taskSumShow?e("taskSum",{on:{activeClick:t.activeClick,activechartShow:t.activechartShow}}):t._e()],1)},i=[],n=function(){var t=this,e=t._self._c;return e("div",[e("el-row",[e("el-col",{attrs:{span:14}},[e("select-search",{ref:"selectRef",attrs:{condData:t.condData,selectArray:t.selectArray},on:{searchBasic:t.searchBasic}})],1),e("el-col",{staticStyle:{"text-align":"right"},attrs:{span:10}},[e("el-button",{staticStyle:{margin:"10px 0"},attrs:{type:"success",plain:"",size:"mini"},on:{click:t.echartShow}},[t._v(" "+t._s(!0===t.topEchartShow?"隐藏图表":"显示图表")+" ")]),e("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:t.resync}},[t._v("一键同步")]),e("el-button",{attrs:{plain:"",type:"primary",size:"mini"},on:{click:t.addService}},[t._v("发布")]),e("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:t.refresh}},[t._v("刷新")]),e("el-button-group",[e("el-button",{attrs:{type:"primary",size:"mini"}},[t._v("任务详情")]),e("el-button",{attrs:{type:"info",size:"mini"},on:{click:t.attackShow}},[t._v("任务汇总")])],1)],1)],1),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tableLoading,expression:"tableLoading"}],staticStyle:{width:"100%","margin-top":"5px"},attrs:{data:t.initData.records,"header-cell-style":{color:"#909399",textAlign:"center",background:"#f5f7fa"},"cell-style":{padding:"12px 0"}}},[e("el-table-column",{attrs:{prop:"inet",label:"终端IP",width:"150"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(e){return t.innetactive(a.row)}}},[t._v(t._s(a.row.inet))]),e("i",{staticClass:"el-icon-circle-plus-outline",staticStyle:{"margin-left":"5px",color:"#3d95ff",cursor:"pointer"},on:{click:function(e){return e.stopPropagation(),t.searchAdd({key:"minion_task.inet",desc:"节点 IPv4"},a.row.inet)}}})]}}])}),e("el-table-column",{attrs:{prop:"name",label:"名称"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(e){return t.handleEdit(a.row)}}},[a.row.report_hash!==a.row.hash?e("span",{staticStyle:{color:"red"}},[t._v(" "+t._s(a.row.name)),e("i",{staticClass:"el-icon-circle-plus-outline",staticStyle:{"margin-left":"5px",color:"#3d95ff",cursor:"pointer"},on:{click:function(e){return e.stopPropagation(),t.searchAdd({key:"minion_task.name",desc:"配置名称"},a.row.name)}}}),e("el-tooltip",{attrs:{effect:"dark",content:"下发的配置与数据库中的配置校验不一致",placement:"right"}},[e("i",{staticClass:"fa fa-exclamation-circle"})])],1):e("span",[t._v(" "+t._s(a.row.name)),e("i",{staticClass:"el-icon-circle-plus-outline",staticStyle:{"margin-left":"5px",color:"#3d95ff",cursor:"pointer"},on:{click:function(e){return e.stopPropagation(),t.searchAdd({key:"minion_task.name",desc:"配置名称"},a.row.name)}}})])])]}}])}),e("el-table-column",{attrs:{prop:"from",label:"来源"},scopedSlots:t._u([{key:"default",fn:function(a){return[a.row.from?e("span",[t._v(t._s(a.row.from))]):e("span",[t._v("未知")])]}}])}),e("el-table-column",{attrs:{prop:"dialect",label:"属性"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(!0===e.row.dialect?"私有":"公有")+" ")]}}])}),e("el-table-column",{attrs:{prop:"status",label:"状态"},scopedSlots:t._u([{key:"default",fn:function(a){return["console"===a.row.from?e("span",[e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"scope.row.error",placement:"bottom"}},[a.row.status?e("span",[e("el-tag",{attrs:{effect:"plain",size:"small",type:"running"===a.row.status?"success":"error"===a.row.status?"warning":"danger"}},[t._v(t._s(a.row.status)+" "),e("span",{staticClass:"statu",class:"running"===a.row.status?"green-circle":"error"===a.row.status?"red-circle":"yellow-circle"})]),e("i",{staticClass:"el-icon-circle-plus-outline",staticStyle:{"margin-left":"5px",color:"#3d95ff",cursor:"pointer"},on:{click:function(e){return e.stopPropagation(),t.searchAdd({key:"minion_task.status",desc:"运行状态"},a.row.status)}}})],1):e("span",[t._v("未知 ")])])],1):e("span",[a.row.status?e("span",[e("el-tag",{attrs:{effect:"plain",size:"small",type:"running"===a.row.status?"success":"error"===a.row.status?"warning":"danger"}},[t._v(t._s(a.row.status)+" "),e("span",{staticClass:"statu",class:"running"===a.row.status?"green-circle":"error"===a.row.status?"red-circle":"yellow-circle"})]),e("i",{staticClass:"el-icon-circle-plus-outline",staticStyle:{"margin-left":"5px",color:"#3d95ff",cursor:"pointer"},on:{click:function(e){return e.stopPropagation(),t.searchAdd({key:"minion_task.status",desc:"运行状态"},a.row.status)}}})],1):e("span",[t._v("未知 ")])])]}}])}),e("el-table-column",{attrs:{prop:"link",label:"外链"},scopedSlots:t._u([{key:"default",fn:function(a){return[a.row.link?e("span",[t._v(t._s(a.row.link))]):e("span",[t._v("无")])]}}])}),e("el-table-column",{attrs:{prop:"created_at",label:"创建时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("date")(e.row.created_at,"yyyy-MM-dd hh:mm:ss"))+" ")]}}])}),e("el-table-column",{attrs:{label:"操作",align:"right",width:"180"},scopedSlots:t._u([{key:"default",fn:function(a){return["console"!==a.row.from?e("span",[e("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(e){return t.handleEvent(a.row)}}},[t._v("事件")]),e("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(e){return t.reloadService(a.row)}}},[t._v("重启")])],1):t._e(),a.row.dialect&&"startup"!==a.row.name?e("el-popover",{ref:a.row.substance_id,attrs:{placement:"top"}},[e("p",[t._v("确定删除?")]),e("div",{staticStyle:{"text-align":"right",margin:"0"}},[e("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(e){t.$refs[a.row.substance_id].doClose()}}},[t._v("取消")]),e("el-button",{attrs:{loading:t.delLoading,type:"primary",size:"mini"},on:{click:function(e){return t.delCode(a.row.substance_id)}}},[t._v("确定 ")])],1),e("el-button",{staticStyle:{"margin-left":"3%"},attrs:{slot:"reference",type:"text",size:"mini"},slot:"reference"},[t._v("删除")])],1):e("span",{staticStyle:{color:"#c0c4cc","margin-left":"3%"}},[t._v("删除")])]}}])})],1),e("Page",{attrs:{size:t.pageSize,current:t.currentPage,pageTotal:t.initData.total},on:{handleSizeChange:t.handleSizeChange,handleCurrentChange:t.handleCurrentChange}}),e("el-drawer",{staticClass:"eventDrawer",attrs:{visible:t.processShow,direction:"rtl",size:"25%"},on:{"update:visible":function(e){t.processShow=e},close:t.processCancel}},[e("div",{staticStyle:{padding:"0 20px"}},[e("span",{staticStyle:{"font-size":"13px",color:"#86909c","font-weight":"bold"}},[e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:12}},[e("span",{staticClass:"controlCard",staticStyle:{"font-size":"12px"}},[t._v("进程详情")])])],1),e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:24}},[t._v("进程名称 "),e("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.name))])])],1),e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:24}},[t._v("内存使用"),e("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.mem_size||"-"))])])],1),e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:24}},[t._v("进程PID"),e("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.pid))])])],1),e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:24}},[t._v("进程PPID"),e("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.ppid))])])],1),e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:24}},[t._v("用户信息"),e("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.username))])])],1),e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:24}},[t._v("处理字节"),e("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.rss_bytes||"-"))])])],1),e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:24}},[t._v("启动时间"),e("span",{staticClass:"subtitle"},[t._v(t._s(t._f("date")(t.processDetailData.created_at,"yyyy-MM-dd hh:mm:ss")))])])],1),e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:24}},[t._v("启动参数"),e("span",{staticClass:"subtitle"},[t.processDetailData.args?e("span",[t.processDetailData.args.length>0?e("span",t._l(t.processDetailData.args,(function(a,s){return e("span",{key:s},[e("el-tag",{staticStyle:{"margin-right":"10px"},attrs:{type:"info",size:"mini"}},[t._v(t._s(a))])],1)})),0):t._e()]):e("span",[t._v("-")])])])],1),e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:24}},[t._v("启动命令"),e("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.cmdline||"-"))])])],1),e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:24}},[t._v("进程路径"),e("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.executable||"-"))])])],1),e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:24}},[t._v("checksum"),e("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.checksum||"-"))])])],1)],1)])]),e("codeEdit",{ref:"codeEditRef",on:{handleEdit:t.refresh}}),e("addService",{ref:"addService",on:{getNode:t.getNode}}),t.eventDetailShow?e("Event",{ref:"eventDetail",attrs:{drawerEvent:t.drawerEvent,eventsData:t.eventsData},on:{closeEvent:t.closeEvent}}):t._e(),e("el-drawer",{staticClass:"inetDrawer",attrs:{title:t.ipTtitel.inet,visible:t.drawer,direction:t.directions,"before-close":t.drawerClose,size:"90%"},on:{"update:visible":function(e){t.drawer=e}}},[e("node-detail",{ref:"ipDetail",attrs:{minionId:t.ipTtitel.minion_id,dataTask:t.ipTtitel}})],1)],1)},l=[],r=function(){var t=this,e=t._self._c;return e("el-drawer",{attrs:{title:"事件",visible:t.drawerEvent,direction:t.direction,"before-close":t.handleClose,"append-to-body":!0},on:{"update:visible":function(e){t.drawerEvent=e}}},[e("div",{staticStyle:{padding:"0 20px"}},[t.eventsData&&t.eventsData.length>0?e("span",[e("el-timeline",{attrs:{reverse:!0}},t._l(t.eventsData,(function(a,s){return e("el-timeline-item",{key:s,attrs:{timestamp:a.occur_at}},[t._v(" "+t._s(a.subject)+" ")])})),1)],1):e("span",[e("el-empty",{attrs:{description:"暂无数据"}})],1)])])},o=[],c={props:["drawerEvent","eventsData"],data(){return{direction:"rtl"}},methods:{handleClose(t){this.$emit("closeEvent",!1)}}},d=c,h=a(1001),p=(0,h.Z)(d,r,o,!1,null,null,null),u=p.exports,m=a(37789),f=a(12037),v=a(84241),g=(a(28451),a(65012)),y=a(49236),b={components:{Page:f.Z,selectSearch:v.Z,codeEdit:g["default"],addService:m.Z,NodeDetail:y.Z,Event:u},name:"taskDetail",data(){return{drawerEvent:!1,eventDetailShow:!1,tableLoading:!1,topEchartShow:!1,initData:{},currentPage:1,pageSize:15,delLoading:!1,selectArray:[{model:"",placeholder:"运行状态",name:"minion_task.status",dataArray:[{key:"running",desc:"running"},{key:"doing",desc:"doing"},{key:"fail",desc:"fail"},{key:"panic",desc:"panic"},{key:"reg",desc:"reg"},{key:"update",desc:"update"}]},{model:"",placeholder:"属性",name:"minion_task.dialect",dataArray:[{key:"true",desc:"私有"},{key:"false",desc:"公有"}]}],ipTtitel:{},drawer:!1,directions:"rtl",dataTask:{},eventsData:[],processShow:!1,processDetailData:{},searchName:"",condData:{},startTime:null,endTime:null,value:"",operator:"",field:"",filters:[],activeIndex:null}},created(){this.init(),this.getCond()},methods:{closeEvent(t){this.drawerEvent=t},attackShow(){this.$emit("activeClick",!0,!1)},echartShow(){this.topEchartShow=!this.topEchartShow,this.$emit("activechartShow")},drawerClose(){this.drawer=!1,this.ipTtitel={}},innetactive(t){this.ipTtitel=t,this.drawer=!0},getCond(){this.$request.fetchTaskCond().then((t=>{this.condData=t.data}))},searchBasic(t){this.currentPage=1,this.filters=t,this.init()},init(){this.tableLoading=!0;var t={current:this.currentPage,size:this.pageSize,filters:this.filters};this.$request.fetchGetTask(t).then((t=>{this.tableLoading=!1,this.initData=t.data}))},handleSizeChange(t){this.pageSize=t,this.init()},handleCurrentChange(t){this.currentPage=t,this.init()},reloadService(t){var e={id:t.minion_id,substance_id:t.substance_id,dialect:t.dialect};this.$request.fetchPatchReload(e).then((t=>{this.$message.success("重启成功！！")})).catch((t=>{this.$message.error(t.data)}))},handleEvent(t){this.eventDetailShow=!0;var e={current:1,size:100,filters:[{key:"minion_id",value:t.minion_id,operator:"eq"},{key:"from_code",value:t.from,operator:"eq"}]},s=this,i=a(30381);this.$request.fetchGetEents(e).then((t=>{null!==t.data.records?this.eventsData=t.data.records.map((t=>(t.occur_at=i(t.occur_at).format("YYYY-MM-DD HH:mm:ss"),t))):this.eventsData=[],s.drawerEvent=!0}))},handleEdit(t){this.$refs.codeEditRef.openTaskDetail({dialect:t.dialect,minionId:t.minion_id,taskId:t.substance_id})},delCode(t){this.$refs[t].doClose();var e=this;e.delLoading=!0,this.$request.fetchDeleteCodeEdit(t).then((()=>{e.$message({message:"删除成功!!!",type:"success"}),e.delLoading=!1,e.init()})).catch((t=>{e.delLoading=!1,this.$message.error(t.data)}))},addService(){var t=this.$refs.addService;t.form.minion_id=this.$route.params.id,t.serverVisible=!0},searchAdd(t,e){this.currentPage=1;const a=this.$refs.selectRef;a.setOption(t.key,"eq",e),this.$nextTick((()=>{this.init()}))},resync(){var t={cmd:"resync",filters:[]};this.$request.fetchBatch(t).then((t=>{this.$message({message:"同步成功!!!",type:"success"})})).catch((t=>{this.$message.error(t.data)}))},getNode(){this.init()},refresh(){this.init()},detailData(t){this.$message({message:"开发中！！！",type:"warning"})},processCancel(){this.processDetailData={},this.processShow=!1}}},_=b,w=(0,h.Z)(_,n,l,!1,null,"1274d13e",null),k=w.exports,S=function(){var t=this,e=t._self._c;return e("span",[e("el-row",[e("el-col",{attrs:{span:12}},[e("el-row",[e("el-col",{attrs:{span:12}},[e("span",{staticClass:"controlCard"},[t._v("运行状态")])])],1),e("div",{style:{float:"left",width:"100%",height:"200px"},attrs:{id:"risklvlEchart"}})],1),e("el-col",{attrs:{span:12}},[e("el-row",[e("el-col",{attrs:{span:12}},[e("span",{staticClass:"controlCard"},[t._v("配置属性")])])],1),e("div",{style:{float:"left",width:"100%",height:"200px"},attrs:{id:"riskstsEchart"}})],1)],1)],1)},D=[],C=a(84772),x={name:"taskCount",data(){return{countData:{},riskstsData:{}}},created(){this.init()},methods:{init(){this.$request.fetchGetTackCount().then((t=>{this.countData=t.data,this.initleft(),this.initright()}))},initright(){var t=[];for(let n in this.countData){var e={};"running"===n?(e={name:"运行正常",value:this.countData[n],itemStyle:{color:"#91cc75"}},t.push(e)):"doing"===n?(e={name:"正在启动",value:this.countData[n],itemStyle:{color:"#fd8c00"}},t.push(e)):"fail"===n?(e={name:"运行失败",value:this.countData[n],itemStyle:{color:"#f86c6b"}},t.push(e)):"panic"===n?(e={name:"运行崩溃",value:this.countData[n],itemStyle:{color:"#909399"}},t.push(e)):"update"===n?(e={name:"正在更新",value:this.countData[n],itemStyle:{color:"#409eff"}},t.push(e)):"reg"===n&&(e={name:"注册状态",value:this.countData[n],itemStyle:{color:"#ffc107"}},t.push(e))}let a=0;t.forEach((function(t){a+=t.value}));var s={legend:{orient:"vertical",right:"15%",align:"left",top:"middle",itemWidth:10,itemHeight:13,icon:"circle",itemGap:20,data:t,formatter:function(e){let s=0;for(var i="",n=0;n<t.length;n++)t[n].name==e&&(s=(t[n].value/a*100).toFixed(2)+"%",i+="{a|"+e+"}| {b|"+s+"}{b|"+t[n].value+"}");return i},textStyle:{color:"#000",rich:{a:{fontSize:12,padding:[0,10,0,6],color:"#666",fontFamily:"PingFang SC",fontStyle:"normal",lineHeight:20},b:{fontSize:12,padding:[0,10,0,6],color:"#666",fontFamily:"PingFang SC",fontStyle:"normal",lineHeight:20}}}},tooltip:{trigger:"item"},series:[{type:"pie",data:t,center:["35%","50%"],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};const i=C.init(document.getElementById("risklvlEchart"));i.setOption(s),window.addEventListener("resize",(()=>{i.resize()}))},initleft(){var t=[];for(let n in this.countData){var e={};"dialect"===n?(e={name:"私有",value:this.countData[n]},t.push(e)):"public"===n&&(e={name:"公有",value:this.countData[n]},t.push(e))}let a=0;t.forEach((function(t){a+=t.value}));var s={legend:{orient:"vertical",right:"15%",align:"left",top:"middle",itemWidth:10,itemHeight:13,icon:"circle",itemGap:20,data:t,formatter:function(e){let s=0;for(var i="",n=0;n<t.length;n++)t[n].name==e&&(s=(t[n].value/a*100).toFixed(2)+"%",i+="{a|"+e+"}| {b|"+s+"}{b|"+t[n].value+"}");return i},textStyle:{color:"#000",rich:{a:{fontSize:12,padding:[0,10,0,6],color:"#666",fontFamily:"PingFang SC",fontStyle:"normal",lineHeight:20},b:{fontSize:12,padding:[0,10,0,6],color:"#666",fontFamily:"PingFang SC",fontStyle:"normal",lineHeight:20}}}},tooltip:{trigger:"item"},series:[{type:"pie",data:t,center:["35%","50%"],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};const i=C.init(document.getElementById("riskstsEchart"));i.setOption(s),window.addEventListener("resize",(()=>{i.resize()}))}}},$=x,z=(0,h.Z)($,S,D,!1,null,null,null),T=z.exports,E=function(){var t=this,e=t._self._c;return e("div",[e("el-row",[e("el-col",{attrs:{span:18}},[e("select-search",{ref:"select",attrs:{condData:t.condData},on:{searchBasic:t.searchBasic}})],1),e("el-col",{staticStyle:{"text-align":"right"},attrs:{span:6}},[e("el-button",{staticStyle:{margin:"10px 0"},attrs:{type:"success",plain:"",size:"mini"},on:{click:t.echartShow}},[t._v(" "+t._s(!0===t.topEchartShow?"隐藏图表":"显示图表")+" ")]),e("span",{staticStyle:{margin:"10px 0"}},[e("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:t.init}},[t._v("刷新")])],1),e("el-button-group",[e("el-button",{attrs:{type:"info",size:"mini"},on:{click:t.attackShow}},[t._v("任务详情")]),e("el-button",{attrs:{type:"primary",size:"mini"}},[t._v("任务汇总")])],1)],1)],1),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tableLoading,expression:"tableLoading"}],staticStyle:{width:"100%","margin-top":"5px"},attrs:{data:t.initData.records,"header-cell-style":{color:"#909399",textAlign:"center",background:"#f5f7fa"},"cell-style":{padding:"12px 0"}}},[e("el-table-column",{attrs:{prop:"name",label:"任务名称"}}),e("el-table-column",{attrs:{prop:"name",label:"属性"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(!0===e.row.dialect?"私有":"公有")+" ")]}}])}),e("el-table-column",{attrs:{prop:"running",label:"成功"}}),e("el-table-column",{attrs:{prop:"fail",label:"失败"}}),e("el-table-column",{attrs:{prop:"reg",label:"注册"}}),e("el-table-column",{attrs:{prop:"update",label:"更新中"}}),e("el-table-column",{attrs:{prop:"panic",label:"崩溃"}}),e("el-table-column",{attrs:{prop:"doing",label:"启动"}})],1),e("Page",{attrs:{size:t.pageSize,current:t.currentPage,pageTotal:t.initData.total},on:{handleSizeChange:t.handleSizeChange,handleCurrentChange:t.handleCurrentChange}}),e("el-drawer",{staticClass:"eventDrawer",attrs:{visible:t.processShow,direction:"rtl",size:"25%"},on:{"update:visible":function(e){t.processShow=e},close:t.processCancel}},[e("div",{staticStyle:{padding:"0 20px"}},[e("span",{staticStyle:{"font-size":"13px",color:"#86909c","font-weight":"bold"}},[e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:12}},[e("span",{staticClass:"controlCard",staticStyle:{"font-size":"12px"}},[t._v("进程详情")])])],1),e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:24}},[t._v("进程名称 "),e("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.name))])])],1),e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:24}},[t._v("内存使用"),e("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.mem_size||"-"))])])],1),e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:24}},[t._v("进程PID"),e("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.pid))])])],1),e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:24}},[t._v("进程PPID"),e("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.ppid))])])],1),e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:24}},[t._v("用户信息"),e("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.username))])])],1),e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:24}},[t._v("处理字节"),e("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.rss_bytes||"-"))])])],1),e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:24}},[t._v("启动时间"),e("span",{staticClass:"subtitle"},[t._v(t._s(t._f("date")(t.processDetailData.created_at,"yyyy-MM-dd hh:mm:ss")))])])],1),e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:24}},[t._v("启动参数"),e("span",{staticClass:"subtitle"},[t.processDetailData.args?e("span",[t.processDetailData.args.length>0?e("span",t._l(t.processDetailData.args,(function(a,s){return e("span",{key:s},[e("el-tag",{staticStyle:{"margin-right":"10px"},attrs:{type:"info",size:"mini"}},[t._v(t._s(a))])],1)})),0):t._e()]):e("span",[t._v("-")])])])],1),e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:24}},[t._v("启动命令"),e("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.cmdline||"-"))])])],1),e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:24}},[t._v("进程路径"),e("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.executable||"-"))])])],1),e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:24}},[t._v("checksum"),e("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.checksum||"-"))])])],1)],1)])]),e("addService",{ref:"addService",on:{getNode:t.getNode}}),t.eventDetailShow?e("Event",{ref:"eventDetail",attrs:{dataTask:t.dataTask}}):t._e(),e("el-drawer",{attrs:{title:t.ipTtitel.inet,visible:t.drawer,direction:t.directions,"before-close":t.drawerClose,size:"90%"},on:{"update:visible":function(e){t.drawer=e}}},[e("node-detail",{ref:"ipDetail",attrs:{minionId:t.ipTtitel.minion_id}})],1)],1)},I=[],A={components:{Page:f.Z,selectSearch:v.Z,AddForm:g["default"],addService:m.Z,NodeDetail:y.Z,Event:u},name:"index",props:["dataTask"],data(){return{eventDetailShow:!1,tableLoading:!1,topEchartShow:!1,initData:{},currentPage:1,pageSize:15,delLoading:!1,ipTtitel:{},drawer:!1,directions:"rtl",processShow:!1,processDetailData:{},searchName:"",condData:{},startTime:null,endTime:null,value:"",operator:"",field:"",filters:[],activeIndex:null}},created(){this.init(),this.getCond()},methods:{attackShow(){this.$emit("activeClick",!1,!0)},echartShow(){this.topEchartShow=!this.topEchartShow,this.$emit("activechartShow")},drawerClose(){this.drawer=!1,this.ipTtitel={}},getCond(){this.$request.fetchTaskCond().then((t=>{this.condData=t.data}))},searchBasic(t){this.currentPage=1,this.filters=t,this.init()},init(){this.tableLoading=!0;var t={current:this.currentPage,size:this.pageSize,filters:this.filters};this.$request.fetchGetTaskGather(t).then((t=>{this.tableLoading=!1,this.initData=t.data}))},handleSizeChange(t){this.pageSize=t,this.init()},handleCurrentChange(t){this.currentPage=t,this.init()},reloadService(t){var e={id:t.minion_id,substance_id:t.substance_id,dialect:t.dialect};this.$request.fetchPatchReload(e).then((t=>{this.$message.success("重启成功！！")})).catch((t=>{this.$message.error(t.data)}))},handleEvent(t){this.dataTask=t;const e=this.$refs.eventDetail;e.drawer=!0,this.eventDetailShow=!0},handleEdit(t){const e=this.$refs.formAdd;this.$request.fetchdetailDialect(t.minion_id,t.substance_id).then((s=>{let i=a(19575).Base64;e.serverData=s.data,e.dataTask=t,s.data.chunk?e.dialogValue=i.decode(s.data.chunk):e.dialogValue=i.decode(" "),e.form={id:s.data.id,icon:s.data.icon,chunk:s.data.chunk,version:s.data.version},e.codeName=s.data.name,e.linkArray=s.data.links,e.dialogVisible=!0})).catch((t=>{this.$message.error(t.data)}))},delCode(t){this.$refs[t].doClose();var e=this;e.delLoading=!0,this.$request.fetchDeleteCodeEdit(t).then((()=>{e.$message({message:"删除成功!!!",type:"success"}),e.delLoading=!1,e.init()})).catch((t=>{e.delLoading=!1,this.$message.error(t.data)}))},addService(){var t=this.$refs.addService;t.form.minion_id=this.$route.params.id,t.serverVisible=!0},searchAdd(t,e){this.currentPage=1;const a=this.$refs.select;var s=[];this.activeAdd=[{key:t.key,value:e,operator:"eq"}],s=[{key:t,value:e,operator:{desc:"等于",key:"eq"}}],a.filtersshow=s,this.filters=this.activeAdd,this.init()},getNode(){this.init()},detailData(t){this.$message({message:"开发中！！！",type:"warning"})},processCancel(){this.processDetailData={},this.processShow=!1}}},P=A,V=(0,h.Z)(P,E,I,!1,null,"7c8e4882",null),q=V.exports,L={components:{taskDetail:k,taskSum:q,taskCount:T},name:"index",data(){return{taskDetailShow:!0,taskSumShow:!1,recentData:[],chartShow:!1}},methods:{activeClick(t,e){this.chartShow=!1,this.taskSumShow=t,this.taskDetailShow=e},activechartShow(){this.chartShow=!this.chartShow},getRecent(t){this.$request.fetchRevent(t).then((t=>{this.recentData=t.data,this.recentShow=!0}))}}},B=L,Z=(0,h.Z)(B,s,i,!1,null,"85c48a06",null),M=Z.exports},65012:function(t,e,a){a.r(e),a.d(e,{default:function(){return u}});var s=function(){var t=this,e=t._self._c;return e("el-drawer",{staticClass:"systemSet",attrs:{visible:t.dialogVisible,"show-close":!1,direction:"rtl","custom-class":"taskEditDrawer","close-on-press-escape":!1,"append-to-body":!0,"close-on-click-modal":!1,"before-close":t.handleClose,withHeader:!1,size:"90%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[t.dialogVisible?e("div",[e("el-row",{attrs:{type:"flex"}},[e("el-col",{attrs:{span:t.showDesc?19:24}},[e("el-row",[t.codeShow?e("el-col",{attrs:{span:24}},[e("codeEditor",{style:`min-height: calc(100vh - ${t.showPane?200:8}px)`,attrs:{theme:"dark"},scopedSlots:t._u([{key:"icon",fn:function(){return[e("el-popover",{attrs:{placement:"bottom-start",width:"460",trigger:"click"},on:{show:function(e){return t.$refs["iconSelect"].reset()}}},[e("IconSelect",{ref:"iconSelect",on:{selected:t.iconSelected}}),e("template",{slot:"reference"},[e("span",{},[t.serverData.icon?e("svg-icon",{staticClass:"iconfont",staticStyle:{"font-size":"23px"},attrs:{"icon-class":t.serverData.icon&&t.Base64.decode(t.serverData.icon)||""}}):e("i",{staticClass:"el-icon-paperclip",staticStyle:{"font-size":"23px",color:"white",transform:"translateY(7px)"}})],1)])],2)]},proxy:!0},{key:"extra",fn:function(){return[e("div",[e("span",{staticStyle:{"margin-left":"14px",cursor:"pointer"},on:{click:t.refreshCode}},[e("i",{staticClass:"fa fa-refresh",attrs:{title:"刷新"}}),e("span",{staticStyle:{"margin-left":"3px"}},[t._v("刷新")])]),e("el-popconfirm",{attrs:{title:"确定继续？"},on:{confirm:t.onSubmit}},[e("span",{staticStyle:{"margin-left":"6px",cursor:"pointer"},attrs:{slot:"reference"},slot:"reference"},[e("i",{staticClass:"fa fa-cloud-upload",staticStyle:{"margin-left":"10px",cursor:"pointer"},attrs:{title:"提交"}}),e("span",{staticStyle:{"margin-left":"0px"}},[t._v(" 提交 ")])])]),e("span",{staticStyle:{"margin-left":"12px",cursor:"pointer"},on:{click:t.reloadService}},[e("i",{staticClass:"fa fa-undo",staticStyle:{cursor:"pointer"},attrs:{title:"重启"}}),e("span",[t._v(" 重启 ")])]),e("span",{staticStyle:{"margin-left":"12px",cursor:"pointer"},on:{click:function(e){t.dialogVisible=!1}}},[e("i",{staticClass:"fa fa-close",attrs:{title:"关闭"}}),e("span",[t._v(" 关闭 ")])]),t.showDesc?t._e():e("span",{staticStyle:{"margin-left":"12px",cursor:"pointer"},on:{click:function(e){t.showDesc=!0}}},[e("i",{staticClass:"el-icon-arrow-left",staticStyle:{cursor:"pointer","font-size":"18px"},attrs:{title:"任务"}})])],1)]},proxy:!0}],null,!1,700884357),model:{value:t.dialogValue,callback:function(e){t.dialogValue=e},expression:"dialogValue"}}),t.showPane?t._e():e("span",{staticStyle:{cursor:"pointer",position:"absolute",right:"10px","z-index":"10",color:"aliceblue",bottom:"10px"},on:{click:function(e){t.showPane=!0}}},[e("i",{staticClass:"el-icon-arrow-up",staticStyle:{cursor:"pointer","font-size":"20px"},attrs:{title:"日志"}})])],1):t._e()],1),t.showPane?e("el-row",{staticStyle:{"margin-top":"10px"}},[e("el-col",{attrs:{span:24}},[e("EventTask",{attrs:{dataTask:t.dataTask}}),e("div",{staticClass:"tool"},[t.codeShow?e("i",{staticClass:"el-icon-arrow-up",attrs:{title:"最大化显示"},on:{click:function(e){t.codeShow=!1}}}):e("i",{staticClass:"el-icon-arrow-down",attrs:{title:"常规显示"},on:{click:function(e){t.codeShow=!0}}}),e("span",{staticStyle:{"margin-left":"3px"},attrs:{title:"关闭面板"},on:{click:function(e){t.showPane=!1,t.codeShow=!0}}},[e("i",{staticClass:"el-icon-close"})])])],1)],1):t._e()],1),t.showDesc?e("el-col",{staticStyle:{"padding-left":"5px","padding-right":"0px"},attrs:{span:5}},[e("el-card",{staticClass:"card",staticStyle:{height:"100%"}},[e("el-row",[e("el-col",{staticStyle:{"margin-bottom":"10px",display:"flex","justify-content":"space-between"}},[e("h3",[t._v("任务信息")]),e("i",{staticClass:"el-icon-arrow-right",staticStyle:{"font-size":"20px",cursor:"pointer"},on:{click:function(e){t.showDesc=!1}}})]),e("el-col",{staticStyle:{"margin-bottom":"8px"}},[e("span",{staticClass:"label"},[t._v(" 任务名称：")]),t._v(" "+t._s(t.serverData.name)+" ")]),e("el-col",{staticStyle:{"margin-bottom":"8px"}},[e("span",{staticClass:"label"},[t._v("外链详情：")]),t._v(t._s(t.nullChange(t.serverData.link))+" ")]),e("el-col",{staticStyle:{"margin-bottom":"8px"}},[e("span",{staticClass:"label"},[t._v("本地哈希：")]),t._v(" "+t._s(t.serverData.legal_hash)+" ")]),e("el-col",{staticStyle:{"margin-bottom":"8px"}},[e("span",{staticClass:"label"},[t._v(" 上报哈希： ")]),t._v(" "+t._s(t.serverData.actual_hash)+" ")]),e("el-col",{staticStyle:{"margin-bottom":"8px"}},[e("span",{staticClass:"label"},[t._v(" 报错信息： ")]),t._v(" "+t._s(t.nullChange(t.serverData.cause))+" ")]),e("el-col",{staticStyle:{"margin-bottom":"20px"}},[e("span",{staticClass:"label"},[t._v(" 描述信息： ")]),t._v(" "+t._s(t.nullChange(t.serverData.desc))+" ")])],1),e("el-row",[e("el-col",{staticStyle:{"margin-bottom":"10px"}},[e("h3",[t._v("服务信息")]),t.serverData.runners&&t.serverData.runners.length?t._e():e("div",{staticClass:"label"},[t._v(" -- ")])]),t._l(t.serverData.runners,(function(a,s){return e("div",{key:s},[e("el-col",{staticStyle:{"margin-bottom":"5px"}},[e("span",{attrs:{type:"info",size:"mini"}},[e("span",{staticClass:"label"},[t._v(" 名称： ")]),t._v(" "+t._s(a.name))])]),e("el-col",{staticStyle:{"margin-bottom":"5px"}},[e("span",{attrs:{type:"info",size:"mini"}},[e("span",{staticClass:"label"},[t._v("类型：")]),""!==a.type?e("span",[t._v(t._s(a.type))]):t._e()])]),e("el-col",{staticStyle:{"margin-bottom":"15px"}},[e("span",{attrs:{type:"info",size:"mini"}},[e("span",{staticClass:"label"},[t._v(" 状态： ")]),t._v(t._s(a.status))])])],1)}))],2)],1)],1):t._e()],1)],1):t._e()])},i=[],n=a(91938),l=a(11924);let r=a(19575).Base64;const o="CODEEDIT";var c={name:"codeEdit",components:{IconSelect:n.Z,codeEditor:l.Z,EventTask:()=>a.e(8426).then(a.bind(a,8426))},props:{},data(){return{Base64:r,serverData:{},dialogVisible:!1,dialogValue:"",dataTask:{},codeShow:!0,showPane:!0,showDesc:!0,minionId:"",initData:null}},created(){this.initConfig()},watch:{showDesc(){this.saveConifg()},codeShow(){this.saveConifg()},showPane(){this.saveConifg()}},methods:{reloadService(){var t={id:this.dataTask.minion_id,substance_id:this.serverData.id,dialect:this.serverData.dialect};this.$request.fetchPatchReload(t).then((t=>{this.$message.success("重启成功！！"),this.loadData(this.initData)})).catch((t=>{this.$message.error(t.data)}))},dateTime(t){var e=a(30381);return e(t).format("YYYY-MM-DD HH:mm:ss")},refreshCode(){this.loadData(this.initData)},editCode(){this.codeShow=!this.codeShow},nullChange(t){return""!==t&&" "!==t?t:"无"},handleClose(){},async iconSelected(t){try{this.serverData.icon=r.encode(t),await this.savaTask({id:this.serverData.id,icon:this.serverData.icon,chunk:this.serverData.chunk,version:this.serverData.version}),this.$emit("handleEdit",this.dataTask),this.$message.success("切换icon成功"),this.loadData(this.initData)}catch(e){this.$message.error(e||"操作出错")}},async savaTask(t){let e;return e=this.initData.dialect?()=>this.$request.fetchUpdateDialect(t):()=>this.$request.fetchUpdataCode(t),e()},async onSubmit(){try{let e=r.encode(this.dialogValue);var t={id:this.serverData.id,icon:this.serverData.icon,chunk:e,version:this.serverData.version};await this.savaTask(t),this.$message({message:"编辑成功",type:"success"}),this.$emit("handleEdit",this.dataTask),this.loadData(this.initData)}catch(e){this.$message.error(e)}},async loadData({dialect:t,minionId:e,taskId:a=null}){try{let t;t=e?()=>this.$request.fetchdetailDialect(e,a):()=>this.$request.fetchUpdataCodeEdit(a),this.minionId=e;const{data:s}=await t()||{};this.dataTask={minion_id:e,name:s.name,id:s.id},this.dialogValue=r.decode(s.chunk||" "),this.serverData=s||{}}catch(s){this.$message.error(s||"查询出错")}},async openTaskDetail(t){try{this.initData=t,await this.loadData(t),this.dialogVisible=!0}catch(e){this.$message.error(e||"查询出错")}},initConfig(){const t=localStorage.getItem(o);if(t)try{const e=JSON.parse(t);this.showDesc=e.showDesc,this.showPane=e.showPane,this.codeShow=e.codeShow}catch(e){}},saveConifg(){localStorage.setItem(o,JSON.stringify({showDesc:this.showDesc,showPane:this.showPane,codeShow:this.codeShow}))}}},d=c,h=a(1001),p=(0,h.Z)(d,s,i,!1,null,"4840203c",null),u=p.exports},68632:function(t,e,a){a.d(e,{Z:function(){return u}});var s=function(){var t=this,e=t._self._c;return e("div",{staticStyle:{"padding-bottom":"5px"}},[e("el-row",{staticStyle:{"margin-bottom":"10px"}},[e("el-col",{attrs:{span:6}},[e("el-button-group",[e("el-button",{attrs:{type:"primary",size:"mini"}},[t._v("事件")]),e("el-button",{attrs:{type:"info",size:"mini"},on:{click:t.taskShow}},[t._v("终端")]),e("el-button",{attrs:{type:"info",size:"mini"},on:{click:t.riskShow}},[t._v("风险")])],1)],1),e("el-col",{staticStyle:{"padding-right":"50px"},attrs:{span:18}},[e("select-search",{staticStyle:{float:"right","text-align":"right"},attrs:{condData:t.condData,defaultData:t.dataTask,multiCondition:!1,nameIndex:"事件详情"},on:{searchBasic:t.searchBasic,oneClear:t.oneClear,refresh:t.refresh}})],1)],1),e("tableList",{attrs:{data:t.eventsData.records,columns:t.columns,configIconPos:"inhead",pagination:t.pagination,"cell-style":{padding:"0px",background:"#303133",color:"#86909c"},"header-cell-style":{background:"#303133",color:"#f2f6fca8",fontWeight:"600",fontSize:"12px"}},on:{loadData:t.getEventData},scopedSlots:t._u([{key:"level",fn:function(t){return[e("span",{staticClass:"circle_content"},[e("span",{class:"严重"===t.row.level?"critical":"高危"===t.row.level?"high":"中危"===t.row.level?"medium":"low"})])]}},{key:"operate",fn:function(a){return[e("el-button",{staticStyle:{color:"#4175b3"},attrs:{size:"mini",type:"text"},on:{click:function(e){return t.detailEvent(a.row)}}},[t._v("详情")]),e("el-button",{staticStyle:{color:"#4175b3"},attrs:{size:"mini",type:"text"},on:{click:function(e){return t.cancelEvent(a.row.id)}}},[t._v("忽略")])]}}])}),e("el-drawer",{staticClass:"eventDrawer",attrs:{title:"事件详情",visible:t.eventDetailShow,direction:"rtl",size:"35%","append-to-body":!0},on:{"update:visible":function(e){t.eventDetailShow=e},close:t.eventDetailCancel}},[e("div",{staticStyle:{padding:"0 20px"}},[e("span",{staticStyle:{"font-size":"13px",color:"#86909c","font-weight":"bold"}},[e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:24}},[t._v("主题"),e("span",{staticClass:"subtitle"},[t._v(t._s(t.eventDetailData.subject||"-"))])])],1),e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:24}},[t._v("类型"),e("span",{staticClass:"subtitle"},[t._v(t._s(t.eventDetailData.typeof||"-"))])])],1),e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:24}},[t._v("来源"),e("span",{staticClass:"subtitle"},[t._v(t._s(t.eventDetailData.from_code||"-"))])])],1),e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:24}},[t._v("时间"),e("span",{staticClass:"subtitle"},[t._v(t._s(t._f("date")(t.eventDetailData.created_at,"yyyy-MM-dd hh:mm:ss")))])])],1),e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:24}},[t._v("远程地址"),e("span",{staticClass:"subtitle"},[t._v(t._s(t.eventDetailData.remote_addr||"-"))])])],1),e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:24}},[t._v("远程端口"),e("span",{staticClass:"subtitle"},[t._v(t._s(t.eventDetailData.remote_port||"-"))])])],1),e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:24}},[t._v("地理位置"),e("span",{staticClass:"subtitle"},[t._v(t._s(t.eventDetailData.region||"-"))])])],1),e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:24}},[t._v("认证信息"),e("span",{staticClass:"subtitle"},[t._v(t._s(t.eventDetailData.auth||"-"))])])],1),e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:24}},[t._v("用户信息"),e("span",{staticClass:"subtitle"},[t._v(t._s(t.eventDetailData.user||"-"))])])],1),e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:24}},[e("span",{staticStyle:{float:"left"}},[t._v("内容：")]),e("span",{staticClass:"subtitle",staticStyle:{float:"left"}},[e("pre",{staticStyle:{"font-family":"none","white-space":"pre-wrap","word-break":"break-all"}},[t._v(t._s(t.eventDetailData.msg||"-"))])])])],1),e("el-row",{staticStyle:{"margin-bottom":"14px"}},[e("el-col",{attrs:{span:24}},[e("span",{staticStyle:{float:"left"}},[t._v("报错：")]),e("span",{staticClass:"subtitle",staticStyle:{float:"left"}},[e("pre",{staticStyle:{"font-family":"none","white-space":"pre-wrap","word-break":"break-all"}},[t._v(t._s(t.eventDetailData.error||"-"))])])])],1)],1)])]),e("el-dialog",{attrs:{title:"批量删除",visible:t.delshow,width:"30%","before-close":t.handleClose},on:{"update:visible":function(e){t.delshow=e}}},[e("span",[t._v("共计: "),e("span",{staticStyle:{color:"red"}},[t._v(t._s(0===t.filters.length?0:t.pageTotal))]),t._v(" 是否删除？")]),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.handleClose=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.delSubmit}},[t._v("确 定")])],1)])],1)},i=[],n=(a(28451),a(84241)),l=a(62476),r=a(30381),o=a.n(r),c={components:{selectSearch:n.Z,tableList:l.Z},props:["dataTask"],name:"index",data(){return{columns:[{label:"",slot:"level",width:"20"},{label:"IP",prop:"inet",width:"120p"},{label:"时间",prop:"time",width:"150",formatter(t){return o()(t.created_at).format("YYYY-MM-DD HH:mm:ss")}},{label:"主题",prop:"subject","show-overflow-tooltip":!0,width:"100"},{label:"类型",prop:"typeof",width:"100"},{label:"来源",prop:"from_code",width:"150"},{label:"内容",prop:"msg","show-overflow-tooltip":!0},{label:"远端地址",width:"150",prop:"remote_addr"},{label:"操作",width:"100",slot:"operate"}],delshow:!1,current:1,pageSize:13,pageTotal:0,pagination:{pageIndex:1,pageSize:15,total:0,pageSizes:[15,30,50],layout:"jumper, sizes, prev, pager, next,total"},searchData:"",constData:[],timer:null,startTime:"",endTime:"",condData:{},fromValue:"",typeofValue:"",subject:"",eventsData:[],eventDetailShow:!1,eventDetailData:{},filters:[],nameShow:"事件详情"}},created(){this.getSelectType(),this.getCond(),this.getEventData()},watch:{dataTask:function(){this.filters=[],this.getEventData()}},methods:{taskShow(){this.$emit("activeClick",!1,!0,!1)},riskShow(){this.$emit("activeClick",!1,!1,!0)},getCond(){this.$request.fetchEventCond().then((t=>{this.condData=t.data}))},handleClose(){this.delshow=!1},delSubmit(){var t=this,e={filters:this.filters};this.$request.fetchDeleteEvent(e).then((e=>{t.$message({message:"删除成功!!!",type:"success"}),t.delshow=!1,t.getEventData()})).catch((t=>{this.$message.error(t.data)}))},searchBasic(t){this.filters=t,this.current=1,this.getEventData()},getSelectType(){this.$request.fetchGetEventCond("").then((t=>{this.condData=t.data}))},getEventData(){var t={current:this.pagination.pageIndex,size:this.pagination.pageSize,filters:[{key:"from_code",operator:"eq",value:this.dataTask.name},...this.dataTask.minion_id?[{key:"minion_id",operator:"eq",value:this.dataTask.minion_id}]:[],...this.filters||[]]};this.$request.fetchGetEents(t).then((t=>{null!==t.data.records?this.eventsData=t.data:this.eventsData=[],this.pagination.total=t.data.total}))},oneClear(){var t={filters:[{key:"from_code",operator:"eq",value:this.dataTask.name},...this.dataTask.minion_id?[{key:"minion_id",operator:"eq",value:this.dataTask.minion_id}]:[],...this.filters||[]]};this.$request.fetchDeleteEvent(t).then((t=>{this.$message({message:"清除成功!!!",type:"success"}),this.getEventData()})).catch((t=>{this.$message.error(t.data)}))},refresh(){this.getEventData(),this.$message({message:"已刷新",type:"success"})},nullChange(t){return""!==t?t:"无"},async cancelEvent(t){try{await this.$request.fetchReadEents(t),this.$message({message:"已读",type:"success"}),this.getEventData()}catch(e){this.$message.error(e||"操作出错")}},detailEvent(t){this.eventDetailShow=!0,this.eventDetailData=t},eventDetailCancel(){this.eventDetailShow=!1,this.eventDetailData={}}}},d=c,h=a(1001),p=(0,h.Z)(d,s,i,!1,null,"44d5aae6",null),u=p.exports}}]);